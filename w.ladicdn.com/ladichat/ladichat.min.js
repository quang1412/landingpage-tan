!function(){var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(e){function a(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=Object.create(t.prototype);for(var n in a)i[n]=a[n];return i.constructor=e,e.prototype=i,e}function i(t){t=t||{},this.defaultProtocol=t.hasOwnProperty("defaultProtocol")?t.defaultProtocol:d.defaultProtocol,this.events=t.hasOwnProperty("events")?t.events:d.events,this.format=t.hasOwnProperty("format")?t.format:d.format,this.formatHref=t.hasOwnProperty("formatHref")?t.formatHref:d.formatHref,this.nl2br=t.hasOwnProperty("nl2br")?t.nl2br:d.nl2br,this.tagName=t.hasOwnProperty("tagName")?t.tagName:d.tagName,this.target=t.hasOwnProperty("target")?t.target:d.target,this.validate=t.hasOwnProperty("validate")?t.validate:d.validate,this.ignoreTags=[],this.attributes=t.attributes||t.linkAttributes||d.attributes,this.className=t.hasOwnProperty("className")?t.className:t.linkClass||d.className;for(var e=t.hasOwnProperty("ignoreTags")?t.ignoreTags:d.ignoreTags,a=0;a<e.length;a++)this.ignoreTags.push(e[a].toUpperCase())}function n(t){return t}function s(t,e,a,i){for(var n=0,s=t.length,o=e,r=[],d=void 0;n<s&&(d=o.next(t[n]));)o=d,n++;if(n>=s)return[];for(;n<s-1;)d=new h(i),r.push(d),o.on(t[n],d),o=d,n++;return d=new h(a),r.push(d),o.on(t[s-1],d),r}function o(t){return a(u,(function(t){t&&(this.v=t)}),t?{v:t}:{})}function r(t){return t instanceof C||t instanceof O}var d={defaultProtocol:"http",events:null,format:n,formatHref:n,nl2br:!1,tagName:"a",target:function(t,e){return"url"===e?"_blank":null},validate:!0,ignoreTags:[],attributes:null,className:"linkified"};i.prototype={resolve:function(t){var e=t.toHref(this.defaultProtocol);return{formatted:this.get("format",t.toString(),t),formattedHref:this.get("formatHref",e,t),tagName:this.get("tagName",e,t),className:this.get("className",e,t),target:this.get("target",e,t),events:this.getObject("events",e,t),attributes:this.getObject("attributes",e,t)}},check:function(t){return this.get("validate",t.toString(),t)},get:function(e,a,i){var n=void 0,s=this[e];if(!s)return s;switch(void 0===s?"undefined":t(s)){case"function":return s(a,i.type);case"object":return"function"==typeof(n=s.hasOwnProperty(i.type)?s[i.type]:d[e])?n(a,i.type):n}return s},getObject:function(t,e,a){var i=this[t];return"function"==typeof i?i(e,a.type):i}};var c=Object.freeze({defaults:d,Options:i,contains:function(t,e){for(var a=0;a<t.length;a++)if(t[a]===e)return!0;return!1}}),l=function(t){this.j=[],this.T=t||null};l.prototype={defaultTransition:!1,on:function(t,e){if(t instanceof Array){for(var a=0;a<t.length;a++)this.j.push([t[a],e]);return this}return this.j.push([t,e]),this},next:function(t){for(var e=0;e<this.j.length;e++){var a=this.j[e],i=a[0],n=a[1];if(this.test(t,i))return n}return this.defaultTransition},accepts:function(){return!!this.T},test:function(t,e){return t===e},emit:function(){return this.T}};var h=a(l,(function(t){this.j=[],this.T=t||null}),{test:function(t,e){return t===e||e instanceof RegExp&&e.test(t)}}),g=a(l,(function(t){this.j=[],this.T=t||null}),{jump:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.next(new t(""));return a===this.defaultTransition?(a=new this.constructor(e),this.on(t,a)):e&&(a.T=e),a},test:function(t,e){return t instanceof e}}),u=function(t){t&&(this.v=t)};u.prototype={toString:function(){return this.v+""}};var C=o(),f=o("@"),p=o(":"),m=o("."),_=o(),L=o(),v=o("\n"),y=o(),E=o("+"),b=o("#"),w=o(),S=o("mailto:"),T=o("?"),A=o("/"),N=o("_"),k=o(),O=o(),I=o(),x=o("{"),M=o("["),P=o("<"),R=o("("),D=o("}"),B=o("]"),H=o(">"),F=o(")"),G=o("&"),U=Object.freeze({Base:u,DOMAIN:C,AT:f,COLON:p,DOT:m,PUNCTUATION:_,LOCALHOST:L,NL:v,NUM:y,PLUS:E,POUND:b,QUERY:T,PROTOCOL:w,MAILTO:S,SLASH:A,UNDERSCORE:N,SYM:k,TLD:O,WS:I,OPENBRACE:x,OPENBRACKET:M,OPENANGLEBRACKET:P,OPENPAREN:R,CLOSEBRACE:D,CLOSEBRACKET:B,CLOSEANGLEBRACKET:H,CLOSEPAREN:F,AMPERSAND:G}),j="aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw".split("|"),$="0123456789".split(""),W="0123456789abcdefghijklmnopqrstuvwxyz".split(""),q=[" ","\f","\r","\t","\v"," "," ","᠎"],V=[],K=function(t){return new h(t)},Y=K(),z=K(y),J=K(C),X=K(),Z=K(I);Y.on("@",K(f)).on(".",K(m)).on("+",K(E)).on("#",K(b)).on("?",K(T)).on("/",K(A)).on("_",K(N)).on(":",K(p)).on("{",K(x)).on("[",K(M)).on("<",K(P)).on("(",K(R)).on("}",K(D)).on("]",K(B)).on(">",K(H)).on(")",K(F)).on("&",K(G)).on([",",";","!",'"',"'"],K(_)),Y.on("\n",K(v)).on(q,Z),Z.on(q,Z);for(var Q=0;Q<j.length;Q++){var tt=s(j[Q],Y,O,C);V.push.apply(V,tt)}var et=s("file",Y,C,C),at=s("ftp",Y,C,C),it=s("http",Y,C,C),nt=s("mailto",Y,C,C);V.push.apply(V,et),V.push.apply(V,at),V.push.apply(V,it),V.push.apply(V,nt);var st=et.pop(),ot=at.pop(),rt=it.pop(),dt=nt.pop(),ct=K(C),lt=K(w),ht=K(S);ot.on("s",ct).on(":",lt),rt.on("s",ct).on(":",lt),V.push(ct),st.on(":",lt),ct.on(":",lt),dt.on(":",ht);var gt=s("localhost",Y,L,C);V.push.apply(V,gt),Y.on($,z),z.on("-",X).on($,z).on(W,J),J.on("-",X).on(W,J);for(var ut=0;ut<V.length;ut++)V[ut].on("-",X).on(W,J);X.on("-",X).on($,J).on(W,J),Y.defaultTransition=K(k);var Ct=function(t){for(var e=t.replace(/[A-Z]/g,(function(t){return t.toLowerCase()})),a=t.length,i=[],n=0;n<a;){for(var s=Y,o=null,r=0,d=null,c=-1;n<a&&(o=s.next(e[n]));)(s=o).accepts()?(c=0,d=s):c>=0&&c++,r++,n++;if(!(c<0)){n-=c,r-=c;var l=d.emit();i.push(new l(t.substr(n-r,r)))}}return i},ft=Y,pt=Object.freeze({State:h,TOKENS:U,run:Ct,start:ft}),mt=function(t){t&&(this.v=t)};mt.prototype={type:"token",isLink:!1,toString:function(){for(var t=[],e=0;e<this.v.length;e++)t.push(this.v[e].toString());return t.join("")},toHref:function(){return this.toString()},toObject:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http";return{type:this.type,value:this.toString(),href:this.toHref(t)}}};var _t=a(mt,(function(t){t&&(this.v=t)}),{type:"email",isLink:!0}),Lt=a(mt,(function(t){t&&(this.v=t)}),{type:"email",isLink:!0,toHref:function(){return"mailto:"+this.toString()}}),vt=a(mt,(function(t){t&&(this.v=t)}),{type:"text"}),yt=a(mt,(function(t){t&&(this.v=t)}),{type:"nl"}),Et=a(mt,(function(t){t&&(this.v=t)}),{type:"url",isLink:!0,toHref:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"http",e=!1,a=!1,i=this.v,n=[],s=0;i[s]instanceof w;)e=!0,n.push(i[s].toString().toLowerCase()),s++;for(;i[s]instanceof A;)a=!0,n.push(i[s].toString()),s++;for(;r(i[s]);)n.push(i[s].toString().toLowerCase()),s++;for(;s<i.length;s++)n.push(i[s].toString());return n=n.join(""),e||a||(n=t+"://"+n),n},hasProtocol:function(){return this.v[0]instanceof w}}),bt=Object.freeze({Base:mt,MAILTOEMAIL:_t,EMAIL:Lt,NL:yt,TEXT:vt,URL:Et}),wt=function(t){return new g(t)},St=wt(),Tt=wt(),At=wt(),Nt=wt(),kt=wt(),Ot=wt(),It=wt(),xt=wt(Et),Mt=wt(),Pt=wt(Et),Rt=wt(Et),Dt=wt(),Bt=wt(),Ht=wt(),Ft=wt(),Gt=wt(),Ut=wt(Et),jt=wt(Et),$t=wt(Et),Wt=wt(Et),qt=wt(),Vt=wt(),Kt=wt(),Yt=wt(),zt=wt(),Jt=wt(),Xt=wt(Lt),Zt=wt(),Qt=wt(Lt),te=wt(_t),ee=wt(),ae=wt(),ie=wt(),ne=wt(),se=wt(yt);St.on(v,se).on(w,Tt).on(S,At).on(A,Nt),Tt.on(A,Nt),Nt.on(A,kt),St.on(O,Ot).on(C,Ot).on(L,xt).on(y,Ot),kt.on(O,Rt).on(C,Rt).on(y,Rt).on(L,Rt),Ot.on(m,It),zt.on(m,Jt),It.on(O,xt).on(C,Ot).on(y,Ot).on(L,Ot),Jt.on(O,Xt).on(C,zt).on(y,zt).on(L,zt),xt.on(m,It),Xt.on(m,Jt),xt.on(p,Mt).on(A,Rt),Mt.on(y,Pt),Pt.on(A,Rt),Xt.on(p,Zt),Zt.on(y,Qt);var oe=[C,f,L,y,E,b,w,A,O,N,k,G],re=[p,m,T,_,D,B,H,F,x,M,P,R];Rt.on(x,Bt).on(M,Ht).on(P,Ft).on(R,Gt),Dt.on(x,Bt).on(M,Ht).on(P,Ft).on(R,Gt),Bt.on(D,Rt),Ht.on(B,Rt),Ft.on(H,Rt),Gt.on(F,Rt),Ut.on(D,Rt),jt.on(B,Rt),$t.on(H,Rt),Wt.on(F,Rt),qt.on(D,Rt),Vt.on(B,Rt),Kt.on(H,Rt),Yt.on(F,Rt),Bt.on(oe,Ut),Ht.on(oe,jt),Ft.on(oe,$t),Gt.on(oe,Wt),Bt.on(re,qt),Ht.on(re,Vt),Ft.on(re,Kt),Gt.on(re,Yt),Ut.on(oe,Ut),jt.on(oe,jt),$t.on(oe,$t),Wt.on(oe,Wt),Ut.on(re,Ut),jt.on(re,jt),$t.on(re,$t),Wt.on(re,Wt),qt.on(oe,Ut),Vt.on(oe,jt),Kt.on(oe,$t),Yt.on(oe,Wt),qt.on(re,qt),Vt.on(re,Vt),Kt.on(re,Kt),Yt.on(re,Yt),Rt.on(oe,Rt),Dt.on(oe,Rt),Rt.on(re,Dt),Dt.on(re,Dt),At.on(O,te).on(C,te).on(y,te).on(L,te),te.on(oe,te).on(re,ee),ee.on(oe,te).on(re,ee);var de=[C,y,E,b,T,N,k,G,O];Ot.on(de,ae).on(f,ie),xt.on(de,ae).on(f,ie),It.on(de,ae),ae.on(de,ae).on(f,ie).on(m,ne),ne.on(de,ae),ie.on(O,zt).on(C,zt).on(L,Xt);var ce=function(t){for(var e=t.length,a=0,i=[],n=[];a<e;){for(var s=St,o=null,r=null,d=0,c=null,l=-1;a<e&&!(o=s.next(t[a]));)n.push(t[a++]);for(;a<e&&(r=o||s.next(t[a]));)o=null,(s=r).accepts()?(l=0,c=s):l>=0&&l++,a++,d++;if(l<0)for(var h=a-d;h<a;h++)n.push(t[h]);else{n.length>0&&(i.push(new vt(n)),n=[]),a-=l,d-=l;var g=c.emit();i.push(new g(t.slice(a-d,a)))}}return n.length>0&&i.push(new vt(n)),i},le=Object.freeze({State:g,TOKENS:bt,run:ce,start:St});Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var he=function(t){return ce(Ct(t))};e.find=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=he(t),i=[],n=0;n<a.length;n++){var s=a[n];!s.isLink||e&&s.type!==e||i.push(s.toObject())}return i},e.inherits=a,e.options=c,e.parser=le,e.scanner=pt,e.test=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=he(t);return 1===a.length&&a[0].isLink&&(!e||a[0].type===e)},e.tokenize=he}(self.linkify=self.linkify||{})}();class BaseHelper{checkStoreExpired(t){return this.diffDateDay(new Date,new Date(t))>0}addHour(t,e){return t.setTime(t.getTime()+60*e*60*1e3),t}getAllImages(t){const e=[],a=[],i=[];let n;const s=/<img[^>]+src="?([^"\s]+)"?\s*/gi;for(;n=s.exec(t);)i.push(n[1]);return i.forEach((function(t){const i=t.replace("/s500x500","");e.push(i),a.push(t.split("/").pop())})),{urls:e,names:a}}escapeHTML(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\'/g,"&#39;").replace(/\//g,"&#x2F;")}checkUserInfo(){const t=!LadiChat.storeConfig.user_info.email||LadiChat.storeConfig.user_info.email&&""==LadiChat.storeConfig.user_info.email.trim(),e=!LadiChat.storeConfig.user_info.phone||LadiChat.storeConfig.user_info.phone&&""==LadiChat.storeConfig.user_info.phone.trim();return!t||!e}playSound(t){try{new Audio(t).play()}catch(t){console.log(t)}}detectMobile(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}objectWithoutProperties(t,e){var a={};for(var i in t)e.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(t,i)&&(a[i]=t[i]);return a}easeInOutQuad(t,e,a,i){return(t/=i/2)<1?a/2*t*t+e:-a/2*(--t*(t-2)-1)+e}getAllElementByID(t,e){var a=document.getElementById(e),i=a?a.parentNode:{};return i.id&&i.id===t?a:{}}getLocalStorage(t){return JSON.parse(window.localStorage.getItem(t))}setLocalStorage(t,e){window.localStorage.setItem(t,JSON.stringify(e))}generateText(t){const e=["a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m","q","w","e","r","t","y","u","i","o","p","1","2","3","4","5","6","7","8","9","0","_","-","Z","X","C","V","B","N","M","L","K","J","H","G","F","D","S","A","Q","W","E","R","T","Y","U","I","O","P"];let a="";for(let i=0;i<t;i++)a+=e[Math.floor(Math.random()*e.length)];return a}pasteHtmlAtCaret(t){var e,a;if(window.getSelection){if((e=window.getSelection()).getRangeAt&&e.rangeCount){(a=e.getRangeAt(0)).deleteContents();var i=document.createElement("div");i.innerHTML=t;for(var n,s,o=document.createDocumentFragment();n=i.firstChild;)s=o.appendChild(n);a.insertNode(o),s&&((a=a.cloneRange()).setStartAfter(s),a.collapse(!0),e.removeAllRanges(),e.addRange(a))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(t)}scrollTo(t,e,a){try{var i=t.scrollTop,n=e-i,s=0;!function e(){s+=20;var o=Math.easeInOutQuad(s,i,n,a);t.scrollTop=o,s<a&&setTimeout(e,20)}()}catch(t){console.log(t)}}containsEmailOrPhone(t){const e=new RegExp(/[\+]?\d{10}|\(\d{3}\)\s?-\d{6}/),a=new RegExp(/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/);return{phones:t.match(e),emails:t.match(a)}}validateEmail(t){return t=t.trim(),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}validPhone(t){return t=t.trim(),/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(String(t).toLowerCase())}openInNewTab(t){window.open(t,"_blank").focus()}isElementInViewport(t){if(!t||!t.getBoundingClientRect())return!1;var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}findGetParameter(){return new URL(window.location.href).searchParams}getFormDataUpload(t,e){const a=new FormData;if(t.length>LadiChat_Config.SHARE_MEDIA.IMAGE_COUNT_ALLOW)return LadiChat.toastr("error","",LadiChat_Config.MESSAGE_CONFIG.IMAGE_OVER_COUNT),!1;for(let e=0;e<t.length;e++){const i=t[e];if(i.size/1024/1024>LadiChat_Config.SHARE_MEDIA.IMAGE_SIZE_ALLOW)return LadiChat.toastr("error","",LadiChat_Config.MESSAGE_CONFIG.IMAGE_OVER_SIZE),!1;a.append("files",i,i.name)}return a.append("json_data",JSON.stringify({ladi_app:"LADICHAT",file_type:e})),a}async sendRequest(t,e,a,i,n){try{return new Promise((function(s,o){const r=new XMLHttpRequest;try{r.onreadystatechange=function(){4==r.readyState&&s(r.responseText)},r.open(t,e,i),"function"!=typeof n&&!(n instanceof Array)&&n instanceof Object&&Object.keys(n).forEach((function(t){r.setRequestHeader(t,n[t])})),r.send(a)}catch(t){o(t)}}))}catch(t){console.log(t)}}async getSdk(t){try{return new Promise((function(e,a){try{var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&e(i.responseText)},i.send()}catch(t){console.log(t),a(t)}}))}catch(t){return console.log(t),!1}}getLanguageStyle(){try{let t="";for(let e=0;e<LadiChat.storeConfig.listLanguage.length;e++){let a=LadiChat.storeConfig.listLanguage[e],i=a.dataJson;const n=JSON.parse(i.widget_config),s=n.header_color,o=n.text_color,r=s.split(", rgb"),d=("rgb"+r[2]).replace("))",")");t+=`\n                .color-text-${a.code}{\n                    color: ${o} !important;\n                }\n                .color-text-and-background-${a.code} {\n                    background: ${s} !important;\n                    color: ${o} !important;\n                }\n                .color-background-${a.code} {\n                    background: ${s} !important;\n                }\n                .color-button-text-background-${a.code} {\n                    background: ${d} !important;\n                    color: ${o} !important;\n                }\n                .color-btn-text-${a.code} {\n                    color: ${o} !important;\n                }`;let c=s.replace("),",", 0.05),");c=c.replace("))",", 0.1))"),t+=`\n                .color-background-50-${a.code}{\n                    background: ${c}\n                } `;let l=("rgb"+r[2]).replace("))",", 0.15)");t+=`\n                .color-send-text-${a.code}{\n                    background: ${l}  !important;\n                }\n                `;let h=("rgb"+r[2]).replace("))",", 0.8)");t+=` .color-recieve-text-${a.code}{\n                    background: ${h}  !important;\n                    color: ${o} !important;\n                }`}return t}catch(t){console.log(t)}}hexToRgbA(t){var e;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return 3==(e=t.substring(1).split("")).length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),"rgba("+[(e="0x"+e.join(""))>>16&255,e>>8&255,255&e].join(",")+",1)";throw new Error("Bad Hex")}getApplyStyle(t){const e=t.header_color,a=t.text_color;let i="";if(e.indexOf("rgb")>=0){const t=e.split(", rgb"),n=("rgb"+t[2]).replace("))",")");i=`\n            .fab {\n                background: ${e} !important;\n            }\n            .ladichat-widget-header {\n                background: ${e} !important;\n                color: ${a} !important;\n            }\n            .ladichat-startpage .header-welcome .intro-text p{ \n                color: ${a} !important;\n            }\n            .ladichat-startpage .intro-store{ \n                color: ${a} !important;\n            }\n            #slider span{\n                color: ${a} !important;\n            }\n            .button-new-conversation ,.button-new-conversation-conv{\n                background: ${n} !important;\n                color: ${a} !important;\n            }\n            .ladichat-form #button-submit-form {\n                background: ${n} !important;\n                color: ${a} !important;\n            }\n            #view-all-conversation {\n                ${n} !important;\n            }\n            `;let s=e.replace("),",", 0.05),");s=s.replace("))",", 0.1))"),i+=`.conversation-item.selected ,.conversation-item:hover  {\n                background: ${s}\n            }`,i+=`.ladichat-startpage .header-background{\n                background: ${e}\n            }`,("rgb"+t[2]).replace("))",", 1)"),i+=`.ladichat-msg-sent-text{\n                \n                color: ${a} !important;\n            }`}else{i=`\n            .fab {\n                background: ${e} !important;\n            }\n            .ladichat-widget-header {\n                background: ${e} !important;\n                color: ${a} !important;\n            }\n            .ladichat-startpage .header-welcome .intro-text p{ \n                color: ${a} !important;\n            }\n            .ladichat-startpage .intro-store{ \n                color: ${a} !important;\n            }\n            #slider span{\n                color: ${a} !important;\n            }\n            .button-new-conversation ,.button-new-conversation-conv{\n                background: ${e} !important;\n                color: ${a} !important;\n            }\n            .ladichat-form #button-submit-form {\n                background: ${e} !important;\n                color: ${a} !important;\n            }\n            #view-all-conversation {\n                ${e} !important;\n            }\n            .form-desc {\n                color: ${a} !important;\n            }\n            `;let t=this.hexToRgbA(e).replace(",1)",", 0.1)");t=t.replace(",1)",", 0.1)"),i+=`.conversation-item.selected ,.conversation-item:hover  {\n                background: ${t}\n            }`,i+=`.ladichat-startpage .header-background{\n                background: ${e}\n            }`,i+=`.ladichat-msg-sent-text{\n                background: ${this.hexToRgbA(e).replace(",1)",", 1 )")}  !important;\n                color: ${a} !important;\n            }`}const n=t.background_image||"";return n&&""!=n&&(i+=`.header-start-page {\n                background-image: url('${n}')\n            }\n            .header-background{\n                opacity: 0.6;\n            }`),i+="right"==t.button_position?".ladichat-wrap-btn-widget {\n                right: 0;\n                left: unset\n            }":".ladichat-wrap-btn-widget {\n                left: 0;\n                right: unset\n            }",i}getBlobURL(t,e){const a=new Blob([t],{type:e});return URL.createObjectURL(a)}getGeneratedPageURL({html:t,cssURL:e}){return getBlobURL(`\n            <html>\n                <head>\n                ${e&&`<link rel="stylesheet" type="text/css" href="${e}" />`}\n                </head>\n                <body>\n                ${t||""}\n                </body>\n            </html>\n            `,"text/html")}getStaffAvatar(t){const e=document.createElement("div");if(e.setAttribute("class","agent-online"),t.avatar&&""!=t.avatar){const a=document.createElement("img");a.src=t.avatar,e.appendChild(a)}else{const a=document.createElement("span");a.setAttribute("class","no-avatar"),a.innerText=this.getDisplayName(t.name),e.appendChild(a)}return e}getDisplayName(t){return t&&""!=t?(t=this.capitalize(t)).match(/\b(\w)/g).slice(0,2).join(""):""}capitalize(t){for(var e=t.toLowerCase().split(" "),a=0;a<e.length;a++)e[a]=e[a].charAt(0).toUpperCase()+e[a].substring(1);return e.join(" ")}setCookieByPath(t,e,a,i){try{var n="";if(a){var s=new Date;s.setTime(s.getTime()+24*a*60*60*1e3),n="; expires="+s.toUTCString()}e=encodeURIComponent(e),document.cookie=t+"="+(e||"")+n+"; path="+i,"https:"==window.location.protocol&&(document.cookie=t+"="+(e||"")+n+"; SameSite=None; Secure; path="+i)}catch(t){console.log(t)}}setCookie(t,e,a){try{var i="";if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3),i="; expires="+n.toUTCString()}e=encodeURIComponent(e),document.cookie=t+"="+(e||"")+i+"; path=/","https:"==window.location.protocol&&(document.cookie=t+"="+(e||"")+i+"; SameSite=None; Secure; path=/")}catch(t){console.log(t)}}getCookie(t){for(var e=t+"=",a=document.cookie.split(";"),i=0;i<a.length;i++){for(var n=a[i];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return decodeURIComponent(n.substring(e.length,n.length))}return null}uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}diffDateSecond(t,e){return(t.getTime()-e.getTime())/1e3}diffDateMinute(t,e){return(t.getTime()-e.getTime())/1e3/60}diffDateHour(t,e){return(t.getTime()-e.getTime())/1e3/60/60}diffDateDay(t,e){return(t.getTime()-e.getTime())/1e3/84600}diffDateWeek(t,e){return(t.getTime()-e.getTime())/1e3/84600/7}diffDateMonth(t,e){return(t.getTime()-e.getTime())/1e3/84600/7/30}getPrettyDate(t){const e=new Date(t),a=new Date;let i=Math.floor(this.diffDateSecond(a,e));const n=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},{send_right_now:s,second:o,minute:r,hour:d,day:c,week:l,month:h}=n;if(i<60)return i<=10?s||"Mới gửi":i+"&nbsp;"+(o||" giây");let g=Math.floor(this.diffDateMinute(a,e));if(g<60)return i=g%60,g+"&nbsp;"+(r||" phút");let u=Math.floor(this.diffDateHour(a,e));if(u<24)return g%=60,u+"&nbsp;"+(d||" giờ");let C=Math.floor(this.diffDateDay(a,e));if(C<7)return u%=24,C+"&nbsp;"+(c||"ngày");let f=Math.floor(this.diffDateWeek(a,e));return f<4?(C=f%7,f+"&nbsp;"+(l||" tuần")):Math.floor(this.diffDateMonth(a,e))<=0?C+"&nbsp;"+(c||" ngày"):Math.floor(this.diffDateMonth(a,e))+"&nbsp;"+(h||" tháng")}htmlDecode(t){var e=document.createElement("textarea");return e.innerHTML=t,0===e.childNodes.length?"":e.childNodes[0].nodeValue}sortConv(t){return t.sort(((t,e)=>{const a=t.last_action?new Date(t.last_action):new Date(t.updated_at);return(e.last_action?new Date(e.last_action):new Date(e.updated_at)).getTime()-a.getTime()}))}handleChangeMessage(t){const e=this.getLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID);if(e&&""!=e)for(let a=0;a<t.length;a++){const i=t[a];if("SYSTEM"===i.type||"NOTE"===i.type)return;for(let t=0;t<e.length;t++)if(e[t]._id==i.conversation_id){e[t].lastMsg=i,LadiChat_Helper.setLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID,e);break}}}handleChangeConversation(t){t.length>10&&(t=t.sort(((t,e)=>{const a=t.last_action?new Date(t.last_action):new Date(t.updated_at);return(e.last_action?new Date(e.last_action):new Date(e.updated_at)).getTime()-a.getTime()}))).splice(t.length,1),LadiChat_Helper.setLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID,t)}async sendPOSTRequest(t,e,a,i=!1){var n=JSON.stringify(a),s=t+e;return i||(i={"Content-Type":"application/json"}),new Promise((function(t,e){var a=new XMLHttpRequest;try{a.onreadystatechange=function(){if(4==a.readyState){var e={};200==a.status&&(e=JSON.parse(a.responseText)),t(e,a.status)}},a.open("POST",s,!0),"function"!=typeof i&&!(i instanceof Array)&&i instanceof Object&&Object.keys(i).forEach((function(t){a.setRequestHeader(t,i[t])})),a.send(n)}catch(t){e(t)}}))}getJsonData(t){let e=[];var a=t.getElementsByClassName("form-field");for(let t=0;t<a.length;t++){let i=a[t].getElementsByTagName("label")[0],n=a[t].getElementsByTagName("input")[0],s={label:i.textContent,type:n.type,value:n.value};e.push(s)}return e}getInputType(t,e){try{const a=t.type.split(":");let i="";switch(a[0]){case"input":i=document.createElement("input");break;case"textarea":i=document.createElement("textarea");break;case"select":i=document.createElement("select")}switch(i.name=t.alias_name,i.id=t.alias_name+e,i.setAttribute("data-name",t.name),a[0]){case"input":if(t.data_type!=LadiChat_Config.DATA_TYPES.EMAIL.code&&t.data_type!=LadiChat_Config.DATA_TYPES.PHONE.code&&t.data_type!=LadiChat_Config.DATA_TYPES.DATE.code&&t.data_type!=LadiChat_Config.DATA_TYPES.TEXT_INPUT.code&&t.data_type!=LadiChat_Config.DATA_TYPES.NUMBER.code||(i.setAttribute("type",a[1]),t.place_holder&&""!=t.place_holder?i.setAttribute("placeholder",t.place_holder):i.setAttribute("placeholder",t.name),t.default_value&&""!=t.default_value&&i.setAttribute("value",t.default_value),null!=t.is_require&&i.setAttribute("required",t.is_require),t.data_type==LadiChat_Config.DATA_TYPES.PHONE.code&&i.setAttribute("pattern",LadiChat_Config.DATA_TYPES.PHONE.regex),t.data_type==LadiChat_Config.DATA_TYPES.EMAIL.code&&i.setAttribute("pattern",LadiChat_Config.DATA_TYPES.EMAIL.regex),i.setAttribute("class","form-field-data")),t.data_type==LadiChat_Config.DATA_TYPES.CHECK_BOX.code){i=document.createElement("div"),i.setAttribute("class","form-field-checkbox");const e=t.data_values.split("\n"),a=t.default_value;for(let n=0;n<e.length;n++){const s=e[n].split("/"),o=document.createElement("li"),r=document.createElement("input");r.type="checkbox",r.name=t.alias_name,a&&a.length>n&&a[n]&&r.setAttribute("checked","checked"),r.setAttribute("data-name",t.name);const d=document.createElement("label");d.textContent=s[0],r.value=s.length>1?s[1]:s[0],r.setAttribute("class","ladiui checkbox form-checkbox-item"),o.appendChild(r),o.appendChild(d),i.appendChild(o)}}if(t.data_type==LadiChat_Config.DATA_TYPES.RADIO_GROUP.code){i=document.createElement("div"),i.setAttribute("class","form-field-radio");const e=t.data_values.split("\n"),a=t.default_value,n=this.generateText(3);for(let s=0;s<e.length;s++){const o=e[s].split("/"),r=document.createElement("li"),d=document.createElement("input");d.type="radio",d.setAttribute("id","wg-"+t.alias_name+"-"+n+"-"+s),d.setAttribute("group","wg-"+t.alias_name+"-"+n),a&&a.length>s&&a[s]&&d.setAttribute("checked","checked"),a||0!=s||d.setAttribute("checked","checked");const c=document.createElement("label");c.setAttribute("for","wg-"+t.alias_name+"-"+s),c.textContent=o[0],d.value=o.length>1?o[1]:o[0],d.name=t.alias_name,d.setAttribute("class","ladiui checkbox form-checkbox-item"),r.appendChild(d),r.appendChild(c),i.appendChild(r)}}break;case"textarea":t.place_holder&&""!=t.place_holder&&(i.placeholder=t.place_holder),t.default_value&&""!=t.default_value&&(i.defaultValue=t.default_value),null!=t.is_require&&(i.required=t.is_require),i.setAttribute("class","form-field-data");break;case"select":const e=t.data_values.split("\n");for(let a=0;a<e.length;a++){const n=e[a].split("/"),s=document.createElement("option");s.text=n[0],s.value=n.length>1?n[1]:n[0],(t.default_value&&""!=t.default_value&&s.value.toLowerCase()==t.default_value.toLowerCase()||0==a)&&s.setAttribute("selected","selected"),i.appendChild(s)}i.setAttribute("class","form-field-data")}return i.outerHTML}catch(t){console.log(t)}}getInputTypeByForm(t,e){try{const a=e.type.split(":");let i="";switch(a[0]){case"input":i=document.createElement("input");break;case"textarea":i=document.createElement("textarea");break;case"select":i=document.createElement("select")}i.name=e.alias_name,i.id=e.alias_name+t._id,i.setAttribute("data-id",e._id),i.setAttribute("data-name",e.name);let n=e.submit_data||!1;switch(a[0]){case"input":if(e.data_type!=LadiChat_Config.DATA_TYPES.EMAIL.code&&e.data_type!=LadiChat_Config.DATA_TYPES.PHONE.code&&e.data_type!=LadiChat_Config.DATA_TYPES.DATE.code&&e.data_type!=LadiChat_Config.DATA_TYPES.TEXT_INPUT.code&&e.data_type!=LadiChat_Config.DATA_TYPES.NUMBER.code||(i.setAttribute("type",a[1]),e.place_holder&&""!=e.place_holder?i.setAttribute("placeholder",e.place_holder):i.setAttribute("placeholder",e.name),e.default_value&&""!=e.default_value&&i.setAttribute("value",e.default_value),null!=e.is_require&&i.setAttribute("required",e.is_require),e.data_type==LadiChat_Config.DATA_TYPES.PHONE.code&&i.setAttribute("pattern",LadiChat_Config.DATA_TYPES.PHONE.regex),e.data_type==LadiChat_Config.DATA_TYPES.EMAIL.code&&i.setAttribute("pattern",LadiChat_Config.DATA_TYPES.EMAIL.regex),n&&(i.setAttribute("value",n),i.setAttribute("disabled","disabled")),i.setAttribute("class","form-field-data")),e.data_type==LadiChat_Config.DATA_TYPES.CHECK_BOX.code){i=document.createElement("div"),i.setAttribute("class","form-field-checkbox");const t=e.data_values.split("\n"),a=e.default_value;let s=[],o=!1;n&&(s=n,o=!0);for(let n=0;n<t.length;n++){const r=t[n].split("/"),d=document.createElement("li"),c=document.createElement("input");c.type="checkbox",c.name=e.alias_name,a&&a.length>n&&a[n]&&c.setAttribute("checked","checked"),c.setAttribute("data-name",e.name),c.setAttribute("data-id",e._id);const l=document.createElement("label");if(l.textContent=r[0],c.value=r.length>1?r[1]:r[0],c.setAttribute("class","ladiui checkbox form-checkbox-item"),d.appendChild(c),d.appendChild(l),s.length>0)for(let t=0;t<s.length;t++)if(c.value==s[t]){c.setAttribute("checked","checked");break}o&&c.setAttribute("disabled","disabled"),i.appendChild(d)}}if(e.data_type==LadiChat_Config.DATA_TYPES.RADIO_GROUP.code){i=document.createElement("div"),i.setAttribute("class","form-field-radio");const t=e.data_values.split("\n"),a=e.default_value,s=this.generateText(3);let o=[],r=!1;n&&(o=n,r=!0);for(let n=0;n<t.length;n++){const d=t[n].split("/"),c=document.createElement("li"),l=document.createElement("input");l.type="radio",l.setAttribute("id","wg-"+e.alias_name+"-"+s+"-"+n),l.setAttribute("group","wg-"+e.alias_name+"-"+s),a&&a.length>n&&a[n]&&l.setAttribute("checked","checked"),a||0!=n||l.setAttribute("checked","checked"),l.setAttribute("data-id",e._id);const h=document.createElement("label");if(h.setAttribute("for","wg-"+e.alias_name+"-"+s+"-"+n),h.textContent=d[0],l.value=d.length>1?d[1]:d[0],l.name=e.alias_name,l.setAttribute("class","ladiui checkbox form-radio-item"),c.appendChild(l),o.length>0)for(let t=0;t<o.length;t++)if(l.value==o[t]){l.setAttribute("checked","checked");break}r&&l.setAttribute("disabled","disabled"),c.appendChild(h),i.appendChild(c)}}break;case"textarea":const t=document.createTextNode(e.name);e.place_holder&&""!=e.place_holder&&(t.nodeValue=e.place_holder),e.default_value&&""!=e.default_value&&(t.nodeValue=e.default_value),n&&(t.nodeValue=n,i.setAttribute("disabled","disabled")),i.appendChild(t),null!=e.is_require&&(i.required=e.is_require),i.setAttribute("class","form-field-data");break;case"select":const s=e.data_values.split("\n");let o=[],r=!1;n&&(i.setAttribute("value",n),r=!0);for(let t=0;t<s.length;t++){const a=s[t].split("/"),n=document.createElement("option");if(n.text=a[0],n.value=a.length>1?a[1]:a[0],(e.default_value&&""!=e.default_value&&n.value.toLowerCase()==e.default_value.toLowerCase()||0==t)&&n.setAttribute("selected","selected"),o.length>0)for(let t=0;t<o.length;t++)if(n.value==o[t]){n.setAttribute("selected","selected");break}r&&n.setAttribute("disabled","disabled"),i.appendChild(n)}i.setAttribute("class","form-field-data")}return i.outerHTML}catch(t){console.log(t)}}numberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}getCartData(t){try{const a=t.url||"",i=t.order||!1;if(!i)return"";const n=i.reference_no||"",s=i.customer_first_name||"",o=i.billing_phone||"",r=i.customer_email||"",d=t.products||[],c=t.payment_method||"",l=i.discount_code||"",h=i.discount_fee||"",g=i.shipping_fee||"";let u=i.note||"";const C=i.billing_state_name||"",f=i.billing_district_name||"",p=i.billing_ward_name||"",m=i.billing_address||"",{order_details:_,total:L,sub_total:v}=i,y=[];for(let t=0;t<_.length;t++){const e={total:_[t].total,quantity:_[t].quantity,price:_[t].price},a=_[t].product_name.split("-");e.product_name=a.length>0?a[0]:"",e.option_name=a.length>1?a[1]:"";for(let a=0;a<d.length;a++)if(_[t].product_variant_id==d[a].product_variant_id){d[a].image&&""!=d[a].image?e.img_url=LadiChat_Config.SHARE_MEDIA.CND_URL_IMAGE+d[a].image:e.img_url=LadiChat_Config.logoLadiSales,y.push(e);break}}let E=document.createElement("div");E.setAttribute("class","ladisale-cart");let b=document.createElement("div");b.setAttribute("class","title-cart-1"),b.innerText="Thông tin đơn hàng";let w=document.createElement("b");w.setAttribute("class","reference-no"),w.innerText=" #"+n,b.appendChild(w),E.appendChild(b);let S=document.createElement("p");S.setAttribute("class","title-cart"),S.innerText="Thông tin đặt hàng",E.appendChild(S);let T="",A="";s&&(T+=s),T.length>0&&o&&(T+=" - "),o&&(T+=o),T.length>0&&r&&(T+=" - "),r&&(T+=r),m&&(A+=m),A.length>0&&p&&(A+=", "),p&&(A+=p),A.length>0&&f&&(A+=", "),f&&(A+=f),A.length>0&&C&&(A+=", "),C&&(A+=C);let N=document.createElement("p");N.setAttribute("class","cart-userinfo"),N.innerText=T,E.appendChild(N);let k=document.createElement("p");k.setAttribute("class","cart-userinfo"),k.innerText=A,E.appendChild(k);let O=document.createElement("hr");E.appendChild(O);let I=document.createElement("p");I.setAttribute("class","title-cart"),I.innerText="Chi tiết đơn hàng",E.appendChild(I);let x=document.createElement("div");x.setAttribute("class","list-product-cart");for(let t=0;t<y.length;t++){let e=document.createElement("div");e.setAttribute("class","product");let a=document.createElement("div");a.setAttribute("class","product-detail");let i=document.createElement("image");i.setAttribute("src",y[t].img_url),a.appendChild(i);let n=document.createElement("div"),s=document.createElement("p");s.setAttribute("class","product-name"),s.innerText=y[t].product_name,n.appendChild(s);let o=document.createElement("p");o.setAttribute("class","variant-name"),o.innerText=y[t].option_name,n.appendChild(o),a.appendChild(n),e.appendChild(a);let r=document.createElement("div");r.setAttribute("class","price-detail");let d=document.createElement("p");d.setAttribute("class","variant-price"),d.innerText=this.numberToCurrencyStyle(y[t].price,".","đ"),r.appendChild(d);let c=document.createElement("p");c.setAttribute("class","variant-total"),c.innerText=this.numberToCurrencyStyle(y[t].total,".","đ"),r.appendChild(c),e.appendChild(r);let l=document.createElement("p");l.setAttribute("class","variant-quantity"),l.innerText="x"+y[t].quantity,e.appendChild(l),x.appendChild(e)}E.appendChild(x);let M=document.createElement("hr");E.appendChild(M);let P=document.createElement("div");P.setAttribute("class","flex-line"),P.innerHTML=`<p>Tổng tiền sản phẩm</p><p>${v?this.numberToCurrencyStyle(v,".","đ"):"0đ"}</p>`,E.appendChild(P);let R=document.createElement("div");if(R.setAttribute("class","flex-line"),R.innerHTML=`<p>Giảm giá ${l?"("+l+")":""}</p><p class="discount-value">${h?this.numberToCurrencyStyle(-h,".","đ"):"0đ"}</p>`,E.appendChild(R),g){let t=document.createElement("div");t.setAttribute("class","flex-line"),t.innerHTML=`<p>Phí vận chuyển </p><p>${g?this.numberToCurrencyStyle(g,".","đ"):"Chưa xác định"}</p>`,E.appendChild(t)}let D=document.createElement("div");D.setAttribute("class","flex-line"),D.innerHTML=`<p>Phương thức thanh toán </p><p>${LadiChat_Config.PAYMENT_METHOD[c].name}</p>`,E.appendChild(D);let B=document.createElement("hr");E.appendChild(B);let H=document.createElement("div");if(H.setAttribute("class","flex-line total-cart"),H.innerHTML=`<p>${g?"Tổng thanh toán":"Tổng thanh toán tạm tính"} </p><p>${L?this.numberToCurrencyStyle(L,".")+"đ":"0đ"}</p>`,E.appendChild(H),""==!u.trim()){let t=document.createElement("p");t.setAttribute("class","note-content");let a=document.createElement("span");a.setAttribute("class","note-title"),a.innerText="Ghi chú: ",t.appendChild(a);var e=document.createTextNode(u);t.appendChild(e),E.appendChild(t)}let F=document.createElement("a");F.setAttribute("class","btn-redirect "+c),F.setAttribute("href",a),F.setAttribute("target","_blank");let G=document.createElement("p");return G.innerText=LadiChat_Config.PAYMENT_METHOD[c].title,F.appendChild(G),E.appendChild(F),E.outerHTML}catch(t){console.log(t)}}numberToCurrencyStyle(t,e=",",a=""){return`${t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,e)}${a}`}getFormHTML(t){try{let e="";void 0!==t.disable_form&&null!==t.disable_form&&(e=t.disable_form?'disabled="true"':"");let a="";t.description&&""!=t.description.trim()&&(a+=`<div>${t.description}</div>`),a+=`<div class="ladichat-form-wrapper" id="${t._id}"><div class="ladichat-form" id="submited-form">`;let i="";if(t.form_fields&&t.form_fields.length>0){for(let e=0;e<t.form_fields.length;e++){const i=t.form_fields[e],n=this.getInputTypeByForm(t,i);let s=`<div class="form-field"><label>${i.name}</label>${n}</div>`;i.type!=LadiChat_Config.DATA_TYPES.RADIO_GROUP.code&&i.type!=LadiChat_Config.DATA_TYPES.CHECK_BOX.code||(s=`<div class="form-field"><label>${i.place_holder&&""!=i.place_holder?i.place_holder:i.name}</label>${n}</div>`),a+=s}i=`<div class="ladichat-form submit-btn"><span contenteditable="false" class="button-submit-form noselect" id="button-submit-form" data-config-id="${t.form_config_id}" ${e} >${t.button_submit}</span></div>`}return a+="</div></div>",`${a}${i}`}catch(t){console.log(t)}}}class ConfigWidget{constructor(){this.urlIconLanguage="https://w.ladicdn.com/ladichat/language/",this.defaultStaffAvatar="https://w.ladicdn.com/ladichat/big-avatar.png",this.defaultLogo="https://w.ladicdn.com/ladichat/ladipage-logo-color.svg",this.logoPowered="https://w.ladicdn.com/ladiui/icons/ldicon-powered-ladichat.svg",this.soundNotification="https://s.ladicdn.com/source/alert.mp3",this.sdkUrlS3="https://g.ladicdn.com/ladichat-sdk/",this.svgRating={BAD:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g class="nc-icon-wrapper"><path d="M24,46A22,22,0,1,1,46,24,22.025,22.025,0,0,1,24,46Z" fill="#ffd764"></path> <path d="M14,25a3,3,0,1,1,3-3A3,3,0,0,1,14,25Z" fill="#444"></path> <path d="M34,25a3,3,0,1,1,3-3A3,3,0,0,1,34,25Z" fill="#444"></path> <path d="M15.512,38a1,1,0,0,1-.943-1.333,10,10,0,0,1,18.862,0,1,1,0,0,1-1.886.666,8,8,0,0,0-15.09,0A1,1,0,0,1,15.512,38Z" fill="#444"></path></g></svg>',NORMAL:' <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g class="nc-icon-wrapper"><path d="M24,46A22,22,0,1,1,46,24,22.025,22.025,0,0,1,24,46Z" fill="#ffd764"></path> <path d="M14,25a3,3,0,1,1,3-3A3,3,0,0,1,14,25Z" fill="#444"></path> <path d="M34,25a3,3,0,1,1,3-3A3,3,0,0,1,34,25Z" fill="#444"></path> <path d="M31,37H17a1,1,0,0,1,0-2H31a1,1,0,0,1,0,2Z" fill="#444"></path></g></svg>',GOOD:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><g class="nc-icon-wrapper"><path d="M24,46A22,22,0,1,1,46,24,22.025,22.025,0,0,1,24,46Z" fill="#ffd764"></path> <circle cx="38" cy="28" r="3" fill="#e86c60" opacity="0.5"></circle> <circle cx="10" cy="28" r="3" fill="#e86c60" opacity="0.5"></circle> <path d="M19,24a1,1,0,0,1-1-1,2,2,0,0,0-4,0,1,1,0,0,1-2,0,4,4,0,0,1,8,0A1,1,0,0,1,19,24Z" fill="#444"></path> <path d="M35,24a1,1,0,0,1-1-1,2,2,0,0,0-4,0,1,1,0,0,1-2,0,4,4,0,0,1,8,0A1,1,0,0,1,35,24Z" fill="#444"></path> <path d="M24.059,39a9.025,9.025,0,0,1-7.81-4.537,1,1,0,0,1,1.736-.994,6.989,6.989,0,0,0,12.147,0,1,1,0,0,1,1.736.994A9.024,9.024,0,0,1,24.059,39Z" fill="#444"></path></g></svg>'},this.iconPathUrl="https://w.ladicdn.com/ladiui/ladichat/icons/icon-widget-",this.iconTicketSuccessUrl="https://w.ladicdn.com/ladiui/icons/ldicon-circle-check.svg",this.logoLadiSales="https://w.ladicdn.com/source/v3/icon_ladisales_origin.svg",this.defaultStartPageConfig={is_enable:!0,survey_title:"Hãy giới thiệu về bạn:",survey_enable:!0,survey_data:{name:{is_selected:!0,label:"Tên",place_holder:"Nhập tên"},email:{is_selected:!0,label:"Email",place_holder:"Nhập email"},phone:{is_selected:!0,label:"Số điện thoại",place_holder:"Nhập số điện thoại"}},introduce_text:"Nền tảng thiết kế LandingPage hàng đầu thế giới",logo_img:"https://w.ladicdn.com/ladichat/ladipage-logo-color.svg",article_enable:!1,article_data:[],start_conversation:{list_message:[],action_button:"Trả lời",template_id:"STARTED",from_time:3,to_time:10},enable_start_conversation:!1},this.defaultConversationPageConfig={button_create_conversation:"Tạo hội thoại mới",header_name:"Cuộc trò chuyện của bạn"},this.SHARE_MEDIA={CND_URL_IMAGE:"https://w.ladicdn.com/s500x500/",CND_URL_IMAGE_GIF:"https://w.ladicdn.com/",CND_URL_DOCUMENT:"https://s.ladicdn.com/",IMAGE:"IMAGE",VIDEO:"VIDEO",DOCUMENT:"DOCUMENT",EMOJI:"EMOJI",GIFS:"GIFS",IMAGE_SIZE_ALLOW:5,IMAGE_COUNT_ALLOW:10},this.API_VERSION="1.0",this.API_ROUTE={NEW_SESSION:`/${this.API_VERSION}/auth/new-session`,MY_INFO:`/${this.API_VERSION}/auth/my-info`,SEND_SURVEY_DATA:`/${this.API_VERSION}/auth/survey`,LIST_CONVERSATION:`/${this.API_VERSION}/conversation/list-by-user`,RATE_CONVERSATION:`/${this.API_VERSION}/conversation/rate-conversation`,LIST_MESSAGE:`/${this.API_VERSION}/message/list-by-user`,UNREAD_MESSAGE:`/${this.API_VERSION}/message/user-unread`,USER_READ_MESSAGE:`/${this.API_VERSION}/message/user-read`,CREATE_START_MESSAGE:`/${this.API_VERSION}/message/send-created-started`,GET_CONFIG:`/${this.API_VERSION}/store/get-config`,SEND_MESSAGE:`/${this.API_VERSION}/message/create`,SEND_FORM_SUCCESS:`/${this.API_VERSION}/message/submit-form-success`,SYNC_USER_FIELD:`/${this.API_VERSION}/form/sync-user-field`,CUSTOM_COMMAND:`/${this.API_VERSION}/auth/sdk-command`,CUSTOM_MULTI_COMMAND:`/${this.API_VERSION}/auth/sdk-multi-command`,CREATE_START_CONVERSATION:`/${this.API_VERSION}/conversation/create-by-template`,LIST_ARTICLE:`/${this.API_VERSION}/article/list-by-user`,SHOW_FORM:`/${this.API_VERSION}/form/show`,CREATE_INLINE_FORM:`/${this.API_VERSION}/conversation/create-by-form-inline`,GET_DISTRICT:`/${this.API_VERSION}/cart/get-district`,SEND_POSTBACK_BTN:`/${this.API_VERSION}/trigger/send-postback-btn`,ACTION_MESSAGE_BUTTON:`/${this.API_VERSION}/message/action-message-button`,CREATE_TICKET:`/${this.API_VERSION}/ticket/user-create`,START_TRIGER:`/${this.API_VERSION}/start-trigger`},this.EXPRIRE_TOKEN=30,this.SOCKET_EVENT={DELETED_MESSAGE:"DELETED_MESSAGE",SUBSCRIBE_CONVERSATION:"SUBSCRIBE_CONVERSATION",ON_TYPING:"ON_TYPING",ON_TYPING_CHANGE_MSG:"ON_TYPING_CHANGE_MSG",END_TYPING:"END_TYPING",READ_MESSAGE:"READ_MESSAGE",PREVIEW_TRIGGER:"PREVIEW_TRIGGER",CHANGE_MESSAGE:"CHANGE_MESSAGE",REOPEN_CONVERSATION:"REOPEN_CONVERSATION",CLOSE_CONVERSATION:"CLOSE_CONVERSATION",NEW_MESSAGE:"NEW_MESSAGE",NEW_CONVERSATION:"NEW_CONVERSATION",ASSIGN_CONVERSATION:"ASSIGN_CONVERSATION",CONVERSATION_CHANGE_STATE:"CONVERSATION_CHANGE_STATE",CONVERSATION_RATING:"CONVERSATION_RATING"},this.MESSAGE_CONFIG={IMAGE_OVER_SIZE:"Hãy chọn ảnh hoặc file có kích thước tối hơn 5MB",IMAGE_OVER_COUNT:"Vui lòng chọn dưới 10 file."},this.LADI_CLIENT_ID="LADI_CLIENT_ID",this.SESSION_KEY="s_key_",this.SESSION_ID="s_id_",this.USER_INFO_COOKIE="u_inf_",this.STORE_CONFIG_COOKIE="s_conf_",this.LIST_CONVERSATION="s_conv_list",this.SCREEN_NAME={START_PAGE:"START_PAGE",SURVEY_PAGE:"SURVEY",LIST_CONVERSATION_PAGE:"LIST_CONVERSATION_PAGE",MESSENGER_PAGE:"MESSENGER_PAGE",FORM_POPUP:"FORM_POPUP",FORM_TICKET:"FORM_TICKET"},this.USER_EVENT={PAGE_VIEW:"PAGE_VIEW",SUBMIT_SURVEY:"SUBMIT_SURVEY",START_CONVERSATION:"START_CONVERSATION",PURCHASED:"PURCHASED"},this.STAFF_STATUS={OFFLINE:"OFFLINE",ONLINE:"ONLINE",AWAY:"AWAY"},this.TYPE_FORM={INLINE:"INLINE",POPUP:"POPUP"},this.DATA_TYPES={EMAIL:{type:"input:email",code:"EMAIL",name:"Email",regex:"[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}"},PHONE:{type:"input:number",code:"PHONE",name:"Số điện thoại",regex:"[0-9]{5,14}$"},TEXT_INPUT:{type:"input:text",code:"TEXT_INPUT",name:"Text input",holder:"Nhập kí tự hoặc chuỗi"},TEXT_AREA:{type:"textarea:text",code:"TEXT_AREA",name:"Text area",holder:"Nhập kí tự hoặc chuỗi"},NUMBER:{type:"input:number",code:"NUMBER",name:"Number",holder:"Nhập vào 1 số"},DATE:{type:"input:date",code:"DATE",name:"Date",holder:"Lựa chọn ngày"},DROPDOWN:{type:"select:option",code:"DROPDOWN",name:"Dropdown"},RADIO_GROUP:{type:"input:radio",code:"RADIO_GROUP",name:"Radio"},CHECK_BOX:{type:"input:checkbox",code:"CHECK_BOX",name:"Checkbox"}},this.METADATA_OBJECT={LADI_CHAT_FORM:"LADI_CHAT_FORM",LADI_SALES:"LADI_SALES"},this.MESSAGE_TEMPLATE_TYPE={TEXT:"TEXT",QUICK_REPLY:"QUICK_REPLY"},this.PAYMENT_METHOD={COD:{name:"COD",title:"Chi tiết đơn hàng"},ONLINE:{name:"Trực tuyến",title:"Thanh toán đơn hàng"},BANK:{name:"Chuyển khoản",title:"Xem thông tin chuyển khoản"}},this.FLOW_CONFIG={MESSAGE_TYPE:{GENERIC:"GENERIC",TEXT:"TEXT",QUICK_REPLY:"QUICK_REPLY",IMAGE:"IMAGE",FORM:"FORM",GALLERY:"GALLERY",VIDEO:"VIDEO",FILE:"FILE",DELAY:"DELAY",HEADLINE:"HEADLINE",BUTTON:"BUTTON",AUDIO:"AUDIO",DYNAMIC:"DYNAMIC",USER_INPUT:"USER_INPUT",START_FLOW:"START_FLOW",CONDITION:"CONDITION",NEXT_STEP:"NEXT_STEP",NEXT_STEP_CONDITION_IF_NOT:"NEXT_STEP_CONDITION_IF_NOT",SMART_DELAY:"SMART_DELAY",DURATION:"DURATION",DATE:"DATE",PERFORM_ACTIONS:"PERFORM_ACTIONS",OPEN_EMAIL:"OPEN_EMAIL",CLICK_LINK:"CLICK_LINK",SEND_MESSAGE_SUCCESS:"SEND_MESSAGE_SUCCESS",SEND_MESSAGE_FAIL:"SEND_MESSAGE_FAIL",LIST_ZALO:"LIST_ZALO",ANSWER_PHONE:"ANSWER_PHONE",PHONE_BUSY:"PHONE_BUSY",NOT_PICK_UP:"NOT_PICK_UP",AI_CALL:"AI_CALL",ICON:"ICON",ONE_TIME_NOTIFICATION:"ONE_TIME_NOTIFICATION"},BUTTON_TYPE:{MESSAGE:"MESSAGE",REDIRECT:"REDIRECT",OPEN_URL:"URL",OPEN_SMS:"OPEN_SMS",FORM:"FORM",PHONE_CALL:"PHONE",SMS:"SMS",EMAIL:"EMAIL",START_FLOW:"START_FLOW",DEFAULT:"DEFAULT",CONDITION:"CONDITION",SKIP:"SKIP",ZALO:"ZALO",ZALO_CARE:"ZALO_CARE",SMART_DELAY:"SMART_DELAY",PERFORM_ACTIONS:"PERFORM_ACTIONS",OPEN_EMAIL:"OPEN_EMAIL",CLICK_LINK:"CLICK_LINK",AI_CALL:"AI_CALL",INSTAGRAM:"INSTAGRAM",WEB_PUSH_NOTIFICATION:"WEB_PUSH_NOTIFICATION"}},this.LIST_ESCAPE_TAGS=["iframe","script","meta","style"],this.ICON_SIZE={FULL:"FULL",DEFAULT:"DEFAULT"}}getStaffInfo(t,e){let a=null;const{staffs:i}=LadiChat.storeConfig;if(i&&i.length>0)for(let e=0;e<i.length;e++)i[e].ladi_uid==t&&(a=i[e]);return!a&&i.length>0&&(a=i[0]),a}}class ConversationItem{init(t,e,a,i){this.storeConfig=t;const n=this.generateHTMLContent(e,a,i),s=document.createElement("div");s.innerHTML=n.trim();const o=s.firstChild;this.doom_element=o}renderFormContent(t){return`<div class="ladiui form-content-message">\n            <i class="ladiui icon icon-form "></i>\n            <span class="ladiui body-3 secondary-text name-form">${t.name}</span>\n        </div>`}generateHTMLContent(t,e,a){t||(t={name:"Support"});const i=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},n=a?"selected":"";let s=e.lastMsg?e.lastMsg.message:"";s=s.replace(/<div>/gi,"&nbsp;"),s=s.replace(/<br>/gi,"&nbsp;");let o="<div></div>";const r=document.createElement("div");r.innerHTML=s,""==r.innerText&&s.indexOf("<img")>=0&&(o=`[${i.image?i.image:"Hình ảnh"}]`);let d=!1;e.lastMsg.metadata&&(d=JSON.parse(e.lastMsg.metadata));let c=r.getElementsByClassName("ladichat-form-wrapper");for(let t=0;t<c.length;t++){const e=c[t],a=document.createElement("span"),i=document.createTextNode(" [Form] ");a.appendChild(i),e.parentNode.replaceChild(a,e)}o=r.innerText,(s.indexOf("<iframe")>=0||s.indexOf("&lt;iframe")>=0)&&(o=`[${i.link?i.link:"Liên kết"}]`),d&&d.object_type==LadiChat_Config.METADATA_OBJECT.LADI_CHAT_FORM&&(o=this.renderFormContent(d));let l="",h="";e.lastMsg&&e.lastMsg.read_users.indexOf(this.storeConfig.user_info.user_id)<0&&(l=document.createElement("div"),l.setAttribute("class","ladichat-message-unread-badge"),l.setAttribute("id","unread-badge-conv-"+e._id),l=l.outerHTML,h="unread");let g="";g=t.avatar&&""!=t.avatar?`<img src="${t.avatar}"></img>`:'<span class="no-avatar">'+LadiChat_Helper.getDisplayName(t.name)+"</span>";let u="open",C=i.is_opening?i.is_opening:"Đang mở";e.lastMsg&&e.lastMsg.sender_id!=LadiChat.storeConfig.user_info._id&&(u="waiting",C=i.wait_reply?i.wait_reply:"Chờ trả lời"),e.lastMsg&&e.lastMsg.sender_id==LadiChat.storeConfig.user_info._id&&(u="open",C=i.replied?i.replied:"Đã phản hồi"),e.is_open||e.snooze||(u="close",C=i.close_status_1?i.close_status_1:"Đã đóng");const f=e.last_action?LadiChat_Helper.getPrettyDate(e.last_action):LadiChat_Helper.getPrettyDate(e.updated_at),p=` <p class="status ${u}">`+C+" </p>";return"<div id="+e._id+' class="conversation-item '+h+" "+n+`" key="${e.last_action}" > \n                <div class="inbox">\n                    <div class="avatar">`+g+l+'</div>\n                    <div class="detail">\n                    <div class="first-line">\n                        <div class=\'staff-name\'>'+(t&&t.name?t.name:this.storeConfig.store_info.name)+'</div>\n                        <div class="time">'+f+'</div>\n                    </div>\n                    <div class="message">\n                        <div class="content">'+o+" </div>"+p+`<span class="badge-status ${u}"></span></div>\n                    </div>\n                </div>\n            </div>`}}class ConversationPage{init(t,e,a){this.storeConfig=e,this.configConversationPage=e.conversationPage?e.conversationPage:LadiChat_Config.defaultConversationPageConfig;const i=this.generateHTMLContent();this.token=t,this.name=LadiChat_Config.SCREEN_NAME.LIST_CONVERSATION_PAGE,this.doom_element=i,this.socket=a,this.reloadTime()}reloadTime(){const t=this;window.interval_conversationPage_ID&&clearInterval(window.interval_conversationPage_ID),window.interval_conversationPage_ID=setInterval((function(){for(let e=0;e<t.listConversation.length;e++)t.reloadLastMsgTime(t.listConversation[e].lastMsg,t.listConversation[e]._id)}),1e4)}async connectFunc(){await this.getConversation()}removeSocketEvent(){this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.REOPEN_CONVERSATION,this.eventReopenConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CLOSE_CONVERSATION,this.eventClosedConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.removeListener("connect",this.eventConnect)}addSocketEvent(){const t=this;this.eventNewConversation=function(e){t.handlerNewConversation(e)},this.eventNewMessage=function(e){t.handlerNewMessage([e])},this.eventConnect=function(e){t.subscribeAllConversation()},this.eventReopenConversation=function(e){t.handlerReopenConversation(e)},this.eventClosedConversation=function(e){t.handlerClosedConversation(e)},this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.on("connect",this.eventConnect)}handlerReopenConversation(t){for(let e=0;e<LadiChat.listConversation.length;e++)if(t.conversation_id==LadiChat.listConversation[e]._id){LadiChat.listConversation[e].is_open=!0,LadiChat.listConversation[e].rating=null,this.reloadConversation();break}}handlerClosedConversation(t){if(!t.snooze)for(let e=0;e<LadiChat.listConversation.length;e++)if(t.conversation_id==LadiChat.listConversation[e]._id){LadiChat.listConversation[e].is_open=!1,this.reloadConversation();break}}handlerNewMessage(t){try{LadiChat_Helper.handleChangeMessage(t);for(let e=0;e<t.length;e++){const a=t[e];if("SYSTEM"===a.type||"NOTE"===a.type)return;const i=a.conversation_id;for(let t=0;t<this.listConversation.length;t++)this.listConversation[t]._id===i&&(this.listConversation[t].last_action=a.created_at,this.listConversation[t].lastMsg=a,this.reloadLastMsg(a,i),this.reloadLastMsgTime(a,i));this.sortConversation(),this.animateSort()}}catch(t){console.log(t)}}reloadLastMsgTime(t,e){if(!t||!t.created_at)return;const a=this.mainDocument.getElementById(e);if(a){const e=a.getElementsByClassName("time");e.length>0&&(e[0].innerHTML=LadiChat_Helper.getPrettyDate(t.created_at))}}reloadLastMsg(t,e){const a=this.mainDocument.getElementById(e);if(a){const i=a.getElementsByClassName("message");if(i.length>0){const a=i[0];let n=t.message;n=n.replace(/<div>/gi,"&nbsp;"),n=n.replace(/<br>/gi,"&nbsp;");let s="<div></div>";const o=document.createElement("div");o.innerHTML=n,s=o.innerText,""==o.innerText&&n.indexOf("<img")>=0&&(s="[Hình ảnh]");let r=!1;t.read_users.indexOf(this.storeConfig.user_info.user_id)<0&&(r=document.createElement("div"),r.setAttribute("class","ladichat-message-unread-badge"),r.setAttribute("id","unread-badge-conv-"+e)),a.innerHTML='<p class="content">'+s+" </p>"}}}addEvent(t){const e=this;this.mainDocument=t;const a=t.getElementById("back-btn");a&&a.addEventListener("click",(function(){e.removeSocketEvent(),LadiChat.showStartPage(),LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc()})),this.btnNewConversation=t.getElementById("button-new-conversation"),this.btnNewConversation.addEventListener("click",(function(){e.removeSocketEvent(),LadiChat.showConversationStream(null)})),this.addSocketEvent(),this.getConversation()}handlerNewConversation(t){let e=!1;for(let a=0;a<this.listConversation.length;a++)if(this.listConversation[a]._id==t._id){e=!0;break}e||(this.listConversation.push(t),LadiChat_Helper.handleChangeConversation(this.listConversation),this.reloadConversation())}generateHeader(){let t=`<div class="ladichat-widget-header">\n            <div id="back-btn" class="ladichat-widget-header-back-btn">\n                <span>\n                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13"><title>left-arrow-2</title><g fill="#ffffff"><path d="M9.1 12.87l-6.31-6.31 6.31-6.31 1.23 1.14-5.16 5.17 5.16 5.17z" fill="#ffffff"></path></g></svg>\n                </span>\n            </div>\n            <div class="ladichat-widget-header-option">\n                <div id="slider" class="ladichat-widget-header-avatar slide-in">\n                    <span class="ladichat-widget-header-name">${this.configConversationPage.header_name}</span>\n                </div>\n            </div>\n        </div>`;this.storeConfig.startPage;const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}generateHTMLContent(){const t=document.createElement("div"),e=this.generateHeader();t.appendChild(e);const a=document.createElement("div");a.setAttribute("class","ladichat-widget-body conversation"),t.appendChild(a),this.chatWidgetConversationList=document.createElement("div"),this.chatWidgetConversationList.setAttribute("id","ladichat-conversation"),this.chatWidgetConversationList.setAttribute("class","ladichat-conversation"),a.appendChild(this.chatWidgetConversationList);const i=document.createElement("div");i.setAttribute("class","ladichat-widget-footer conversation-page");const n=document.createElement("div");n.setAttribute("class","start-new-conversation");const s=document.createElement("i");s.setAttribute("class","ladiui icon icon-ldp-add"),this.btnNewConversation=document.createElement("span"),this.btnNewConversation.setAttribute("class","button-new-conversation noselect"),this.btnNewConversation.setAttribute("id","button-new-conversation"),this.btnNewConversation.appendChild(s);const o=document.createTextNode(this.configConversationPage.button_create_conversation);return this.btnNewConversation.appendChild(o),n.appendChild(this.btnNewConversation),i.appendChild(n),t.appendChild(i),t}startNewConversation(){}async getConversation(){try{const t=LadiChat_Helper.getLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID),e=!LadiChat.isFirstSession;if(t&&""!=t&&e)this.listConversation=LadiChat_Helper.sortConv(t),this.reloadConversation();else{const t={token:this.token,limit:5},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_CONVERSATION,t);200==e.code&&(this.listConversation=[],this.listConversation=e.data.conversations,LadiChat_Helper.handleChangeConversation(this.listConversation),LadiChat.isFirstSession=!1,this.reloadConversation())}}catch(t){console.log(t)}}async getMessage(t){}selectConversation(t){const e=t.id;for(let t=0;t<this.listConversation.length;t++)e==this.listConversation[t]._id&&(this.currentConversation=this.listConversation[t],LadiChat.showConversationStream(this.currentConversation))}animateSort(){for(let t=0;t<this.listConversation.length;t++){const e=this.mainDocument.getElementById(this.listConversation[t]._id);e&&(e.style.zindex=""+t,e.style.transform=`translateY(${69*t}px)`,e.style.transition="transform 200ms")}}sortConversation(){this.listConversation=this.listConversation.sort((function(t,e){const a=t.lastMsg?new Date(t.lastMsg.created_at):new Date(t.last_action);return(e.lastMsg?new Date(e.lastMsg.created_at):new Date(e.last_action)).getTime()-a.getTime()}))}subscribeAllConversation(){if(this.listConversation&&0!=this.listConversation.length)for(let t=0;t<this.listConversation.length;t++)this.socket.emit(LadiChat_Config.SOCKET_EVENT.SUBSCRIBE_CONVERSATION,this.listConversation[t]._id)}reloadConversation(){if(LadiChat.screen_name!=this.name)return;const t=this;!this.currentConversation&&this.listConversation.length>0&&(this.currentConversation=this.listConversation[0]);const e=this.mainDocument.getElementById("ladichat-conversation");e.innerHTML="",this.sortConversation();for(let a=0;a<this.listConversation.length;a++){this.listConversation[a].lastMsg&&(this.listConversation[a].last_action=this.listConversation[a].lastMsg.created_at);const i=!1,n=LadiChat_Config.getStaffInfo(this.listConversation[a].assign_id,this.storeConfig),s=new ConversationItem;s.init(this.storeConfig,n,this.listConversation[a],i);const o=s.doom_element;o.addEventListener("click",(function(e){t.selectConversation(o)})),this.listConversation[a].widget_element=o,e.appendChild(o)}this.subscribeAllConversation(),this.animateSort()}}class ConversationStream{init(t,e,a,i){try{LadiChat.storeConfig=e,this.configStartPage=e.startPage?e.startPage:LadiChat_Config.defaultStartPageConfig,this.token=t,this.listMessage=[],this.listUnreadMessage=[],this.conversation=i;const n=this.generateHTMLContent();this.doom_element=n,this.socket=a,this.reloadTime(),this.changeTypingContent(),this.timerScroll=null,this.timerTyping=null,this.isTyping=!1,this.lastContent="",this.lastUnread=!1,this.indexShowRead=null,this.timerSearchEmoji=!1,this.listTyping=[],this.name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,this.isCreatingConv=!1,this.isLoadMore=!1,this.timerScroll=null,this.lastMessageID=null,this.hasMore=!0,this.listLoadMore=[],this.IDD=LadiChat_Helper.generateText(5),this.startY=null,this.isNotToken=!1,this.initFinish=!1,this.isCheckingRead=!1}catch(t){console.log(t)}}onWheel(t){if(t.deltaY<0){null!==this.timerScroll&&clearTimeout(this.timerScroll);const t=this.loadMoreEvent.bind(this);this.timerScroll=setTimeout((function(){t()}),100)}}trackScrolling(t){const e=this;null!==this.timerScroll&&(clearTimeout(this.timerScroll),this.timerScroll=null),this.isCheckingRead||(this.isCheckingRead=!0,this.timerScroll=setTimeout((async function(){await e.checkReadMsg(),e.isCheckingRead=!1}),100))}loadMoreEvent(){const t=this.mainDocument.getElementById("load-more-message");this.isLoadMore||LadiChat_Helper.isElementInViewport(t)&&(this.isLoadMore=!0,this.getListMessage())}async checkReadMsg(){const t=this.mainDocument.activeElement;if(!t)return;if("ladichat-typing-message"!=t.id)return;let e=-1;for(let t=this.listMessage.length-1;t>=0;t--)if(this.listMessage[t].read_users.indexOf(LadiChat.storeConfig.user_info.user_id)>=0){e=t;break}if(e>=0)for(let t=e-1;t>=0;t--)if(this.listMessage[t].read_users.indexOf(LadiChat.storeConfig.user_info.user_id)<0){const e={msg_id:this.listMessage[t]._id,user_read_id:LadiChat.storeConfig.user_info.user_id,conversation_id:this.conversation._id,store_id:this.conversation.store_id},a={"content-type":"application/json","session-key":LadiChat.token};let i=await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.USER_READ_MESSAGE,JSON.stringify(e),!0,a);return i=JSON.parse(i),void(i&&200==i.code&&this.listMessage[t].read_users.push(LadiChat.storeConfig.user_info.user_id))}for(let t=0;t<this.listMessage.length;t++)if(this.listMessage[t].read_users.indexOf(LadiChat.storeConfig.user_info.user_id)<0){const e=this.listMessage[t].widget_element;if(e&&LadiChat_Helper.isElementInViewport(e)){const e={msg_id:this.listMessage[t]._id,user_read_id:LadiChat.storeConfig.user_info.user_id,conversation_id:this.conversation._id,store_id:this.conversation.store_id},a={"content-type":"application/json","session-key":LadiChat.token};let i=await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.USER_READ_MESSAGE,JSON.stringify(e),!0,a);i=JSON.parse(i),i&&200==i.code&&this.listMessage[t].read_users.push(LadiChat.storeConfig.user_info.user_id)}}}reloadTime(){const t=this;window.interval_conversationStream_ID&&clearInterval(window.interval_conversationStream_ID),window.interval_conversationStream_ID=setInterval((function(){for(let e=0;e<t.listMessage.length;e++)t.reloadLastMsgTime(t.listMessage[e])}),1e4)}reloadLastMsgTime(t){const e=this.mainDocument.getElementById("datetime-"+t._id);if(e){if("SENT"==t.type){let a=!0;1==t.read_users.length&&(a=!1);const i=t._id==this.indexShowRead,n=""+LadiChat_Helper.getPrettyDate(t.created_at),s=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},o=s.unread_status?s.unread_status:"Chưa xem",r=s.read_status?s.read_status:"Đã xem",d=" - "+(a?r:o);e.innerHTML=`<div class="line">\n                    <span class="ladichat-msg-datetime" id="datetime-${t._id}">\n                    ${n+(i?d:"")} \n                    </span>\n                </div>`}if("RECIEVE"==t.type){const a='"'+new Date(t.created_at).toLocaleString()+'"';e.innerHTML=`<div class="line">\n                    <span class="ladichat-msg-datetime" id="datetime-${t._id}"\n                        data-tooltip=${a}\n                        data-tooltip-position="right">`+LadiChat_Helper.getPrettyDate(t.created_at)+"</span>\n                    </div>\n                </div>"}}}addEvent(t){try{const e=this;this.mainDocument=t,this.conversation&&this.conversation._id&&this.socket.emit(LadiChat_Config.SOCKET_EVENT.SUBSCRIBE_CONVERSATION,this.conversation._id),t.getElementById("back-btn").addEventListener("click",(function(){e.removeSocketEvent(),LadiChat.showStartPage(),LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc()}));const a=t.getElementById("minimize-btn");a.addEventListener("click",(function(){LadiChat.showChatWidget(!0)})),LadiChat.isMobile&&(a.style.display="none"),t.getElementById("ladichat-send-button").addEventListener("click",(function(t){t.preventDefault(),!LadiChat_Helper.checkUserInfo()&&LadiChat.storeConfig.startForm?e.beforeSend():e.sendMessage(),e.inputBoxWigdet.focus()})),this.inputBoxWigdet=t.getElementById("ladichat-typing-message"),this.inputBoxWigdet.addEventListener("keydown",(function(t){13!==(t.keyCode||t.charCode)||t.shiftKey?(e.changeStyleInput(),e.userTyping(),t.stopPropagation()):(t.preventDefault(),!LadiChat_Helper.checkUserInfo()&&LadiChat.storeConfig.startForm?e.beforeSend():e.sendMessage())})),this.inputBoxWigdet.addEventListener("click",(function(t){t.preventDefault(),e.trackScrolling(t)})),this.inputBoxWigdet.addEventListener("paste",(function(a){a.preventDefault();const i=[];let n="";for(let t=0;t<a.clipboardData.items.length;t++){const e=a.clipboardData.items[t];if(0===e.type.indexOf("image")){if(0!=i.length)break;{const t=e.getAsFile();i.push(t)}}0===e.type.indexOf("text")&&(n=a.clipboardData.getData("text"))}i.length>0?e.processChangeFile(i,LadiChat_Config.SHARE_MEDIA.IMAGE):n.length>0&&t.execCommand("insertText",!1,n),e.changeStyleInput()})),this.labelInputImage=t.getElementById("ladichat-send-image"),this.inputImage=t.getElementById("image-upload-message"),this.inputImage.addEventListener("change",(function(t){const a=t.target.files;e.processChangeFile(a,LadiChat_Config.SHARE_MEDIA.IMAGE)})),this.labelInputDocument=t.getElementById("ladichat-send-document"),this.inputDocument=t.getElementById("file-upload-message"),this.inputDocument.addEventListener("change",(function(t){const a=t.target.files;e.processChangeFile(a,LadiChat_Config.SHARE_MEDIA.DOCUMENT)})),this.chatWidgetMessageList=t.getElementById("ladichat-conversation-list-message"),this.chatWidgetMessageList.addEventListener("wheel",(function(t){e.onWheel(t)})),this.chatWidgetMessageList.addEventListener("touchstart",(function(t){e.lastY=t.touches[0].clientY,t.preventDefault(),t.stopPropagation()}),{passive:!0}),this.chatWidgetMessageList.addEventListener("touchmove",(function(t){var a=t.touches[0].clientY,i=a-e.lastY;e.lastY=a,e.chatWidgetMessageList.scrollTop+=-1*i,t.preventDefault(),t.stopPropagation()})),this.preprareEvent(),this.conversation&&0==this.listMessage.length&&this.getListMessage(),this.listMessageScroll=t.getElementById("ladichat-list-msg-scroll"),this.listMessageScroll.addEventListener("scroll",(function(t){e.trackScrolling(t)})),this.labelInputIcon=t.getElementById("ladichat-send-icon"),this.sendIcon=t.getElementById("ladichat-send-icon"),this.sendIcon.addEventListener("click",(function(){e.showEmoji()})),this.emojiModal=t.getElementById("modal-ladichat-emoji"),this.emojiModal.addEventListener("click",(function(t){e.hideEmoji()})),this.emojiModalContent=t.getElementById("ladichat-emoji"),this.emojiModalContent.addEventListener("click",(function(t){return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1})),this.emojiList=t.getElementById("ladichat-emoji-all");const i=this.emojiList.getElementsByClassName("ladichat-emoji-item");for(let t=0;t<i.length;t++){const a=i[t];a.addEventListener("click",(function(){const t=a.getAttribute("data-emoji");e.sendEmoji(t),e.hideEmoji()}))}this.searchEmoji=t.getElementById("search-emoji"),this.searchEmoji.addEventListener("keyup",(function(t){const a=t.currentTarget.value;e.filterEmoji(a)})),this.continueThisConversation=t.getElementById("continue-chat"),this.continueThisConversation.addEventListener("click",(function(t){e.continueChat()})),this.btnNewConversation=t.getElementById("button-new-conversation-conv"),this.btnNewConversation.addEventListener("click",(function(t){e.removeSocketEvent(),LadiChat.showConversationStream()}));const n=t.getElementById("item-rating");if(n){const t=n.getElementsByTagName("span");for(let a=0;a<t.length;a++)t[a].addEventListener("click",(function(t){const a=t.currentTarget.getAttribute("data-rating");a&&""!=a&&e.sendRating(a)}))}this.addQuickReplyEvent()}catch(t){console.log(t)}}async sendRating(t){const e={rating:t,conversation_id:this.conversation._id},a={"content-type":"application/json","session-key":LadiChat.token};await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.RATE_CONVERSATION,JSON.stringify(e),!0,a)}filterEmoji(t){const e=this;for(var a in this.arrayReturn=this.emoji.filterKey(t),this.emojiList.innerHTML="",this.arrayReturn){if(!this.arrayReturn.hasOwnProperty(a))continue;let t=i(a,this.arrayReturn[a]);this.emojiList.appendChild(t)}function i(t,e){const a=`<div class="ladichat-emoji-item" data-emoji="${e}"><span title=${t}>${e}</span></div>`,i=document.createElement("div");return i.innerHTML=a.trim(),i.firstChild}const n=this.emojiList.getElementsByClassName("ladichat-emoji-item");for(let t=0;t<n.length;t++){const a=n[t];a.addEventListener("click",(function(){const t=a.getAttribute("data-emoji");e.sendEmoji(t),e.hideEmoji()}))}}hideEmoji(){this.emojiModal.classList.remove("visible")}showEmoji(){this.sendIcon.getBoundingClientRect(),this.mainDocument.getElementById("ladichat-emoji")&&this.emojiModal.classList.add("visible")}async processChangeFile(t,e){LadiChat.token||(await LadiChat.createNewSession(),this.socket=LadiChat.socket,this.addEventSocket());const a=LadiChat_Helper.getFormDataUpload(t,e);a&&this.uploadCND(a,e),this.resetInput()}async uploadCND(t,e){let a={Accept:"application/json, text/plain, */*",Authorization:LadiChat.token,"store-id":LadiChat.storeID};const i=await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.UPLOAD_ENDPOINT,t,!0,a);let n=JSON.parse(i);200==n.code&&this.sendMessageAttachment(n.data,e),this.resetInput()}async sendMessageAttachment(t,e){const a={"content-type":"application/json","session-key":LadiChat.token};for(let n=0;n<t.length;n++){const s=t[n];let o=document.createElement("div"),r="";const d={images:[],documents:[]};let c="";if(e==LadiChat_Config.SHARE_MEDIA.IMAGE&&(r=s.path.includes(".gif")||s.path.includes(".webp")?LadiChat_Config.SHARE_MEDIA.CND_URL_IMAGE_GIF+s.path:LadiChat_Config.SHARE_MEDIA.CND_URL_IMAGE+s.path,o=document.createElement("img"),o.setAttribute("src",r),d.type=LadiChat_Config.SHARE_MEDIA.IMAGE,d.images.push({url:r,name:s.name}),c="[Image]"),e==LadiChat_Config.SHARE_MEDIA.DOCUMENT){r=LadiChat_Config.SHARE_MEDIA.CND_URL_DOCUMENT+s.path,o=document.createElement("a"),o.setAttribute("href",r),o.setAttribute("target","_blank");const t=document.createElement("i");t.setAttribute("class","ladiui icon icon-attachment"),o.appendChild(t);var i=document.createTextNode(s.name);o.appendChild(i),d.type=LadiChat_Config.SHARE_MEDIA.DOCUMENT,d.documents.push({url:r,name:s.name}),c="[Document]"}const l={message:c,metadata:d};LadiChat.storeConfig.user_info.is_send_first_message||(l.is_send_first_message=!0),this.conversation&&(l.conversation_id=this.conversation._id);const h=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,l,a);if(201==h.code){const t=h.conversation;LadiChat.storeConfig.user_info.current_conversation=t,LadiChat.storeConfig.user_info.is_send_first_message||(LadiChat.storeConfig.user_info.is_send_first_message=!0,"function"==typeof LadiChat.firstMessageCallback&&LadiChat.firstMessageCallback.call()),!LadiChat.storeConfig.user_info||LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&LadiChat.storeConfig.user_info.conversation&&LadiChat.storeConfig.user_info.conversation._id==h.data.conversation._id||(LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.storeConfig.user_info.conversation={_id:this.conversation._id,assign_id:this.conversation.assign_id,store_id:this.conversation.store_id},LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig)}}}resetInput(){this.inputImage.value=""}onPaste(t){t.preventDefault();var e=t.clipboardData.getData("text");this.mainDocument.execCommand("insertText",!1,e)}removeSocketEvent(){this.socket&&(this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CONVERSATION_RATING,this.eventRatingConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.REOPEN_CONVERSATION,this.eventReopenConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CLOSE_CONVERSATION,this.eventClosedConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.DELETED_MESSAGE,this.eventDeleteMessage),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.READ_MESSAGE,this.eventReadMessage),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CHANGE_MESSAGE,this.eventChangeMessage),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.ASSIGN_CONVERSATION,this.eventAssignConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CONVERSATION_CHANGE_STATE,this.eventChangeState))}preprareEvent(){const t=this;this.eventRatingConversation=function(e){t.handlerRatingConversation(e)},this.eventReopenConversation=function(e){t.handlerReopenConversation(e)},this.eventClosedConversation=function(e){t.handlerClosedConversation(e)},this.eventReadMessage=function(e){t.handlerReadMessage(e)},this.eventDeleteMessage=function(e){t.handlerDeleteMessage(e)},this.eventNewMessage=function(e){t.handlerNewMessage([e])},this.eventChangeMessage=function(e){t.handlerChangeMessage(e)},this.eventNewConversation=function(e){t.handlerNewConversation(e)},this.eventAssignConversation=function(e){t.handlerAssignConversation(e)},this.eventChangeState=function(e){t.handlerChangeState(e)},this.addEventSocket()}addEventSocket(){this.socket&&(this.isLoadedSocket=!0,this.socket.on(LadiChat_Config.SOCKET_EVENT.CONVERSATION_RATING,this.eventRatingConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.REOPEN_CONVERSATION,this.eventReopenConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.CLOSE_CONVERSATION,this.eventClosedConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.DELETED_MESSAGE,this.eventDeleteMessage),this.socket.on(LadiChat_Config.SOCKET_EVENT.READ_MESSAGE,this.eventReadMessage),this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.on(LadiChat_Config.SOCKET_EVENT.CHANGE_MESSAGE,this.eventChangeMessage),this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.ASSIGN_CONVERSATION,this.eventAssignConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.CONVERSATION_CHANGE_STATE,this.eventChangeState))}continueChat(){this.mainDocument.getElementById("last-action-state").innerHTML="";const t=this.mainDocument.getElementById("close-state");t&&!t.classList.contains("hide")&&t.classList.add("hide");const e=this.mainDocument.getElementById("ladichat-footer-typing");e&&e.classList.contains("hide")&&e.classList.remove("hide"),this.chatWidgetMessageList.classList.contains("conversation-rating")&&this.chatWidgetMessageList.classList.remove("conversation-rating");const a=this.mainDocument.getElementById("conversation-rating");a&&!a.classList.contains("hide")&&a.classList.add("hide")}activeRatingConversation(){if(!this.conversation)return;if(data.conversation_id!=this.conversation._id)return;const t=this.mainDocument.getElementById("conversation-rating");t&&t.classList.contains("hide")&&t.classList.remove("hide")}handlerRatingConversation(t){try{if(!this.conversation)return;if(t.conversation_id!=this.conversation._id)return;const e=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},a=this.mainDocument.getElementById("conversation-rating");a&&a.classList.contains("hide")&&a.classList.remove("hide"),a.setAttribute("class","done-rating");const i=`<div class="title-rating">${e.thanks_rating?e.thanks_rating:"Cảm ơn bạn đã đánh giá"}</div>\n        <div class="desc-rating">${e.connect_us?e.connect_us:"Hãy luôn kết nối với chúng tôi mọi lúc bạn cần nhé"}</div>`,n="<span>"+LadiChat_Config.svgRating[t.rating]+"</span>";a.innerHTML=i+'<div id="item-rating">'+n+"</div>"}catch(t){console.log(t)}}handlerReopenConversation(t){if(!this.conversation)return;if(t.conversation_id!=this.conversation._id)return;const e=this.mainDocument.getElementById("last-action-state");e.innerHTML="Cuộc chat vừa được mở lại",setTimeout((()=>{e.innerHTML=""}),1500);const a=this.mainDocument.getElementById("ladichat-footer-typing");a&&a.classList.contains("hide")&&a.classList.remove("hide");const i=this.mainDocument.getElementById("close-state");i&&!i.classList.contains("hide")&&i.classList.add("hide"),this.chatWidgetMessageList.classList.contains("conversation-rating")&&this.chatWidgetMessageList.classList.remove("conversation-rating");const n=this.mainDocument.getElementById("conversation-rating");n&&!n.classList.contains("hide")&&n.classList.add("hide")}handlerClosedConversation(t){if(!this.conversation)return;if(t.conversation_id!=this.conversation._id)return;if(t.snooze)return void(this.conversation.snooze=t.snooze);const e=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{};this.mainDocument.getElementById("last-action-state").innerHTML=`<span class="ladichat-system-msg">${e.conversation_close?e.conversation_close:"Cuộc chat đã đóng."}</span>`;const a=this.mainDocument.getElementById("ladichat-footer-typing");a&&!a.classList.contains("hide")&&a.classList.add("hide");const i=this.mainDocument.getElementById("close-state");i&&i.classList.contains("hide")&&i.classList.remove("hide"),this.chatWidgetMessageList.classList.contains("conversation-rating")||this.chatWidgetMessageList.classList.add("conversation-rating");const n=this.mainDocument.getElementById("conversation-rating");n&&n.classList.contains("hide")&&n.classList.remove("hide"),n&&n.classList.contains("done-rating")&&n.classList.remove("done-rating");let s=`<div class="title-rating">${e.rating_title?e.rating_title:"Đánh giá phiên hỗ trợ"}</div>\n        <div class="desc-rating">${e.rating_title?e.rating_content:"Bạn đánh giá thế nào về phiên hỗ trợ này"}</div>`,o='<span data-rating="BAD">'+LadiChat_Config.svgRating.BAD+'</span><span data-rating="NORMAL">'+LadiChat_Config.svgRating.NORMAL+'</span><span data-rating="GOOD">'+LadiChat_Config.svgRating.GOOD+"</span>";n.innerHTML=s+'<div id="item-rating">'+o+"</div>",this.addRatingEvent()}addRatingEvent(){var t=this;const e=this.mainDocument.getElementById("item-rating");if(e){const a=e.getElementsByTagName("span");for(let e=0;e<a.length;e++)a[e].addEventListener("click",(function(e){const a=e.currentTarget.getAttribute("data-rating");a&&""!=a&&t.sendRating(a)}))}}handlerChangeState(t){if(this.conversation&&t.conversation_id==this.conversation._id){const e=this.mainDocument.getElementById("last-action-state");e.innerHTML="",this.conversation.last_state=t;const a=this.generateLastState();e.appendChild(a),this.addQuickReplyEvent()}}handlerAssignConversation(t){if(this.conversation&&t._id==this.conversation._id){this.conversation.assign_id=t.assign_id;const e=this.generateAgent();this.mainDocument.getElementById("ladichat-widget-header-agent").innerHTML=e.firstChild.innerHTML}}handlerNewConversation(t){if(!this.conversation){this.conversation=t;const e=this.mainDocument.getElementById("last-action-state");e.innerHTML="";const a=this.generateLastState();e.appendChild(a);const i=this.generateAgent();this.mainDocument.getElementById("ladichat-widget-header-agent").innerHTML=i.firstChild.innerHTML,this.mainDocument.getElementById("ladichat-widget-header").style.height="68px",this.mainDocument.getElementById("ladichat-conversation-list-message").classList.remove("ladichat-start-conversation"),this.socket.emit(LadiChat_Config.SOCKET_EVENT.SUBSCRIBE_CONVERSATION,this.conversation._id)}let e=!1;for(let a=0;a<LadiChat.listConversation.length;a++)if(LadiChat.listConversation[a]._id==t._id){e=!0;break}e||(LadiChat.listConversation.push(t),LadiChat_Helper.handleChangeConversation(LadiChat.listConversation))}handlerChangeMessage(t){try{if(t.conversation_id==this.conversation._id)for(let e=0;e<this.listMessage.length;e++)if(this.listMessage[e]._id==t.message_id){this.listMessage[e].message=t.new_message,this.reloadMessagesList(!0);break}}catch(t){console.log(t)}}handlerNewMessage(t){try{if(LadiChat_Helper.handleChangeMessage(t),LadiChat.screen_name!=this.name||!this.conversation)return;let e=!1;for(let a=0;a<t.length;a++){const i=t[a];if(this.conversation._id==i.conversation_id){this.mainDocument.getElementById("last-action-state").innerHTML="";let t=!1;for(let e=this.listMessage.length-1;e>=0;e--)this.listMessage[e].msg_tid&&!this.listMessage[e]._id&&this.listMessage[e].msg_tid==i.msg_tid&&(this.listMessage[e].timeoutID&&clearTimeout(this.listMessage[e].timeoutID),this.listMessage[e].timeoutID=null,this.listMessage[e]=i,t=!0);t||this.listMessage.push(i),e=!0}this.conversation._id!=i.conversation_id&&this.mainDocument.getElementById("conv-stream").classList.remove("hidden")}if(e){this.indexShowRead=null;const e=t[0].sender_id==LadiChat.storeConfig.user_info.user_id;this.reloadMessagesList(e)}this.trackScrolling(null)}catch(t){console.log(t)}}handlerDeleteMessage(t){for(let e=0;e<this.listMessage.length;e++)if(this.listMessage[e]._id===t._id&&t.delete_all){this.listMessage.splice(e,1),this.reloadMessagesList();break}}handlerReadMessage(t){let e=!1,a=!1;const i=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{};for(let n=0;n<this.listMessage.length;n++){if(e=new Date(this.listMessage[n].created_at),this.listMessage[n]._id===t._id){a=new Date(this.listMessage[n].created_at),this.listMessage[n].read_users.indexOf(t.user_read_id)<0&&this.listMessage[n].read_users.push(t.user_read_id);const e=this.listMessage[n].widget_element.querySelector("#datetime-"+t._id);e&&"SENT"===this.listMessage[n].type&&(e.innerHTML=`${LadiChat_Helper.getPrettyDate(this.listMessage[n].created_at)} - ${i.read_status?i.read_status:"Đã xem"}`),"SENT"===this.listMessage[n].type&&(this.indexShowRead=this.listMessage[n]._id)}if(a&&e<a){this.listMessage[n].read_users.indexOf(t.user_read_id)<0&&this.listMessage[n].read_users.push(t.user_read_id);const e=this.listMessage[n].widget_element.querySelector("#datetime-"+t._id);e&&"SENT"===this.listMessage[n].type&&(e.innerHTML=`${LadiChat_Helper.getPrettyDate(this.listMessage[n].created_at)} - ${i.read_status?i.read_status:"Đã xem"}`)}}}changeTypingContent(){null!==this.timerTyping&&(clearInterval(this.timerTyping),this.lastContent=""),this.timerTyping=setInterval((function(){if(!this.conversation)return;const t=this.inputBoxWigdet.value,e=LadiChat.storeConfig.user_info.name?LadiChat.storeConfig.user_info.name:LadiChat.storeConfig.user_info.alias_name,a={conversation_id:this.conversation._id,name:e,user_id:LadiChat.storeConfig.user_info.user_id,msg:t};""!==t&&this.isTyping&&this.lastContent!==t&&(this.socket.emit(LadiChat_Config.SOCKET_EVENT.ON_TYPING_CHANGE_MSG,a),this.lastContent=t),""===t&&this.isTyping&&(this.socket.emit(LadiChat_Config.SOCKET_EVENT.END_TYPING,a),this.isTyping=!1)}),500)}changeStyleInput(){const t=this.mainDocument.getElementById("ladichat-footer-medias"),e=this.inputBoxWigdet.value,a=this.mainDocument.getElementById("last-action-state");""!==e?(a.style.display="none",t.style.display="block",t.style.width="10%",this.inputBoxWigdet.style.width="90%",this.inputBoxWigdet.scrollHeight>this.inputBoxWigdet.getBoundingClientRect().height&&(this.inputBoxWigdet.scrollHeight<140?this.inputBoxWigdet.style.height=this.inputBoxWigdet.scrollHeight:this.inputBoxWigdet.style.height="140px"),this.labelInputImage.style.display="none",this.labelInputDocument.style.display="none",this.labelInputIcon.style.display="none"):(a.style.display="block",t.style.display="inline-flex",t.style.width="128px",this.inputBoxWigdet.style.width="calc(100% - 130px)",this.inputBoxWigdet.style.height="57px",this.labelInputImage.style.display="inline-block",this.labelInputDocument.style.display="inline-block",this.labelInputIcon.style.display="inline-block")}userTyping(){if(!this.conversation)return;const t=this.inputBoxWigdet.value,e=LadiChat.storeConfig.user_info.name?LadiChat.storeConfig.user_info.name:LadiChat.storeConfig.user_info.alias_name,a={conversation_id:this.conversation._id,name:e,user_id:LadiChat.storeConfig.user_info.user_id,msg:t};""!==t&&(this.socket.emit(LadiChat_Config.SOCKET_EVENT.ON_TYPING,a),this.isTyping=!0),""===t&&(this.socket.emit(LadiChat_Config.SOCKET_EVENT.END_TYPING,a),this.isTyping=!1)}async sendEmoji(t){try{LadiChat.token||(await LadiChat.createNewSession(),this.socket=LadiChat.socket,this.addEventSocket());const e={"content-type":"application/json","session-key":LadiChat.token},a={message:t};this.conversation&&(a.conversation_id=this.conversation._id),this.changeStyleInput();const i=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,a,e);201===i.code&&(this.conversation||(this.conversation=i.data.conversation))}catch(t){console.log(t)}}beforeSend(){this.removeSocketEvent();let t=this.inputBoxWigdet.value;t=t.replace(/(\r\n|\r|\n){2}/g,"$1").replace(/(\r\n|\r|\n){3,}/g,"$1\n"),t=t.replace(/(<div><br><\/div>)/g,"<br>"),t=t.replace(/(<br>)+/g,"<br>"),t=t.trim();const e={message:t,msg_tid:LadiChat_Helper.generateText(5),action:"send_message",conversation:this.conversation,api:LadiChat_Config.API_ROUTE.SEND_MESSAGE};return LadiChat.mainPage=null,LadiChat.showFormPopup(LadiChat.storeConfig.startForm,e),!1}async sendMessage(){try{LadiChat.token||(await LadiChat.createNewSession(),this.socket=LadiChat.socket,this.isNotToken=!0,this.addEventSocket());const t={"content-type":"application/json","session-key":LadiChat.token};if(""===this.inputBoxWigdet.value.trim())return;let e=this.inputBoxWigdet.value;e=e.replace(/(\r\n|\r|\n){2}/g,"$1").replace(/(\r\n|\r|\n){3,}/g,"$1\n"),e=e.replace(/(<div><br><\/div>)/g,"<br>"),e=e.replace(/(<br>)+/g,"<br>"),e=e.trim();const a=LadiChat_Helper.generateText(5),{phones:i,emails:n}=LadiChat_Helper.containsEmailOrPhone(e);let s=i||n,o=!1,r=!1;i&&i.length>0&&(o=i[0]),n&&n.length>0&&(r=n[0]);const d=!LadiChat.storeConfig.user_info.email||LadiChat.storeConfig.user_info.email&&""==LadiChat.storeConfig.user_info.email.trim(),c=!LadiChat.storeConfig.user_info.phone||LadiChat.storeConfig.user_info.phone&&""==LadiChat.storeConfig.user_info.phone.trim();let l=d||c;const h={message:e,msg_tid:a};l&&(h.has_email_phone=s);const g={msg_tid:a,created_at:new Date,deleted_all:!1,deleted_users:[],message:e,read_users:[LadiChat.storeConfig.user_info._id],sender_id:LadiChat.storeConfig.user_info._id,store_id:LadiChat.storeConfig.user_info.store_id,updated_at:new Date,type:"SENT",creator_group:"USER",_id:!1,resendData:{data:h,headers:t}};this.conversation&&(h.conversation_id=this.conversation._id,g.conversation_id=this.conversation._id),LadiChat.storeConfig.user_info.is_send_first_message||(h.is_send_first_message=!0),this.inputBoxWigdet.value="",this.listMessage.push(g),this.reloadMessagesList(),this.changeStyleInput();const u=this.inputBoxWigdet.value,C=LadiChat.storeConfig.user_info.name?LadiChat.storeConfig.user_info.name:LadiChat.storeConfig.user_info.alias_name;if(this.conversation&&this.conversation._id){const t={conversation_id:this.conversation._id,name:C,user_id:LadiChat.storeConfig.user_info.user_id,msg:u};""===u&&(this.socket.emit(LadiChat_Config.SOCKET_EVENT.END_TYPING,t),this.isTyping=!1)}const f=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,h,t);201!==f.code&&200!==f.code||(!l&&s&&(LadiChat.storeConfig.user_info.email=r,LadiChat.storeConfig.user_info.phone=o),this.isNotToken&&(this.handlerNewConversation(f.data.conversation),this.isNotToken=!1),LadiChat.storeConfig.user_info.is_send_first_message||(LadiChat.sendTracking("user_send_first_message"),LadiChat.storeConfig.user_info.is_send_first_message=!0,"function"==typeof LadiChat.firstMessageCallback&&LadiChat.firstMessageCallback.call()),!LadiChat.storeConfig.user_info||LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&LadiChat.storeConfig.user_info.conversation&&LadiChat.storeConfig.user_info.conversation._id==f.data.conversation._id||(LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.storeConfig.user_info.conversation=this.conversation,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig))}catch(t){console.log(t)}}generateListAgent(){const t=document.createElement("div");t.setAttribute("class","list-agent");let e=0;for(let a=0;a<LadiChat.storeConfig.staffs.length;a++){const i=LadiChat.storeConfig.staffs[a];if(e>=3)break;if(i.online_status==LadiChat_Config.STAFF_STATUS.ONLINE){const a=LadiChat_Helper.getStaffAvatar(i);t.appendChild(a),e++}}if(0==e)for(let a=0;a<LadiChat.storeConfig.staffs.length;a++){const i=LadiChat.storeConfig.staffs[a];if(e>=3)break;const n=LadiChat_Helper.getStaffAvatar(i);t.appendChild(n),e++}return t}generateAgent(){const t=document.createElement("div");if(this.conversation)if(this.conversation.assign_id&&""!=this.conversation.assign_id){const e=LadiChat_Config.getStaffInfo(this.conversation.assign_id,LadiChat.storeConfig);let a="";e.avatar&&""!=e.avatar?(a=`<img class="ladichat-header-avatar-image" src="${e.avatar}"></img>`,LadiChat.closeSVG="<img src='"+e.avatar+"' class='agent-avatar'/>"):a='<span class="ladichat-header-no-avatar">'+LadiChat_Helper.getDisplayName(e.name)+"</span>";let i=LadiChat.storeConfig.conversationPage.agent_describe&&""!=LadiChat.storeConfig.conversationPage.agent_describe?LadiChat.storeConfig.conversationPage.agent_describe:"Hỗ trợ viên";t.innerHTML='<div class="ladichat-widget-header-agent" id="ladichat-widget-header-agent">\n                    <div id="slider" class="ladichat-widget-header-avatar slide-in">'+a+'<div style="margin-top: 5px"><span class="ladichat-agent-name">'+e.name+'</span>\n                        <span class="ladichat-agent-group">'+i+"</span>\n                        </div>\n                    </div>\n                </div>"}else{const e=this.generateListAgent(),a=document.createElement("div");a.setAttribute("class","reply-time-text"),a.innerHTML="<span>"+this.configStartPage.introduce_text+"</span>",e.appendChild(a),t.innerHTML='<div class="ladichat-widget-header-agent" id="ladichat-widget-header-agent">\n                    <div id="slider" class="ladichat-widget-header-avatar slide-in not-assign">'+e.outerHTML+"</div>\n                </div>"}else{let e=LadiChat.storeConfig.conversationPage.agent_describe&&""!=LadiChat.storeConfig.conversationPage.agent_describe?LadiChat.storeConfig.conversationPage.agent_describe:"Hỗ trợ viên đang trực tuyến";const a=this.generateListAgent(),i=document.createElement("div");i.setAttribute("class","reply-time-text");const n=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{};i.innerHTML="<span>"+e+` ${n.is_online_conversation?n.is_online_conversation:"đang trực tuyến"} </span>\n            <span>${n.is_will_reply_conversation?n.is_will_reply_conversation:"sẽ phản hồi bạn trong vài phút"}</span>`,a.appendChild(i);let s=LadiChat.storeConfig.store_name&&""!=LadiChat.storeConfig.store_name?LadiChat.storeConfig.store_name:LadiChat.storeConfig.store_info.name;t.innerHTML='<div class="ladichat-widget-header-agent" id="ladichat-widget-header-agent">\n                <div id="slider" class="ladichat-widget-header-avatar slide-in not-conv"><div><span class="ladichat-agent-name">'+s+'</span>\n                    <span class="ladichat-agent-group">'+this.configStartPage.introduce_text+"</span>\n                    </div>"+a.outerHTML+"</div>\n            </div>"}return t}addQuickReplyEvent(){const t=this,e=this.mainDocument.getElementsByClassName("item-quick-reply");for(let a=0;a<e.length;a++)e[a].addEventListener("click",(function(){t.quickReply(e[a].innerText)}))}generateLastState(){try{const t=document.createElement("div");if(this.conversation&&this.conversation.last_state&&this.conversation.last_state.type==LadiChat_Config.MESSAGE_TEMPLATE_TYPE.QUICK_REPLY){t.setAttribute("class","list-quick-reply");const{options:e,icons:a}=JSON.parse(this.conversation.last_state.value);for(let i=0;i<e.length;i++){if(""==e[i])continue;const n=document.createElement("div");n.setAttribute("class","item-quick-reply");const s=document.createTextNode(e[i]);if(a&&a.length>i&&""!=a[i]){const t=document.createElement("img");t.setAttribute("src",a[i]),n.appendChild(t)}n.appendChild(s),t.appendChild(n)}}return t}catch(t){console.log(t)}}async quickReply(t){try{const e={"content-type":"application/json","session-key":LadiChat.token},a=LadiChat_Helper.generateText(5),i={message:t,msg_tid:a},n={msg_tid:a,created_at:new Date,deleted_all:!1,deleted_users:[],message:t,read_users:[LadiChat.storeConfig.user_info._id],sender_id:LadiChat.storeConfig.user_info._id,store_id:LadiChat.storeConfig.user_info.store_id,updated_at:new Date,type:"SENT",_id:!1,resendData:{data:i,headers:e}};this.conversation&&(i.conversation_id=this.conversation._id,n.conversation_id=this.conversation._id),this.listMessage.push(n),this.reloadMessagesList(),this.changeStyleInput();const s=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,i,e);201!==s.code&&200!==s.code||(this.conversation||(this.conversation=s.data.conversation),!LadiChat.storeConfig.user_info||LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&LadiChat.storeConfig.user_info.conversation||(LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.storeConfig.user_info.conversation={_id:this.conversation._id,assign_id:this.conversation.assign_id,store_id:this.conversation.store_id},LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig)))}catch(t){}}generateHeader(){try{const t='<div id="back-btn" class="ladichat-widget-header-back-btn">\n                <div class="ladichat-message-unread-badge hidden" id="conv-stream"></div>\n                <span>\n                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13"><title>left-arrow-2</title><g fill="#ffffff"><path d="M9.1 12.87l-6.31-6.31 6.31-6.31 1.23 1.14-5.16 5.17 5.16 5.17z" fill="#ffffff"></path></g></svg>\n                </span>\n            </div>',e=document.createElement("div");e.innerHTML=t.trim();const a=e.firstChild,i='<div id="minimize-btn">\n                <span>\n                <svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 13 13"><title>left-arrow-2</title><g fill="#ffffff"><path d="M9.1 12.87l-6.31-6.31 6.31-6.31 1.23 1.14-5.16 5.17 5.16 5.17z" fill="#ffffff"></path></g></svg>\n                </span>\n            </div>',n=document.createElement("div");n.innerHTML=i.trim();const s=n.firstChild,o=document.createElement("div");o.setAttribute("id","ladichat-widget-header"),o.setAttribute("class","ladichat-widget-header"),o.appendChild(a);const r=this.generateAgent();return o.appendChild(r.firstChild),o.appendChild(s),o}catch(t){return console.log(t),null}}generateInputBox(){let t="Viết tin trả lời";LadiChat.storeConfig.conversationPage.place_holder&&""!=LadiChat.storeConfig.conversationPage.place_holder&&(t=LadiChat.storeConfig.conversationPage.place_holder);const e=`<textarea placeholder="${t}" contenteditable="true" tabindex="-1" id="ladichat-typing-message"></textarea>`,a=document.createElement("div");return a.innerHTML=e,a.firstChild}generateHTMLContent(){try{const t=document.createElement("div"),e=this.generateHeader();t.appendChild(e);const a=document.createElement("div");a.setAttribute("class","ladichat-widget-body"),a.setAttribute("id","ladichat-list-msg-scroll"),t.appendChild(a);const i=document.createElement("div");i.setAttribute("id","last-action-state"),i.setAttribute("class","last-action-state"),a.appendChild(i);const n=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{};if(this.conversation){const t=this.generateLastState();!1!==this.conversation.is_open?i.appendChild(t):!1!==this.conversation.is_open||this.conversation.snooze||(i.innerHTML=`<span class="ladichat-system-msg">${n.conversation_close?n.conversation_close:"Cuộc chat đã đóng."}</span>`)}const s=document.createElement("div");s.setAttribute("id","ladichat-conversation-list-message"),s.setAttribute("class","ladichat-conversation list-message"),!this.conversation||!1!==this.conversation.is_open||null==this.conversation.rating&&null!=this.conversation.rating||s.classList.add("conversation-rating"),a.appendChild(s),this.conversation?e.style.height="68px":(e.style.height="150px",s.setAttribute("class","ladichat-conversation list-message ladichat-start-conversation"));const o=document.createElement("div");o.setAttribute("class","ladichat-widget-footer"),t.appendChild(o);const r=document.createElement("div");r.setAttribute("id","conversation-rating");let d=`<div class="title-rating">${n.rating_title?n.rating_title:"Đánh giá phiên hỗ trợ"}</div>\n            <div class="desc-rating">${n.rating_title?n.rating_content:"Bạn đánh giá thế nào về phiên hỗ trợ này"}</div>`,c='<span data-rating="BAD">'+LadiChat_Config.svgRating.BAD+'</span><span data-rating="NORMAL">'+LadiChat_Config.svgRating.NORMAL+'</span><span data-rating="GOOD">'+LadiChat_Config.svgRating.GOOD+"</span>";this.conversation&&!1===this.conversation.is_open&&!this.conversation.snooze&&this.conversation.rating&&(r.setAttribute("class","done-rating"),d=`<div class="title-rating">${n.thanks_rating?n.thanks_rating:"Cảm ơn bạn đã đánh giá"}</div>\n                <div class="desc-rating">${n.connect_us?n.connect_us:"Hãy luôn kết nối với chúng tôi mọi lúc bạn cần nhé"}</div>`,c="<span>"+LadiChat_Config.svgRating[this.conversation.rating]+"</span>"),r.innerHTML=d+'<div id="item-rating">'+c+"</div>",o.appendChild(r),(this.conversation&&(!1!==this.conversation.is_open||this.conversation.snooze)||!this.conversation)&&r.setAttribute("class","hide");const l=document.createElement("div");l.setAttribute("id","close-state"),l.setAttribute("class","hide"),l.innerHTML=`<span class="continue-text">${n.conversation_close_1?n.conversation_close_1:"Bạn có thể "}<a id="continue-chat">&nbsp;${n.conversation_continue_btn?n.conversation_continue_btn:"tiếp tục chat"}</a> ${n.conversation_close_2?n.conversation_close_2:" hoặc "} </span><span class="button-new-conversation noselect" id="button-new-conversation-conv">${n.open_new_chat?n.open_new_chat:"Mở phiên chat mới"}</span></div>`,o.appendChild(l);const h=document.createElement("div");h.setAttribute("id","ladichat-footer-typing"),o.appendChild(h),this.conversation&&!1===this.conversation.is_open&&!this.conversation.snooze&&(h.classList.add("hide"),l.classList.remove("hide"));const g=this.generateInputBox();h.appendChild(g);const u=document.createElement("div");u.setAttribute("id","ladichat-footer-medias"),h.appendChild(u);const C=document.createElement("label");C.setAttribute("for","image-upload-message");const f=document.createElement("i");f.setAttribute("id","ladichat-send-image"),f.setAttribute("class","ladiui icon icon-image"),C.appendChild(f),u.appendChild(C);const p=document.createElement("input");p.setAttribute("id","file-upload-message"),p.setAttribute("type","file"),p.setAttribute("accept",".doc,.txt,.pdf,.csv"),p.setAttribute("multiple","true"),u.appendChild(p);const m=document.createElement("label");m.setAttribute("for","file-upload-message");const _=document.createElement("i");_.setAttribute("id","ladichat-send-document"),_.setAttribute("class","ladiui icon icon-attachment"),m.appendChild(_),u.appendChild(m);const L=document.createElement("input");L.setAttribute("id","image-upload-message"),L.setAttribute("data-tooltip","Gửi ảnh"),L.setAttribute("data-tooltip-position","top"),L.setAttribute("type","file"),L.setAttribute("accept","image/*"),L.setAttribute("multiple","true"),u.appendChild(L);const v=document.createElement("label"),y=document.createElement("i");y.setAttribute("id","ladichat-send-icon"),y.setAttribute("class","ladiui icon icon-emoji"),v.appendChild(y),u.appendChild(v);const E=document.createElement("label"),b=document.createElement("i");return b.setAttribute("id","ladichat-send-button"),b.setAttribute("class","ladiui icon icon-send-message"),E.appendChild(b),u.appendChild(E),this.emoji=new Emoji,t.appendChild(this.emoji.doom_element),t}catch(t){return console.log(t),null}}async connectFunc(){this.lastMessageID=null,await this.getListMessage()}async getListMessage(){try{if(!this.token||!this.conversation||!LadiChat.storeConfig.user_info.is_show_widget)return;const t={token:this.token,conversation_id:this.conversation._id,last_msg_id:this.lastMessageID},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_MESSAGE,t);if(200==e.code){this.isLoadMore||(this.listMessage=[]);for(let t=0;t<e.data.messages.length;t++)e.data.messages[t].deleted_all||this.listMessage.push(e.data.messages[t]);this.hasMore=e.data.hasMore,this.reloadMessagesList()}}catch(t){console.log(t)}}linkAllMessage(){try{const t={attributes:null,className:"linkified",defaultProtocol:"http",events:null,format:function(t,e){return t},formatHref:function(t,e){return t},ignoreTags:[],nl2br:!1,tagName:"a",target:{url:"_blank"},validate:!0};linkifyElement(this.chatWidgetMessageList,t,this.mainDocument)}catch(t){console.log(t)}}async appendMessageByCommand(t,e){try{if(this.isCreatingConv)return;this.isCreatingConv=!0;const e={"content-type":"application/json","session-key":LadiChat.token},a={message:t};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_INLINE_FORM,a,e)&&(this.isCreatingConv=!1)}catch(t){console.log("error :",t)}}appendMessageByUser(){}sortByTime(t,e){const a=new Date(t.created_at).getTime(),i=new Date(e.created_at).getTime();return a<i?-1:a>i?1:0}sortByID(t,e){return t._id<e._id?-1:t._id>e._id?1:0}reloadMessagesList(t=!1){try{if(!this.listMessage)return;let e=!0,a=!1,i=!1,n=!1,s=this.lastMessageID;this.chatWidgetMessageList.innerHTML="",this.listMessage=this.listMessage.sort(this.sortByID),this.listMessage=this.listMessage.sort(this.sortByTime),this.listMessage.length>0&&(this.lastMessageID=this.listMessage[0]._id);for(let t=0;t<this.listMessage.length;t++){const e=this.listMessage[t];e.sender_id==LadiChat.storeConfig.user_info._id&&(e.type="SENT",!this.indexShowRead&&e.read_users.length>1&&(this.indexShowRead=e._id)),e.sender_id!=LadiChat.storeConfig.user_info._id&&(e.type="RECIEVE")}null===this.indexShowRead&&this.listMessage.length>0&&(this.indexShowRead=this.listMessage[0]._id);for(let o=0;o<this.listMessage.length;o++){const r=this.listMessage[o];let d=!1,c=!1,l={};if(a&&a==r.type||(a=r.type,e=!0),o+1<this.listMessage.length&&(i=this.listMessage[o+1].type),o==this.listMessage.length-1&&(e=!0),i&&i!==a&&(e=!0),o+1<=this.listMessage.length-1){const t=new Date(this.listMessage[o+1].created_at),a=new Date(r.created_at);e=LadiChat_Helper.diffDateMinute(t,a)>5}if("SENT"==r.type){const t=r._id==this.indexShowRead;t&&(e=!0),l=new MessageSent,r._id&&(r.resendData=null),l.init(r,this.conversation,LadiChat.storeConfig,e,t),d=l.doom_element,r.type="SENT",n=!1}else l=new MessageRecieve,n&&n==r.sender_id||(c=!0,n=r.sender_id),l.init(r,this.conversation,LadiChat.storeConfig,e,c),d=l.doom_element,r.type="RECIEVE",(!r.read_users||r.read_users.indexOf(LadiChat.storeConfig.user_info._id)<0)&&(this.lastUnread||t||(this.lastUnread=d),this.listUnreadMessage.push(r));this.listMessage[o].timeoutID=l.timeoutID||!1,this.listMessage[o].widget_element=d,this.chatWidgetMessageList.appendChild(d),s==r._id&&(s=d)}if(this.hasMore){const t=document.createElement("div");t.setAttribute("id","load-more-message"),t.setAttribute("class","load-more");const e=document.createElement("i");e.setAttribute("class","ladiui icon loader"),t.appendChild(e),this.chatWidgetMessageList.insertBefore(t,this.chatWidgetMessageList.firstElementChild)}for(let t=0;t<this.listTyping.length;t++){const e=this.listTyping[t],a=new MessageTyping;a.init(e.ladi_uid,this.conversation,LadiChat.storeConfig),this.chatWidgetMessageList.appendChild(a.doom_element)}const o=this;this.isLoadMore?setTimeout((function(){s&&s.scrollIntoView(!0)}),100):!t&&this.lastUnread?setTimeout((function(){o.lastUnread.scrollIntoView&&!o.isLoadMore&&(o.lastUnread.scrollIntoView(!0),o.lastUnread=!1)}),100):this.listMessage.length>0&&setTimeout((function(){o.listMessage[o.listMessage.length-1].widget_element.scrollIntoView(!0)}),100),this.linkAllMessage(),this.isLoadMore=!1}catch(t){console.log(t)}}reloadMessageInfo(t){return t}}class Emoji{constructor(){const t=this.generateHTMLContent();this.doom_element=t,this.listFilter=[]}filterKey(t){return Object.keys(listEmoji).filter((function(e){return e.indexOf(t.toLowerCase())>=0})).reduce((function(t,e){return t[e]=listEmoji[e],t}),{})}loadContent(t){for(var e in listEmoji){if(!listEmoji.hasOwnProperty(e))continue;let a=this.buildItem(e,listEmoji[e]);t.appendChild(a)}}buildItem(t,e){const a=`<div class="ladichat-emoji-item" data-emoji="${e}"><span title=${t}>${e}</span></div>`,i=document.createElement("div");return i.innerHTML=a.trim(),i.firstChild}generateHTMLContent(){const t=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},e=document.createElement("div");e.setAttribute("class","ladiui-modal"),e.setAttribute("data-dissmiss","modal-ladichat-emoji"),e.setAttribute("id","modal-ladichat-emoji");const a=`<div class="ladichat-emoji" id="ladichat-emoji">\n                <div class="ladichat-search-emoji">\n                    <input type="text" id="search-emoji" placeholder="${t.emoji_search_holder?t.emoji_search_holder:"Tìm theo tên hoặc nội dung"}" name="id" class="ladiui input" value="">\n                    <i class="ladi-icon icon-zoom"></i>\n                </div>\n            </div>`,i=document.createElement("div");i.innerHTML=a.trim();const n=i.firstChild;e.appendChild(n);const s=document.createElement("div");return s.setAttribute("class","ladichat-emoji-all"),s.setAttribute("id","ladichat-emoji-all"),this.loadContent(s),n.appendChild(s),e}}const listEmoji={grinning:"😀",grin:"😁",joy:"😂",smiley:"😃",smile:"😄",sweat_smile:"😅",laughing:"😆",satisfied:"😆",innocent:"😇",smiling_imp:"😈",wink:"😉",blush:"😊",yum:"😋",relieved:"😌",heart_eyes:"😍",sunglasses:"😎",smirk:"😏",neutral_face:"😐",expressionless:"😑",unamused:"😒",sweat:"😓",pensive:"😔",confused:"😕",confounded:"😖",kissing:"😗",kissing_heart:"😘",kissing_smiling_eyes:"😙",kissing_closed_eyes:"😚",stuck_out_tongue:"😛",stuck_out_tongue_winking_eye:"😜",stuck_out_tongue_closed_eyes:"😝",disappointed:"😞",worried:"😟",angry:"😠",rage:"😡",cry:"😢",persevere:"😣",triumph:"😤",disappointed_relieved:"😥",frowning:"😦",anguished:"😧",fearful:"😨",weary:"😩",sleepy:"😪",tired_face:"😫",grimacing:"😬",sob:"😭",open_mouth:"😮",hushed:"😯",cold_sweat:"😰",scream:"😱",astonished:"😲",flushed:"😳",sleeping:"😴",dizzy_face:"😵",no_mouth:"😶",mask:"😷",smile_cat:"😸",joy_cat:"😹",smiley_cat:"😺",heart_eyes_cat:"😻",smirk_cat:"😼",kissing_cat:"😽",pouting_cat:"😾",crying_cat_face:"😿",scream_cat:"🙀",slightly_frowning_face:"🙁",slightly_smiling_face:"🙂",upside_down_face:"🙃",face_with_rolling_eyes:"🙄",zipper_mouth_face:"🤐",money_mouth_face:"🤑",face_with_thermometer:"🤒",nerd_face:"🤓",thinking_face:"🤔",face_with_head_bandage:"🤕",hugging_face:"🤗",the_horns:"🤘",sign_of_the_horns:"🤘",call_me_hand:"🤙",raised_back_of_hand:"🤚","left-facing_fist":"🤛","right-facing_fist":"🤜",handshake:"🤝",crossed_fingers:"🤞",hand_with_index_and_middle_fingers_crossed:"🤞",i_love_you_hand_sign:"🤟",face_with_cowboy_hat:"🤠",clown_face:"🤡",nauseated_face:"🤢",rolling_on_the_floor_laughing:"🤣",drooling_face:"🤤",lying_face:"🤥","woman-facepalming":"🤦‍♀️","man-facepalming":"🤦‍♂️",face_palm:"🤦",sneezing_face:"🤧",face_with_raised_eyebrow:"🤨",face_with_one_eyebrow_raised:"🤨","star-struck":"🤩",grinning_face_with_star_eyes:"🤩",zany_face:"🤪",grinning_face_with_one_large_and_one_small_eye:"🤪",shushing_face:"🤫",face_with_finger_covering_closed_lips:"🤫",face_with_symbols_on_mouth:"🤬",serious_face_with_symbols_covering_mouth:"🤬",face_with_hand_over_mouth:"🤭",smiling_face_with_smiling_eyes_and_hand_covering_mouth:"🤭",face_vomiting:"🤮",face_with_open_mouth_vomiting:"🤮",exploding_head:"🤯",shocked_face_with_exploding_head:"🤯",face_with_monocle:"🧐",adult:"🧑",child:"🧒",older_adult:"🧓",bearded_person:"🧔",point_up_2:"👆",point_down:"👇",point_left:"👈",point_right:"👉",facepunch:"👊",punch:"👊",wave:"👋",ok_hand:"👌","+1":"👍",thumbsup:"👍","-1":"👎",thumbsdown:"👎",clap:"👏",open_hands:"👐",crown:"👑",womans_hat:"👒",eyeglasses:"👓",necktie:"👔",shirt:"👕",tshirt:"👕",jeans:"👖",dress:"👗",kimono:"👘",bikini:"👙",womans_clothes:"👚",purse:"👛",handbag:"👜",pouch:"👝",mans_shoe:"👞",shoe:"👞",athletic_shoe:"👟",high_heel:"👠",sandal:"👡",boot:"👢",footprints:"👣",bust_in_silhouette:"👤",busts_in_silhouette:"👥",boy:"👦",girl:"👧","male-farmer":"👨‍🌾","male-cook":"👨‍🍳","male-student":"👨‍🎓","male-singer":"👨‍🎤","male-artist":"👨‍🎨","male-teacher":"👨‍🏫","male-factory-worker":"👨‍🏭","man-boy-boy":"👨‍👦‍👦","man-boy":"👨‍👦","man-girl-boy":"👨‍👧‍👦","man-girl-girl":"👨‍👧‍👧","man-girl":"👨‍👧","man-man-boy":"👨‍👨‍👦","man-man-boy-boy":"👨‍👨‍👦‍👦","man-man-girl":"👨‍👨‍👧","man-man-girl-boy":"👨‍👨‍👧‍👦","man-man-girl-girl":"👨‍👨‍👧‍👧","man-woman-boy":"👨‍👩‍👦",family:"👨‍👩‍👦","man-woman-boy-boy":"👨‍👩‍👦‍👦","man-woman-girl":"👨‍👩‍👧","man-woman-girl-boy":"👨‍👩‍👧‍👦","man-woman-girl-girl":"👨‍👩‍👧‍👧","male-technologist":"👨‍💻","male-office-worker":"👨‍💼","male-mechanic":"👨‍🔧","male-scientist":"👨‍🔬","male-astronaut":"👨‍🚀","male-firefighter":"👨‍🚒","male-doctor":"👨‍⚕️","male-judge":"👨‍⚖️","male-pilot":"👨‍✈️","man-heart-man":"👨‍❤️‍👨","man-kiss-man":"👨‍❤️‍💋‍👨",man:"👨","female-farmer":"👩‍🌾","female-cook":"👩‍🍳","female-student":"👩‍🎓","female-singer":"👩‍🎤","female-artist":"👩‍🎨","female-teacher":"👩‍🏫","female-factory-worker":"👩‍🏭","woman-boy-boy":"👩‍👦‍👦","woman-boy":"👩‍👦","woman-girl-boy":"👩‍👧‍👦","woman-girl-girl":"👩‍👧‍👧","woman-girl":"👩‍👧","woman-woman-boy":"👩‍👩‍👦","woman-woman-boy-boy":"👩‍👩‍👦‍👦","woman-woman-girl":"👩‍👩‍👧","woman-woman-girl-boy":"👩‍👩‍👧‍👦","woman-woman-girl-girl":"👩‍👩‍👧‍👧","female-technologist":"👩‍💻","female-office-worker":"👩‍💼","female-mechanic":"👩‍🔧","female-scientist":"👩‍🔬","female-astronaut":"👩‍🚀","female-firefighter":"👩‍🚒","female-doctor":"👩‍⚕️","female-judge":"👩‍⚖️","female-pilot":"👩‍✈️","woman-heart-man":"👩‍❤️‍👨",couple_with_heart:"👩‍❤️‍👨","woman-heart-woman":"👩‍❤️‍👩","woman-kiss-man":"👩‍❤️‍💋‍👨",couplekiss:"👩‍❤️‍💋‍👨","woman-kiss-woman":"👩‍❤️‍💋‍👩",woman:"👩",couple:"👫",man_and_woman_holding_hands:"👫",two_men_holding_hands:"👬",two_women_holding_hands:"👭","female-police-officer":"👮‍♀️","male-police-officer":"👮‍♂️",cop:"👮‍♂️","woman-with-bunny-ears-partying":"👯‍♀️",dancers:"👯‍♀️","man-with-bunny-ears-partying":"👯‍♂️",bride_with_veil:"👰","blond-haired-woman":"👱‍♀️","blond-haired-man":"👱‍♂️",person_with_blond_hair:"👱‍♂️",man_with_gua_pi_mao:"👲","woman-wearing-turban":"👳‍♀️","man-wearing-turban":"👳‍♂️",man_with_turban:"👳‍♂️",older_man:"👴",older_woman:"👵",baby:"👶","female-construction-worker":"👷‍♀️","male-construction-worker":"👷‍♂️",construction_worker:"👷‍♂️",princess:"👸",japanese_ogre:"👹",japanese_goblin:"👺",ghost:"👻",angel:"👼",alien:"👽",space_invader:"👾",imp:"👿",skull:"💀","woman-tipping-hand":"💁‍♀️",information_desk_person:"💁‍♀️","man-tipping-hand":"💁‍♂️","female-guard":"💂‍♀️","male-guard":"💂‍♂️",guardsman:"💂‍♂️",dancer:"💃",lipstick:"💄",nail_care:"💅","woman-getting-massage":"💆‍♀️",massage:"💆‍♀️","man-getting-massage":"💆‍♂️","woman-getting-haircut":"💇‍♀️",haircut:"💇‍♀️","man-getting-haircut":"💇‍♂️","woman-gesturing-no":"🙅‍♀️",no_good:"🙅‍♀️","man-gesturing-no":"🙅‍♂️","woman-gesturing-ok":"🙆‍♀️",ok_woman:"🙆‍♀️","man-gesturing-ok":"🙆‍♂️","woman-bowing":"🙇‍♀️","man-bowing":"🙇‍♂️",bow:"🙇‍♂️",see_no_evil:"🙈",hear_no_evil:"🙉",speak_no_evil:"🙊","woman-raising-hand":"🙋‍♀️",raising_hand:"🙋‍♀️","man-raising-hand":"🙋‍♂️",raised_hands:"🙌","woman-frowning":"🙍‍♀️",person_frowning:"🙍‍♀️","man-frowning":"🙍‍♂️","woman-pouting":"🙎‍♀️",person_with_pouting_face:"🙎‍♀️","man-pouting":"🙎‍♂️",pray:"🙏",robot_face:"🤖"};class LighBoxImage{init(t){}}"use strict";!function(t,e){var a=function(e){function a(t,e,a){var i=a[a.length-1];t.replaceChild(i,e);for(var n=a.length-2;n>=0;n--)t.insertBefore(a[n],i),i=a[n]}function i(t,e,a){var i=[],n=t,s=Array.isArray(n),o=0;for(n=s?n:n[Symbol.iterator]();;){var r;if(s){if(o>=n.length)break;r=n[o++]}else{if((o=n.next()).done)break;r=o.value}var d=r;if("nl"===d.type&&e.nl2br)i.push(a.createElement("br"));else if(d.isLink&&e.check(d)){var c=e.resolve(d),l=c.formatted,h=c.formattedHref,g=c.tagName,u=c.className,C=c.target,f=c.events,p=c.attributes,m=a.createElement(g);if(m.setAttribute("href",h),u&&m.setAttribute("class",u),C&&m.setAttribute("target",C),p)for(var _ in p)m.setAttribute(_,p[_]);if(f)for(var L in f)m.addEventListener?m.addEventListener(L,f[L]):m.attachEvent&&m.attachEvent("on"+L,f[L]);m.appendChild(a.createTextNode(l)),i.push(m)}else i.push(a.createTextNode(d.toString()))}return i}function n(t,e,s){if(!t||t.nodeType!==l)throw new Error("Cannot linkify "+t+" - Invalid DOM Node type");var d=e.ignoreTags;if("A"===t.tagName||r.contains(d,t.tagName))return t;for(var g=t.firstChild;g;){var u=void 0,C=void 0,f=void 0;switch(g.nodeType){case l:n(g,e,s);break;case h:if(u=g.nodeValue,0===(C=o(u)).length||1===C.length&&C[0]instanceof c)break;a(t,g,f=i(C,e,s)),g=f[f.length-1]}g=g.nextSibling}return t}function s(e,a){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{i=i||document||t&&t.document||global&&global.document}catch(t){}if(!i)throw new Error("Cannot find document implementation. If you are in a non-browser environment like Node.js, pass the document implementation as the third argument to linkifyElement.");return n(e,a=new d(a),i)}var o=e.tokenize,r=e.options,d=r.Options,c=e.parser.TOKENS.TEXT,l=1,h=3;return s.helper=n,s.normalize=function(t){return new d(t)},s}(linkify);t.linkifyElement=a}(window);class MessageInputData{init(t,e,a,i=!0){this.message=t,this.conversation=e,this.storeConfig=a,this.isShowDate=i;const n=this.generateHTMLContent(),s=document.createElement("div");s.innerHTML=n.trim();const o=s.firstChild;this.doom_element=o;const r=o.getElementsByTagName("img"),d=[],c=[];for(let t=0;t<r.length;t++){const e=r[t];e.addEventListener("click",(function(){LadiChat_Helper.openInNewTab(e.src)})),d.push(e.src),c.push(e.src.split("/").pop())}}showLightBox(t){}generateHTMLContent(){const t=LadiChat_Config.getStaffInfo(this.message.sender_id,this.storeConfig);let e='<div class="no-avatar">\n            <p>'+LadiChat_Helper.getDisplayName(t.name)+"</p>\n        </div>";return t.avatar&&""!=t.avatar&&(e='<div class="avatar-img">\n                <img  src="'+t.avatar+'"></img>\n            </div>'),this.isShowDate||(e="<div></div>"),'<div class="ladichat-message-recieve-item" id='+this.message._id+'>\n                <div class="ladichat-message-recieve-left">'+e+' </div>\n                <div class="ladichat-message-recieve-mid">\n                    <div class="content">\n                        <div class="line">\n                            <div class="ladichat-msg-recieve-text">'+this.message.message+'</div>\n                        </div>\n                        <div class="line>\n                            <input type="text" id="search" placeholder="Tìm theo tên, email hoặc số điện thoại" name="searchString" class="ladichat-input-field">\n                        </div>\n                    </div>\n                </div>\n            </div>'}}class MessagePreview{init(t){this.message=t;const e=this.generateHTMLContent(),a=document.createElement("div");a.innerHTML=e.trim();const i=a.firstChild;this.doom_element=i,this.formID="";let n=i.getElementsByClassName("ladichat-form-wrapper");if(n&&n.length>0){this.formID=n[0].getAttribute("id");const t=i.getElementsByClassName("button-submit-form")[0],e=t.getAttribute("data-config-id"),a=i.getElementsByClassName("ladichat-form")[0];t&&a&&e&&t.getAttribute("disabled")}i.getElementsByClassName("close-preview")[0].addEventListener("click",(function(t){LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",i.innerHTML="",t.stopPropagation()}));let s=i.getElementsByClassName("btn-msg-action");if(s&&s.length>0)for(let t=0;t<s.length;t++){s[t].getAttribute("data-button");for(let t=0;t<this.buttons.length;t++);}}sendForm(){this.sendFormData()}getTrackingData(){try{const t=[{name:"url_page",value:window.location.href},{name:"conversation_tracking",value:LadiChat_Static_Config.APP_HOME+"/inboxes"+this.conversation._id}],e=LadiChat_Helper.findGetParameter(),a=e.keys();for(const i of a)e.get(i)&&t.push({name:i,value:e.get(i)});return t}catch(t){return console.log(t),[]}}async sendFormData(){try{const a=this.doom_element.getElementsByClassName("button-submit-form")[0].getAttribute("data-config-id"),i=this.doom_element.getElementsByClassName("ladichat-form")[0],n=i.getElementsByClassName("form-field-data");let s={form_config_id:a,form_data:[],app_code:"LADI_CHAT",ladipage_id:LadiChat.storeID};const o=this.getTrackingData();s.tracking_form=o;const r={"Content-Type":"application/json"},d=LadiChat_Static_Config.API_FORM,c={},l=this.message.metadata.form_fields;for(let t=0;t<n.length;t++){let e=!0;const a=n[t];a.required&&(e=this.validateField(a,a.type,a.value));const i=a.getAttribute("data-name");if(!e)return a.classList.add("error"),void LadiChat.toastr("error","","Dữ liệu chưa chính xác, vui lòng hoàn thiện trường: "+i);a.classList.contains("error")&&a.classList.remove("error"),c[a.name]={name:a.getAttribute("data-name"),value:[a.value.trim()]};for(let t=0;t<l.length;t++)if(l[t]._id==a.getAttribute("data-id")){l[t].submit_data=a.value.trim();break}s.form_data.push({name:a.name,value:a.value.trim()})}let h={};const g=i.getElementsByClassName("form-checkbox-item");for(let t=0;t<g.length;t++){const e=g[t];if(e.checked){const t=e.name;let a=e.getAttribute("data-id"),i={};h[a]?i=h[a]:h[a]=i,i[t]?(i[t].push(e.value),c[t].value.push(e.value.trim())):(i[t]=[e.value.trim()],c[t]={name:e.getAttribute("data-name"),value:[e.value.trim()]}),h[a]=i}}const u=i.getElementsByClassName("form-radio-item");for(let t=0;t<u.length;t++){const e=u[t];if(e.checked){const t=e.name;let a=e.getAttribute("data-id"),i={};h[a]?i=h[a]:h[a]=i,i[t]?(i[t].push(e.value),c[t].value.push(e.value.trim())):(i[t]=[e.value.trim()],c[t]={name:t,value:[e.value.trim()]}),h[a]=i}}for(var t in h)if(h.hasOwnProperty(t)){const a=h[t];for(var e in a)if(a.hasOwnProperty(e)){s.form_data.push({name:e,value:a[e]});for(let i=0;i<l.length;i++)if(l[i]._id==t){l[i].submit_data=a[e];break}}}this.message.metadata.form_fields=l;let C=await LadiChat_Helper.sendRequest("POST",d,JSON.stringify(s),!0,r);if(C){if(C=JSON.parse(C),LadiChat.listCallbackForm.length>0)for(let t=0;t<LadiChat.listCallbackForm.length;t++){const e=LadiChat.listCallbackForm[t],a=e.callbackFunc;let i=e.filter,n=!0;if(i&&(i.form_id&&""!=i.form_id&&this.formID!==i.form_id&&(n=!1),i.form_type&&""!=i.form_type&&"INLINE"!=i.form_type.toUpperCase()&&(n=!1)),n&&"function"==typeof a)try{a(s)}catch(t){}}200==C.code&&this.displayFormSuccess(c,i)}}catch(t){console.log(t)}}async syncUserField(t){const e={"Content-Type":"application/json","session-key":LadiChat.token},a={data:t};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SYNC_USER_FIELD,a,e)}async displayFormSuccess(t,e,a){try{let a=!1,n={message_id:this.message._id,conversation_id:this.message.conversation_id};const s={"Content-Type":"application/json","session-key":LadiChat.token},o=e.getElementsByClassName("form-field-data");for(let t=0;t<o.length;t++)o[t].setAttribute("disabled","disabled"),o[t].setAttribute("value",o[t].value),"name"!=o[t].name&&"phone"!=o[t].name&&"email"!=o[t].name&&"birth_day"!=o[t].name||(LadiChat.storeConfig.user_info[o[t].name]=o[t].value,a=!0);a&&this.syncUserField(t),this.doom_element.getElementsByClassName("ladichat-form-wrapper")[0];const r=e.getElementsByClassName("form-checkbox-item");for(let t=0;t<r.length;t++)r[t].setAttribute("disabled","disabled");const d=this.doom_element.getElementsByClassName("button-submit-form")[0];d.setAttribute("disabled","true"),d.removeEventListener("click",this.sendForm),n.attach_form=this.message.metadata,n.new_content=this.message.message,await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_FORM_SUCCESS,n,s);const c=document.createElement("div");for(var i in t)if(t.hasOwnProperty(i)){let e="";const a=document.createElement("p");e+=t[i].name+": ",e+=t[i].value.join(","),a.textContent=e,c.appendChild(a)}let l={conversation_id:this.message.conversation_id,message:c.innerHTML};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,l,s)}catch(t){console.log(t)}}validateField(t,e,a){try{return t.validity.valid}catch(t){return console.log(t),!1}}showLightBox(t){}async clickBtn(t){const e={"content-type":"application/json","session-key":LadiChat.token},a={message:t.title,conversation_id:this.conversation._id};if(await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,a,e),t.payload&&""!=t.payload||t.next_id&&""!=t.next_id){const e={conversation_id:this.conversation._id,payload:t.payload,next_id:t.next_id,message_id:this.message._id},a={"content-type":"application/json","session-key":LadiChat.token};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_POSTBACK_BTN,e,a)}switch(t.type.toUpperCase()){case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.REDIRECT:t.external_link&&(window.location.href=t.external_link),t.url&&(window.location.href=t.url);break;case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.OPEN_URL:t.external_link&&window.open(t.external_link),t.url&&window.open(t.url)}}generateTemplate(){try{let t=this.message.template;t=JSON.parse(t);let e=t.message,a=!1;e.attachment&&(a=(e.attachment||{}).payload||!1),this.buttons=a&&a.buttons?a.buttons:[];let i=a&&a.template_type?a.template_type:LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT,n=[];switch(i.toUpperCase()){case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.GENERIC:n=a.elements||[];let t="";if(n.length>0){let a=n[0].buttons||[],i=n[0].url||"";i.length>0&&(t+=` <img src="${i}" />`),t+='<div class="text-content-view">',e.text&&""!=e.text&&(t+=`<div> ${e.text||""}</div>`);for(let e=0;e<a.length;e++)t+=`<div\n                            class="${0==e?"btn-msg-action first-btn text-center":"btn-msg-action text-center"}"\n                            data-button="${e}"><button>${a[e].title}</button>\n                        </div>`}return t;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT:return`\n                    <div class="text-content-view no-attactment">\n                        ${e.text||""}\n                    </div>`;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.BUTTON:let i=`\n                    <div class="text-content-view">\n                        ${e.text||""}\n                    </div>`;for(let t=0;t<this.buttons.length;t++)i+=`<div\n                            class="btn-msg-action text-center ${t==this.buttons.length-1?" last-btn":""}"\n                            data-button="${t}"><button>${this.buttons[t].title}</button>\n                        </div>`;return i;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.IMAGE:n=a.elements||[];let s="";for(let t=0;t<n.length;t++)s+=`<img src="${n[t].url}" />`;return s+=`<div class="text-content-view title-template">  ${e.text||""}  </div>`,s;default:return`<div>${e.text}</div>`}}catch(t){console.log(t)}}generateHTMLContent(){let t=LadiChat_Config.getStaffInfo(this.message.sender_id,this.storeConfig);t||(t=LadiChat.storeConfig.staffs[0]);let e=this.message.message,a="";if(this.message.metadata){if("string"==typeof this.message.metadata&&(this.message.metadata=JSON.parse(this.message.metadata)),"LADI_CHAT_FORM"==this.message.metadata.object_type&&this.message.message.indexOf("{{form-object}}")>=0){let t=LadiChat_Helper.getFormHTML(this.message.metadata);e=this.message.message.replace("{{form-object}}",t)}"LADI_SALES"==this.message.metadata.type&&(a="ladisale-cart-wrapper",e=LadiChat_Helper.getCartData(this.message.metadata))}let i=`<div class="ladichat-msg-recieve-text ${a}" id="content-`+this.message._id+'">'+e+" <div class='close-preview'><i  class=\"ladiui icon icon-ldp-close\"></i></div> </div>",n=(this.message._id,"");return this.message.template&&""!=this.message.template&&(n="template-msg",i=this.generateTemplate(),i='<div class="content-text-view" id="content-'+this.message._id+'">'+i+"</div>"),new Date(this.message.created_at).toLocaleString(),i}}class MessageRecieve{init(t,e,a,i=!0,n=!0){this.message=t,this.conversation=e,this.storeConfig=a,this.isShowDate=i,this.isShowAvatar=n,this.displayMsg="";const s=this.generateHTMLContent(),o=document.createElement("div");o.innerHTML=s.trim();const r=o.firstChild;this.doom_element=r;const d=this.doom_element.getElementsByClassName("ladichat-msg-recieve-text")[0];d&&(d.innerHTML=this.displayMsg);const c=r.getElementsByTagName("img"),l=[],h=[];for(let t=0;t<c.length;t++){const e=c[t];e.addEventListener("click",(function(){LadiChat_Helper.openInNewTab(e.src)})),l.push(e.src),h.push(e.src.split("/").pop())}this.formID="";let g=r.getElementsByClassName("ladichat-form-wrapper");if(g&&g.length>0){this.formID=g[0].getAttribute("id");const t=r.getElementsByClassName("button-submit-form")[0],e=t.getAttribute("data-config-id"),a=r.getElementsByClassName("ladichat-form")[0];if(t&&a&&e){const e=t.getAttribute("disabled");!1!==e&&null!=e||t.addEventListener("click",this.sendForm.bind(this))}}let u=r.getElementsByClassName("btn-msg-action");if(u&&u.length>0)for(let t=0;t<u.length;t++){const e=u[t].getAttribute("data-button");for(let a=0;a<this.buttons.length;a++)a==e&&(u[t].addEventListener("click",this.clickBtn.bind(this,this.buttons[a])),u[t].addEventListener("touchstart",this.clickBtn.bind(this,this.buttons[a])))}}sendForm(){this.sendFormData()}getTrackingData(){try{const t=[{name:"url_page",value:window.location.href},{name:"conversation_tracking",value:LadiChat_Static_Config.APP_HOME+"/inboxes"+this.conversation._id}],e=LadiChat_Helper.findGetParameter(),a=e.keys();for(const i of a)e.get(i)&&t.push({name:i,value:e.get(i)});return t}catch(t){return console.log(t),[]}}async sendFormData(){try{const a=this.doom_element.getElementsByClassName("button-submit-form")[0].getAttribute("data-config-id"),i=this.doom_element.getElementsByClassName("ladichat-form")[0],n=i.getElementsByClassName("form-field-data");let s={form_config_id:a,form_data:[],app_code:"LADI_CHAT",ladipage_id:LadiChat.storeID};const o=this.getTrackingData();s.tracking_form=o;const r={"Content-Type":"application/json"},d=LadiChat_Static_Config.API_FORM,c={},l=this.message.metadata.form_fields;for(let t=0;t<n.length;t++){let e=!0;const a=n[t];a.required&&(e=this.validateField(a,a.type,a.value));const i=a.getAttribute("data-name");if(!e)return a.classList.add("error"),void LadiChat.toastr("error","","Dữ liệu chưa chính xác, vui lòng hoàn thiện trường: "+i);a.classList.contains("error")&&a.classList.remove("error"),c[a.name]={name:a.getAttribute("data-name"),value:[a.value.trim()]};for(let t=0;t<l.length;t++)if(l[t]._id==a.getAttribute("data-id")){l[t].submit_data=a.value.trim();break}s.form_data.push({name:a.name,value:a.value.trim()})}let h={};const g=i.getElementsByClassName("form-checkbox-item");for(let t=0;t<g.length;t++){const e=g[t];if(e.checked){const t=e.name;let a=e.getAttribute("data-id"),i={};h[a]?i=h[a]:h[a]=i,i[t]?(i[t].push(e.value),c[t].value.push(e.value.trim())):(i[t]=[e.value.trim()],c[t]={name:e.getAttribute("data-name"),value:[e.value.trim()]}),h[a]=i}}const u=i.getElementsByClassName("form-radio-item");for(let t=0;t<u.length;t++){const e=u[t];if(e.checked){const t=e.name;let a=e.getAttribute("data-id"),i={};h[a]?i=h[a]:h[a]=i,i[t]?(i[t].push(e.value),c[t].value.push(e.value.trim())):(i[t]=[e.value.trim()],c[t]={name:t,value:[e.value.trim()]}),h[a]=i}}for(var t in h)if(h.hasOwnProperty(t)){const a=h[t];for(var e in a)if(a.hasOwnProperty(e)){s.form_data.push({name:e,value:a[e]});for(let i=0;i<l.length;i++)if(l[i]._id==t){l[i].submit_data=a[e];break}}}this.message.metadata.form_fields=l,this.message.metadata.disable_form=!0;let C=await LadiChat_Helper.sendRequest("POST",d,JSON.stringify(s),!0,r);if(C){if(C=JSON.parse(C),LadiChat.listCallbackForm.length>0)for(let t=0;t<LadiChat.listCallbackForm.length;t++){const e=LadiChat.listCallbackForm[t],a=e.callbackFunc;let i=e.filter,n=!0;if(i&&(i.form_id&&""!=i.form_id&&this.formID!==i.form_id&&(n=!1),i.form_type&&""!=i.form_type&&"INLINE"!=i.form_type.toUpperCase()&&(n=!1)),n&&"function"==typeof a)try{a(s)}catch(t){}}200==C.code&&this.displayFormSuccess(c,i)}}catch(t){console.log(t)}}async syncUserField(t){const e={"Content-Type":"application/json","session-key":LadiChat.token},a={data:t};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SYNC_USER_FIELD,a,e)}async displayFormSuccess(t,e,a){try{let a=!1,n={message_id:this.message._id,conversation_id:this.message.conversation_id};const s={"Content-Type":"application/json","session-key":LadiChat.token},o=e.getElementsByClassName("form-field-data");for(let t=0;t<o.length;t++)o[t].setAttribute("disabled","disabled"),o[t].setAttribute("value",o[t].value),"name"!=o[t].name&&"phone"!=o[t].name&&"email"!=o[t].name&&"birth_day"!=o[t].name||(LadiChat.storeConfig.user_info[o[t].name]=o[t].value,a=!0);a&&this.syncUserField(t),this.doom_element.getElementsByClassName("ladichat-form-wrapper")[0];const r=e.getElementsByClassName("form-checkbox-item");for(let t=0;t<r.length;t++)r[t].setAttribute("disabled","disabled");const d=this.doom_element.getElementsByClassName("button-submit-form")[0];d.setAttribute("disabled","true"),d.removeEventListener("click",this.sendForm),n.attach_form=this.message.metadata,n.new_content=this.message.message,await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_FORM_SUCCESS,n,s),this.message.metadata.tracking_script&&""!=this.message.metadata.tracking_script&&LadiChat.addScriptTrackingForm(this.message.metadata._id,this.message.metadata.tracking_script);const c=document.createElement("div");for(var i in t)if(t.hasOwnProperty(i)){let e="";e+=t[i].name+": ",e+=t[i].value.join(",");const a=document.createTextNode(e+"\n");c.appendChild(a)}let l={conversation_id:this.message.conversation_id,message:c.innerText};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,l,s)}catch(t){console.log(t)}}validateField(t,e,a){try{return t.validity.valid}catch(t){return console.log(t),!1}}showLightBox(t){}async clickBtn(t){const e={"content-type":"application/json","session-key":LadiChat.token},a={message:t.title,conversation_id:this.conversation._id};if(await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,a,e),t.payload&&""!=t.payload||t.next_id&&""!=t.next_id){const e={conversation_id:this.conversation._id,payload:t.payload,next_id:t.next_id,message_id:this.message._id},a={"content-type":"application/json","session-key":LadiChat.token};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_POSTBACK_BTN,e,a)}switch(t.type.toUpperCase()){case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.REDIRECT:t.external_link&&(window.location.href=t.external_link),t.url&&(window.location.href=t.url);break;case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.OPEN_URL:t.external_link&&window.open(t.external_link),t.url&&window.open(t.url);break;case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.FORM:const e={conversation_id:this.conversation._id,button:t,assign_id:this.conversation.assign_id,wiget_id:LadiChat.widgetID},a={"content-type":"application/json","session-key":LadiChat.token};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.ACTION_MESSAGE_BUTTON,e,a)}}generateTemplate(){let t=this.message.template;this.message.message,t=JSON.parse(t);let e=t.message,a=!1;e.attachment&&(a=(e.attachment||{}).payload||!1),this.buttons=a&&a.buttons?a.buttons:[];let i=[];switch((a&&a.template_type?a.template_type:LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT).toUpperCase()){case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.GENERIC:i=a.elements||[];let t="";if(i.length>0){let a=i[0].buttons||[],n=i[0].url||"";n.length>0&&(t+=` <img src="${n}" />`),t+='<div class="text-content-view">',e.text&&""!=e.text&&(t+=`<div> ${e.text||""}</div>`),this.buttons=a;for(let e=0;e<a.length;e++)t+=`<div\n                                class="${0==e?"btn-msg-action first-btn text-center":"btn-msg-action text-center"}"\n                                data-button="${e}"><button>${a[e].title}</button>\n                        </div>`;t+="</div>"}return t;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT:return`\n                <div class="text-content-view no-attactment">\n                    ${e.text||""}\n                </div>`;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.BUTTON:let n=`\n                <div class="text-content-view">\n                    ${e.text||""}\n                </div>`;for(let t=0;t<this.buttons.length;t++)n+=`<div\n                        class="btn-msg-action text-center ${t==this.buttons.length-1?" last-btn":""}"\n                        data-button="${t}"><button>${this.buttons[t].title}</button>\n                    </div>`;return n;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.IMAGE:i=a.elements||[];let s="";for(let t=0;t<i.length;t++)s+=`<img src="${i[t].url}" />`;return s+=`<div class="text-content-view title-template">  ${e.text||""}  </div>`,s;default:return`<div>${e.text}</div>`}}generateHTMLContent(){let t=LadiChat_Config.getStaffInfo(this.message.sender_id,this.storeConfig);t||(t=LadiChat.storeConfig.staffs[0]);let e='<div class="no-avatar">\n            <p>'+LadiChat_Helper.getDisplayName(t.name)+"</p>\n        </div>";t.avatar&&""!=t.avatar&&(e='<div class="avatar-img">\n                <img  src="'+t.avatar+'"></img>\n            </div>'),this.isShowAvatar||(e="<div></div>"),this.displayMsg=this.message.message;let a="";if(this.message.metadata){if("string"==typeof this.message.metadata&&(this.message.metadata=JSON.parse(this.message.metadata)),"LADI_CHAT_FORM"==this.message.metadata.object_type&&this.message.message.indexOf("{{form-object}}")>=0){let t=LadiChat_Helper.getFormHTML(this.message.metadata);this.displayMsg=this.message.message.replace("{{form-object}}",t)}"LADI_SALES"==this.message.metadata.type&&(a="ladisale-cart-wrapper",this.displayMsg=LadiChat_Helper.getCartData(this.message.metadata))}let i=`<div class="ladichat-msg-recieve-text ${a}" id="content-${this.message._id}"></div>`,n="";this.message.template&&""!=this.message.template&&(n="template-msg",i=this.generateTemplate(),i='<div class="content-text-view">'+i+"</div>");const s='"'+new Date(this.message.created_at).toLocaleString()+'"',o=this.isShowDate?`<div class="line">\n            <span class="ladichat-msg-datetime" id="datetime-${this.message._id}"\n                data-tooltip=${s}\n                data-tooltip-position="right">`+LadiChat_Helper.getPrettyDate(this.message.created_at)+"</span>\n            </div>\n        </div>":"";return`<div class="ladichat-message-recieve-item ${n}" id=`+this.message._id+'>\n                <div class="ladichat-message-recieve-left">'+e+' </div>\n                <div class="ladichat-message-recieve-mid">\n                    <div class="content">\n                        <div class="line">'+i+"</div>\n            "+o+"\n                    </div>\n                  \n                </div>\n            </div>"}}class MessageSent{init(t,e,a,i=!0,n=!1){this.message=t,this.isShowDate=i,this.storeConfig=a,this.conversation=e,this.isShowRead=n,this.resendData=t.resendData||!1;const s=this.generateHTMLContent(),o=document.createElement("div");o.innerHTML=s.trim();const r=o.firstChild;this.doom_element=r;const d=r.getElementsByTagName("img"),c=[],l=[];for(let t=0;t<d.length;t++){const e=d[t];e.addEventListener("click",(function(){LadiChat_Helper.openInNewTab(e.src)})),c.push(e.src),l.push(e.src.split("/").pop())}this.isFailed=!1,this.timeoutID=null,this.msgTraceID=LadiChat_Helper.generateText(5);var h=this;!this.message._id&&this.message.msg_tid&&this.resendData?this.timeoutID=setTimeout((function(){h.isFailed=!0,h.reloadElement()}),1e4):this.timeoutID&&clearTimeout(this.timeoutID)}reloadElement(){let t=this;if(!this.isFailed&&this.timeoutID)return clearTimeout(this.timeoutID),void(this.timeoutID=null);const e=this.generateHTMLContent(),a=document.createElement("div");a.innerHTML=e.trim();const i=a.innerHTML;let n=LadiChat.iframeDoc.getElementById("message-"+this.message.msg_tid);if(!n)return;n.innerHTML=i;const s=LadiChat.iframeDoc.getElementById("resend-"+this.message.msg_tid);s.addEventListener("click",(async function(){s.parentNode.removeChild(s),t.isFailed=!1,!t.message._id&&t.message.msg_tid&&t.resendData&&(t.timeoutID&&clearTimeout(t.timeoutID),t.timeoutID=setTimeout((function(){t.isFailed=!0,t.reloadElement()}),1e4),await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_MESSAGE,t.resendData.data,t.resendData.headers))}))}generateHTMLContent(){let t=!1;if(0==this.message.read_users.length)t=!1;else for(let e=0;e<this.storeConfig.staffs.length;e++)if(this.message.read_users.indexOf(this.storeConfig.staffs[e].ladi_uid)>=0){t=!0;break}let e="";!this.message._id&&this.message.msg_tid&&this.isFailed&&(e=`<span class="re-sent-msg" id="resend-${this.message.msg_tid}">\n            <svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n                <g id="Protype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n                    <g id="Elements" transform="translate(-881.000000, -64.000000)" fill="#E02020" fill-rule="nonzero">\n                        <g id="Checkbox" transform="translate(865.000000, 31.000000)">\n                            <g id="Checked" transform="translate(16.000000, 4.000000)">\n                                <path d="M7.625,44.25 C9.02291667,44.25 10.3043403,43.9111111 11.4692708,43.2333333 C12.6342014,42.5555556 13.5555556,41.6342014 14.2333333,40.4692708 C14.9111111,39.3043403 15.25,38.0229167 15.25,36.625 C15.25,35.2270833 14.9111111,33.9456597 14.2333333,32.7807292 C13.5555556,31.6157986 12.6342014,30.6944444 11.4692708,30.0166667 C10.3043403,29.3388889 9.02291667,29 7.625,29 C6.22708333,29 4.94565972,29.3388889 3.78072917,30.0166667 C2.61579861,30.6944444 1.69444444,31.6157986 1.01666667,32.7807292 C0.338888889,33.9456597 0,35.2270833 0,36.625 C0,38.0229167 0.338888889,39.3043403 1.01666667,40.4692708 C1.69444444,41.6342014 2.61579861,42.5555556 3.78072917,43.2333333 C4.94565972,43.9111111 6.22708333,44.25 7.625,44.25 Z M7.94270833,38.5947917 L7.30729167,38.5947917 L6.98958333,31.7958333 L8.26041667,31.7958333 L7.94270833,38.5947917 Z M7.625,41.4541667 C7.41319444,41.4541667 7.23315972,41.3800347 7.08489583,41.2317708 C6.93663194,41.0835069 6.8625,40.9034722 6.8625,40.6916667 C6.8625,40.4798611 6.93663194,40.2998264 7.08489583,40.1515625 C7.23315972,40.0032986 7.41319444,39.9291667 7.625,39.9291667 C7.83680556,39.9291667 8.01684028,40.0032986 8.16510417,40.1515625 C8.31336806,40.2998264 8.3875,40.4798611 8.3875,40.6916667 C8.3875,40.9034722 8.31336806,41.0835069 8.16510417,41.2317708 C8.01684028,41.3800347 7.83680556,41.4541667 7.625,41.4541667 Z" id=""></path>\n                            </g>\n                        </g>\n                    </g>\n                </g>Z\n            </svg><a>Gửi tin nhắn thất bại, ấn để gửi lại</a></span>`);const a=""+LadiChat_Helper.getPrettyDate(this.message.created_at),i=LadiChat.currentLanguage&&LadiChat.currentLanguage.dataJson&&LadiChat.currentLanguage.dataJson.externalMessage?LadiChat.currentLanguage.dataJson.externalMessage:{},n=i.unread_status?i.unread_status:"Chưa xem",s=i.read_status?i.read_status:"Đã xem",o=" - "+(t?s:n),r='"'+new Date(this.message.created_at).toLocaleString()+'"',d=this.isShowDate&&!this.isFailed?`<div style="float: right" data-tooltip=${r}\n        data-tooltip-position="left">\n            <span class="ladichat-msg-datetime" id="datetime-${this.message._id?this.message._id:this.message.msg_tid}">\n            ${a+(this.isShowRead?o:"")} \n            </span>\n        </div>`:"";let c=this.message.metadata||"",l=this.message.message,h=LadiChat_Helper.getAllImages(l).urls;if(l=LadiChat_Helper.escapeHTML(l),c&&c.length>0){if(c=JSON.parse(c),c.type==LadiChat_Config.SHARE_MEDIA.IMAGE){l="";for(let t=0;t<c.images.length;t++)l+=`<img src ='${c.images[t].url}'/>`}if(c.type==LadiChat_Config.SHARE_MEDIA.DOCUMENT){l="";for(let t=0;t<c.documents.length;t++){let e=c.documents[t];l+=`<a href ='${e.url}'target="_blank"><i class="ladiui icon icon-attachment"></i>${e.name}</a>`}}}if(h.length>0){l="";for(let t=0;t<h.length;t++){let e=h[t];e=e.replace("https://w.ladicdn.com/","https://w.ladicdn.com/s500x500/"),l+=`<img src ='${e}'/>`}}return`<div class="ladichat-message-sent-item" id="message-${this.message._id?this.message._id:this.message.msg_tid}">\n            <div class="content">\n                <div class="line">\n                    <div class="ladichat-msg-sent-text">`+l+"</div>\n                </div>\n                "+(this.isFailed?e:d)+"\n            </div>\n        </div>"}}class MessageStarted{init(t){this.template=t;const e=this.generateHTMLContent(),a=document.createElement("div");a.innerHTML=e.trim();const i=a.firstChild;this.doom_element=i;let n=i.getElementsByClassName("btn-msg-action");if(n&&n.length>0)for(let t=0;t<n.length;t++){const e=n[t].getAttribute("data-button");for(let a=0;a<this.buttons.length;a++)a==e&&(n[t].addEventListener("click",this.clickBtn.bind(this,this.buttons[a]),!1),n[t].addEventListener("click",(t=>{t.stopPropagation()})))}i.addEventListener("click",this.sendCreated.bind(this))}async sendCreated(){LadiChat.token||(LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,await LadiChat.createNewSession());const t={"content-type":"application/json","session-key":LadiChat.token},e={template:this.template},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_START_MESSAGE,e,t);if(200==a.code||201==a.code){LadiChat.currentPreviewConv=a.data,LadiChat.storeConfig.user_info.conversation=a.data,LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig);let t=!1;for(let e=0;e<LadiChat.listConversation.length;e++)if(LadiChat.listConversation[e]._id==LadiChat.currentPreviewConv._id){t=!0;break}t||(LadiChat.listConversation.push(LadiChat.currentPreviewConv),LadiChat_Helper.handleChangeConversation(LadiChat.listConversation)),LadiChat.showConversationStream(LadiChat.currentPreviewConv),LadiChat.currentPreviewConv=null}}async clickBtn(t){LadiChat.token||(LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,await LadiChat.createNewSession());const e={"content-type":"application/json","session-key":LadiChat.token},a={template:this.template,selected_msg:t.title},i=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_START_MESSAGE,a,e);switch(200!=i.code&&201!=i.code||(LadiChat.currentPreviewConv=i.data,LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat.showConversationStream(LadiChat.currentPreviewConv),LadiChat.currentPreviewConv=null,this.conversation=i.data),t.type.toUpperCase()){case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.REDIRECT:t.external_link&&(window.location.href=t.external_link),t.url&&(window.location.href=t.url);break;case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.OPEN_URL:t.external_link&&window.open(t.external_link),t.url&&window.open(t.url);break;case LadiChat_Config.FLOW_CONFIG.BUTTON_TYPE.FORM:const e={conversation_id:this.conversation._id,button:t,assign_id:this.conversation.assign_id,wiget_id:LadiChat.widgetID},a={"content-type":"application/json","session-key":LadiChat.token};setTimeout((()=>{LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.ACTION_MESSAGE_BUTTON,e,a)}),1e3)}}generateTemplate(){try{let t=this.template.message,e=!1;t.attachment&&(e=(t.attachment||{}).payload||!1),this.buttons=[],e&&e.template_type?e.template_type:LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT;let a=e.elements||[],i="";if(a.length>0){let e=a[0].buttons||[],n=a[0].url||"";n.length>0&&(i+=` <img src="${n}" />`),i+='<div class="text-content-view">',t.text&&""!=t.text&&(i+=`<div> ${t.text||""}</div>`);for(let t=0;t<e.length;t++)this.buttons.push(e[t]),i+=`<div\n                    class="${0==t?"btn-msg-action first-btn text-center":"btn-msg-action text-center"}"\n                    data-button="${t}"><button>${e[t].title}</button>\n                </div>`}return i}catch(t){console.log(t)}}generateHTMLContent(){let t=this.generateTemplate();return t='<div class="content-text-view" id="content-'+this.template._id+'">'+t+"</div>",t}}class MessageTrigger{init(t){this.template=t;const e=this.generateHTMLContent(),a=document.createElement("div");a.innerHTML=e.trim();const i=a.firstChild;this.doom_element=i,i.getElementsByClassName("btn-msg-action"),i.addEventListener("click",this.sendCreated.bind(this))}async sendCreated(){LadiChat.token||(LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,await LadiChat.createNewSession());const t={"content-type":"application/json","session-key":LadiChat.token},e={trigger_id:this.template.trigger_id},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.START_TRIGER,e,t);200!=a.code&&201!=a.code||(LadiChat.currentPreviewConv=a.data,LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat.showConversationStream(LadiChat.currentPreviewConv),LadiChat.currentPreviewConv=null)}async clickBtn(t){const e={"content-type":"application/json","session-key":LadiChat.token},a={template:this.template,selected_msg:t.title},i=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_START_MESSAGE,a,e);if(200==i.code||201==i.code){LadiChat.currentPreviewConv=i.data,LadiChat.storeConfig.user_info.conversation=i.data,LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig);let t=!1;for(let e=0;e<LadiChat.listConversation.length;e++)if(LadiChat.listConversation[e]._id==LadiChat.currentPreviewConv._id){t=!0;break}t||(LadiChat.listConversation.push(LadiChat.currentPreviewConv),LadiChat_Helper.handleChangeConversation(LadiChat.listConversation)),LadiChat.showConversationStream(LadiChat.currentPreviewConv),LadiChat.currentPreviewConv=null}}generateTemplate(){try{this.buttons=[];let t=this.template,e="";switch(t.type){case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT:if(""!=t.message&&(e+='<div class="text-content-view"><div>'+t.message+" </div>"),t.buttons.length>0){for(let a=0;a<t.buttons.length;a++)this.buttons.push(t.buttons[a]),e+=`<div\n                            class="${0==a?"btn-msg-action first-btn text-center":"btn-msg-action text-center"}"\n                            data-button="${a}"><button>${t.buttons[a].title}</button>\n                        </div>`;e+="<div class='close-preview'><i  class=\"ladiui icon icon-ldp-close\"></i></div> </div>"}break;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.IMAGE:""!=t.img_url&&(e+=`<img src="${t.img_url}"/>`),""!=t.message&&(e+='<div class="text-content-view"><div>'+t.message+" </div>"),e+="<div class='close-preview'><i  class=\"ladiui icon icon-ldp-close\"></i></div> </div>";break;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.FORM:let a=LadiChat_Helper.getFormHTML(t.form);e+=`<div class="ladichat-msg-recieve-text" id="content-${this.template.hash}">${a}<div class='close-preview'><i  class="ladiui icon icon-ldp-close"></i></div> </div>`}return e}catch(t){console.log(t)}}generateHTMLContent(){let t=this.generateTemplate();return this.template.type!=LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.FORM&&(t='<div class="content-text-view" id="content-'+this.template.hash+'">'+t+"</div>"),t}}class MessageTyping{init(t,e,a){this.typingUser=t,this.conversation=e,this.storeConfig=a;const i=this.generateHTMLContent(),n=document.createElement("div");n.innerHTML=i.trim();const s=n.firstChild;this.doom_element=s}generateHTMLContent(){const t=LadiChat_Config.getStaffInfo(this.typingUser,this.storeConfig);let e='<div class="no-avatar">\n            <p>'+LadiChat_Helper.getDisplayName(t.name)+"</p>\n        </div>";return t.avatar&&""!=t.avatar&&(e='<div class="avatar-img">\n                <img  src="'+t.avatar+'"></img>\n            </div>'),'<div class="ladichat-message-recieve-item" id=\'message-typing-'+this.typingUser+'\'>\n                <div class="ladichat-message-recieve-left">'+e+' </div>\n                <div class="ladichat-message-recieve-mid">\n                    <div class="content">\n                        <div class="line">\n                            <div class="ladichat-typing user">\n                                <span class="dot"></span>\n                                <span class="dot"></span>\n                                <span class="dot"></span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n        </div>'}}class Modal{init(t){const e=this.generateHTMLContent(t);this.doom_element=e}generateHTMLContent(t){const e=document.createElement("div");return e.setAttribute("class","ladiui-modal visible"),e.innerHTML=t,e}}class PopupForm{init(t,e,a,i){this.configStartPage=e.startPage?e.startPage:LadiChat_Config.defaultStartPageConfig,this.storeConfig=e,this.selectedForm=a;const n=this.generateHTMLContent();this.token=t,this.callbackData=i,this.doom_element=n,this.name=LadiChat_Config.SCREEN_NAME.FORM_POPUP}setConversation(t){this.conversation=t}getTrackingData(t=""){try{const e=[{name:"url_page",value:window.location.href},{name:"conversation_tracking",value:LadiChat_Static_Config.APP_HOME+"/inboxes"+t}],a=LadiChat_Helper.findGetParameter(),i=a.keys();for(const t of i)a.get(t)&&e.push({name:t,value:a.get(t)});return e}catch(t){return console.log(t),[]}}async sendFormData(){try{const a=this.mainDocument.getElementById("form-"+this.selectedForm._id),i=this.selectedForm.form_config_id,n=a.getElementsByClassName("form-field-data");let s={form_config_id:i,form_data:[],app_code:"LADI_CHAT",ladipage_id:LadiChat.storeID};const o=this.getTrackingData();s.tracking_form=o;const r={"Content-Type":"application/json"},d=LadiChat_Static_Config.API_FORM,c={};for(let t=0;t<n.length;t++){let e=!0;const a=n[t];a.required&&(e=this.validateField(a,a.type,a.value));const i=a.getAttribute("data-name");if(!e)return a.classList.add("error"),void LadiChat.toastr("error","","Dữ liệu chưa chính xác, vui lòng hoàn thiện trường: "+i);a.classList.contains("error")&&a.classList.remove("error"),c[a.name]={name:a.getAttribute("data-name"),value:[a.value.trim()]},s.form_data.push({name:a.name,value:a.value.trim()})}let l={};const h=a.getElementsByClassName("form-checkbox-item");for(let t=0;t<h.length;t++){const e=h[t];if(e.checked){const t=e.name;l[t]?(l[t].push(e.value),c[t].value.push(e.value.trim())):(l[t]=[e.value.trim()],c[t]={name:e.getAttribute("data-name"),value:[e.value.trim()]})}}for(var t in l)if(l.hasOwnProperty(t)){var e=l[t];s.form_data.push({name:t,value:e})}if(i&&await LadiChat_Helper.sendRequest("POST",d,JSON.stringify(s),!0,r),LadiChat.listCallbackForm.length>0)for(let t=0;t<LadiChat.listCallbackForm.length;t++){const e=LadiChat.listCallbackForm[t],a=e.callbackFunc;let i=e.filter,n=!0;if(i&&(i.form_id&&""!=i.form_id&&this.selectedForm._id!==i.form_id&&(n=!1),i.form_type&&""!=i.form_type&&"POPUP"!=i.form_type.toUpperCase()&&(n=!1)),n&&"function"==typeof a)try{a(s)}catch(t){}}LadiChat.token||await LadiChat.createNewSession(),this.displayFormSuccess(c)}catch(t){console.log(t)}}validateField(t,e,a){try{return t.validity.valid}catch(t){return console.log(t),!1}}async syncUserField(t){const e={"Content-Type":"application/json","session-key":LadiChat.token},a={data:t};await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SYNC_USER_FIELD,a,e)}async displayFormSuccess(t){try{const a=document.createElement("div");let i=document.createElement("div");a.appendChild(i);let n=!1;for(var e in t)if(t.hasOwnProperty(e)){let i="";i+=t[e].name+": ",i+=t[e].value.join(",");const s=document.createTextNode(i+"\n");a.appendChild(s),"name"!=e&&"phone"!=e&&"email"!=e&&"birth_day"!=e||(LadiChat.storeConfig.user_info[e]=t[e].value[0],n=!0)}const s=this.selectedForm.success_text&&""!=this.selectedForm.success_text?this.selectedForm.success_text:"Cám ơn bạn đã điền thông tin. \n",o=document.createTextNode(s);a.appendChild(o);let r={message:a.innerText};const d={"Content-Type":"application/json","session-key":LadiChat.token};let c=LadiChat_Config.API_ROUTE.SEND_MESSAGE;this.callbackData&&"send_message"===this.callbackData.action&&(r=this.callbackData,this.conversation=this.callbackData.conversation,r.conversation_id=this.conversation?this.conversation._id:"",c=this.callbackData.api),this.callbackData&&"create_start_conversation"===this.callbackData.action&&(r=this.callbackData.data,c=this.callbackData.api),this.callbackData=null;let l=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,c,r,d);201!==l.code&&200!==l.code||this.conversation||(this.conversation=l.data.conversation,n&&await this.syncUserField(t)),LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.storeConfig.user_info.conversation={_id:this.conversation._id,assign_id:this.conversation.assign_id,store_id:this.conversation.store_id},LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.showConversationStream(this.conversation)}catch(t){console.log(t)}}async createConversation(){if(this.storeConfig.user_info.is_complete_survey||!this.configStartPage.survey_enable||0==this.configStartPage.survey_data.length)return void LadiChat.showConversationStream();const t=this.mainDocument.getElementsByClassName("survey-field"),e={};let a=!0;const i=this.mainDocument.getElementById("survey-title-error");for(let n of t){let t=!0;if((this.configStartPage.survey_require&&""==n.value||""!=n.value&&"email"==n.name)&&(t=LadiChat_Helper.validateEmail(n.value),i.innerText="Email chưa đúng định dạng."),(this.configStartPage.survey_require&&""==n.value||""!=n.value&&"phone"==n.name)&&(t=LadiChat_Helper.validPhone(n.value),i.innerText="Số điện thoại chưa đúng định dạng."),(this.configStartPage.survey_require&&""==n.value||""==n.value&&"name"==n.name)&&(t=!1,i.innerText="Tên không được để trống"),this.configStartPage.survey_require){if(!t){a=!1,n.classList.add("error"),i&&(i.style.display="block");break}n.classList.remove("error"),e[n.name]=n.value}else{if(""!=n.value&&(a=t),!t){n.classList.add("error"),i&&(i.style.display="block");break}n.classList.remove("error"),i.innerText="",i.style.display="none",e[n.name]=n.value}}if(a){const t={"content-type":"application/json","session-key":LadiChat.token},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_SURVEY_DATA,e,t);if(200==a.code){let t=a.data;t.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,t=Object.assign(this.storeConfig.user_info,t),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.showConversationStream()}}}generateListAgent(){const t=document.createElement("div");t.setAttribute("class","list-agent");let e=0;for(let a=0;a<LadiChat.storeConfig.staffs.length;a++){const i=LadiChat.storeConfig.staffs[a];if(e>=3)break;if(i.online_status==LadiChat_Config.STAFF_STATUS.ONLINE){const a=LadiChat_Helper.getStaffAvatar(i);t.appendChild(a),e++}}return t}addEvent(t){const e=this;this.mainDocument=t,this.mainDocument.getElementById("button-new-conversation-conv").addEventListener("click",(function(){e.sendFormData()})),this.mainDocument.getElementById("btn-skip-form").addEventListener("click",(function(){LadiChat.showStartPage()})),this.mainDocument.getElementById("ladichat-form-popup-body"),this.mainDocument.getElementById("header-welcome")}generateHeader(){this.configStartPage.logo_img?this.configStartPage.logo_img:LadiChat_Config.defaultLogo;let t="";this.storeConfig.user_info.name?t=`<p>Xin chào ${LadiChat_Helper.capitalize(this.storeConfig.user_info.name)}</p>`:this.storeConfig.user_info.email&&(t=`<p>Xin chào ${LadiChat_Helper.capitalize(this.storeConfig.user_info.email)}</p>`);const e='<div class="header-start-page"><div class="header-welcome" id="header-welcome"><div id="btn-skip-form"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><title>e-remove-2</title><g fill="#000000"><g fill="#000000"><path d="M11.17 0.99c-0.3-0.3-0.76-0.3-1.06 0l-4.03 4.03-4.03-4.03c-0.3-0.3-0.76-0.3-1.06 0s-0.3 0.76 0 1.06l4.03 4.03-4.03 4.03c-0.3 0.3-0.3 0.76 0 1.06 0.15 0.15 0.3 0.23 0.53 0.23s0.38-0.08 0.53-0.23l4.03-4.03 4.03 4.03c0.15 0.15 0.38 0.23 0.53 0.23s0.38-0.08 0.53-0.23c0.3-0.3 0.3-0.76 0-1.06l-4.03-4.03 4.03-4.03c0.3-0.3 0.3-0.76 0-1.06z"></path></g></g></svg></div>'+this.generateListAgent().outerHTML+`\n                <div class="form-desc">${this.selectedForm.description}</div></div></div>`,a=document.createElement("div");return a.innerHTML=e.trim(),a.firstChild}generateHTMLContent(){const t=document.createElement("div");t.setAttribute("class","ladichat-form-popup");const e=this.generateHeader();t.appendChild(e);const a=document.createElement("div");a.setAttribute("class","ladichat-form-popup-body survey"),a.setAttribute("id","ladichat-form-popup-body");const i=document.createElement("div");i.setAttribute("class","survey-form"),i.setAttribute("id","form-"+this.selectedForm._id);const n=this.selectedForm.form_fields;for(let t=0;t<n.length;t++){var s=n[t];const e=LadiChat_Helper.getInputType(s,this.selectedForm._id);let a=document.createElement("div");a.setAttribute("class","form-field"),a.innerHTML=`<label>${s.name}</label>${e}`,i.appendChild(a)}const o=document.createElement("p");o.setAttribute("class","survey-title error"),o.setAttribute("id","survey-title-error"),o.setAttribute("style","display: none"),this.configStartPage.survey_require&&(o.innerText=this.configStartPage.survey_uncompleted_msg||"Hãy điền đủ thông tin để tiếp tục"),i.appendChild(o),a.appendChild(i);const r=document.createElement("span");r.setAttribute("class","button-new-conversation noselect"),r.setAttribute("id","button-new-conversation-conv"),r.innerText=this.selectedForm.button_submit&&""!=this.selectedForm.button_submit?this.selectedForm.button_submit:"Bắt đầu chat",a.appendChild(r);const d=document.createElement("div");d.setAttribute("class","power-by");const c=document.createElement("a");c.setAttribute("href","https://www.ladiboost.vn"),c.setAttribute("rel","nofollow"),c.setAttribute("target","_blank");const l=document.createElement("img");return l.src=LadiChat_Config.logoPowered,c.appendChild(l),d.appendChild(c),t.appendChild(a),t.appendChild(d),t}}class PopupTicket{init(t,e,a,i){this.configStartPage=e.startPage?e.startPage:LadiChat_Config.defaultStartPageConfig,this.storeConfig=e;const n=this.generateHTMLContent();this.token=t,this.doom_element=n,this.name=LadiChat_Config.SCREEN_NAME.FORM_POPUP}async sendFormData(){try{LadiChat.token||(await LadiChat.createNewSession(),this.socket=LadiChat.socket);const a=this.mainDocument.getElementById("form-ticket"),i=a.getElementsByClassName("form-field-data");let n={form_data:[],app_code:"LADI_CHAT",store_id:LadiChat.storeID,token:LadiChat.token,widget_id:LadiChat.widgetID,url:window.location.href};const s={"Content-Type":"application/json"},o=LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.CREATE_TICKET,r={};for(let t=0;t<i.length;t++){let e=!0;const a=i[t];a.required&&(e=this.validateField(a,a.type,a.value));const s=a.getAttribute("data-name");if(!e)return a.classList.add("error"),void LadiChat.toastr("error","","Dữ liệu chưa chính xác, vui lòng hoàn thiện trường: "+s);a.classList.contains("error")&&a.classList.remove("error"),r[a.name]={name:a.getAttribute("data-name"),value:[a.value.trim()]},n.form_data.push({name:a.name,value:a.value.trim()})}let d={};const c=a.getElementsByClassName("form-checkbox-item");for(let t=0;t<c.length;t++){const e=c[t];if(e.checked){const t=e.name;d[t]?(d[t].push(e.value),r[t].value.push(e.value.trim())):(d[t]=[e.value.trim()],r[t]={name:e.getAttribute("data-name"),value:[e.value.trim()]})}}for(var t in d)if(d.hasOwnProperty(t)){var e=d[t];n.form_data.push({name:t,value:e})}let l=await LadiChat_Helper.sendRequest("POST",o,JSON.stringify(n),!0,s);l&&(l=JSON.parse(l),201==l.code&&this.displayFormSuccess(r))}catch(t){console.log(t)}}validateField(t,e,a){try{return t.validity.valid}catch(t){return console.log(t),!1}}async displayFormSuccess(t){try{const e=this.mainDocument.getElementById("ladichat-form-popup-body");e.innerHTML="";const a=document.createElement("div");a.setAttribute("class","success-ticket");const i=document.createElement("span");i.innerHTML='<svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path fill-rule="evenodd" clip-rule="evenodd" d="M26.8633 7C15.3173 7 5.86328 16.454 5.86328 28C5.86328 39.546 15.3173 49 26.8633 49C38.4093 49 47.8633 39.546 47.8633 28C47.8633 26.0744 47.6485 24.1715 47.233 22.5094C46.9986 21.5718 47.5687 20.6217 48.5063 20.3872C49.444 20.1528 50.3941 20.7229 50.6285 21.6606C51.123 23.6385 51.3633 25.8306 51.3633 28C51.3633 41.479 40.3423 52.5 26.8633 52.5C13.3843 52.5 2.36328 41.479 2.36328 28C2.36328 14.521 13.3843 3.5 26.8633 3.5C31.5022 3.5 35.9205 4.72364 39.8483 7.1785C40.6679 7.69075 40.917 8.77041 40.4048 9.59C39.8925 10.4096 38.8129 10.6587 37.9933 10.1465C34.6411 8.05136 30.8694 7 26.8633 7Z" fill="#4AC000"/>\n            <path fill-rule="evenodd" clip-rule="evenodd" d="M53.1242 6.28795C53.8076 6.97137 53.8076 8.07941 53.1242 8.76283L28.0992 33.7878C27.771 34.116 27.3258 34.3004 26.8617 34.3004C26.3976 34.3004 25.9525 34.116 25.6243 33.7878L16.5243 24.6878C15.8409 24.0044 15.8409 22.8964 16.5243 22.213C17.2077 21.5295 18.3157 21.5295 18.9992 22.213L26.8617 30.0755L50.6493 6.28795C51.3327 5.60454 52.4407 5.60454 53.1242 6.28795Z" fill="#4AC000"/>\n            </svg>\n            ',a.appendChild(i);const n=document.createElement("div");n.setAttribute("class","success-ticket-title"),n.innerHTML="Gửi Ticket thành công",a.appendChild(n);const s=document.createElement("div");s.setAttribute("class","success-ticket-content"),s.innerHTML=`Yêu cầu của bạn đã được gửi, chúng tôi sẽ liên lạc lại qua email <b>${t.email.value}</b> của bạn`,a.appendChild(s),e.appendChild(a)}catch(t){console.log(t)}}generateListAgent(){const t=document.createElement("div");t.setAttribute("class","list-agent");let e=0;for(let a=0;a<LadiChat.storeConfig.staffs.length;a++){const i=LadiChat.storeConfig.staffs[a];if(e>=3)break;if(i.online_status==LadiChat_Config.STAFF_STATUS.ONLINE){const a=LadiChat_Helper.getStaffAvatar(i);t.appendChild(a),e++}}return t}addEvent(t){const e=this;this.mainDocument=t,this.mainDocument.getElementById("button-new-conversation-conv").addEventListener("click",(function(){e.sendFormData()})),this.mainDocument.getElementById("ladichat-form-popup-body"),this.mainDocument.getElementById("header-welcome")}generateHeader(){let t=this.configStartPage.wellcome_text&&""!=this.configStartPage.wellcome_text?this.configStartPage.wellcome_text:"Xin chào 👋";const e=this.configStartPage.logo_img?this.configStartPage.logo_img:LadiChat_Config.defaultLogo;let a=`<p>${t}</p>`;LadiChat.storeConfig.user_info.name?a=`<p>${t+" "+LadiChat_Helper.capitalize(LadiChat.storeConfig.user_info.name)}</p>`:LadiChat.storeConfig.user_info.email&&(a=`<p>${t+" "+LadiChat.storeConfig.user_info.email.toLowerCase()}</p>`);const i=`<div class="header-start-page"><div class="header-background"></div><div class="header-welcome" id="header-welcome">\n        <div class="logo"><img src=${e} ></div>\n        <div class="intro-text">\n            ${a}</div>\n                </div><div class="intro-store" id="intro-store">${this.configStartPage.introduce_text}</div></div>`,n=document.createElement("div");return n.innerHTML=i.trim(),n.firstChild}generateHTMLContent(){const t=document.createElement("div");t.setAttribute("id","form-ticket"),t.setAttribute("class","ladichat-startpage");const e=this.generateHeader();t.appendChild(e);const a=document.createElement("div");a.setAttribute("class","ladichat-form-popup-body survey"),a.setAttribute("id","ladichat-form-popup-body");const i=document.createElement("div");i.setAttribute("class","survey-form");let n="";for(let t=0;t<LadiChat.storeConfig.departments.length;t++){let e=LadiChat.storeConfig.departments[t];n+=`${e.name}/${e._id}\n`}const s=[{type:"input:text",code:"NAME",data_type:"TEXT_INPUT",name:"Họ Tên",holder:"Họ tên",alias_name:"name",_id:"9UAtD",type_field:"Trường mặc định"},{type:"input:email",code:"EMAIL",name:"Email",regex:"[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}",holder:"Địa chỉ Email",alias_name:"email",_id:"u_r7_",type_field:"Trường mặc định",data_type:"EMAIL"},{_id:"jiGLB",name:"Phòng ban",data_type:"DROPDOWN",holder:"Phòng ban",type:"select:option",alias_name:"department_id",data_values:n},{_id:"EDwdB",name:"Tiêu đề",data_type:"TEXT_INPUT",type:"input:text",alias_name:"ticket_title",data_values:""},{_id:"w-h1T",name:"Nội dung",place_holder:"Nội dung",data_type:"TEXT_AREA",type:"textarea:text",alias_name:"ticket_description",data_values:""}];let o=document.createElement("label");o.innerHTML="Gửi ticket",i.appendChild(o);for(let t=0;t<s.length;t++){var r=s[t];const e=LadiChat_Helper.getInputType(r,r._id);let a=document.createElement("div");a.setAttribute("class","form-field"),a.innerHTML=""+e,i.appendChild(a)}const d=document.createElement("p");d.setAttribute("class","survey-title error"),d.setAttribute("id","survey-title-error"),d.setAttribute("style","display: none"),d.innerText="Hãy điền đủ thông tin để tiếp tục",i.appendChild(d),a.appendChild(i);const c=document.createElement("span");c.setAttribute("class","button-new-conversation noselect"),c.setAttribute("id","button-new-conversation-conv"),c.innerText="Gửi yêu cầu",a.appendChild(c);const l=document.createElement("div");l.setAttribute("class","power-by");const h=document.createElement("a");h.setAttribute("href","https://www.ladiboost.vn"),h.setAttribute("rel","nofollow"),h.setAttribute("target","_blank");const g=document.createElement("img");return g.src=LadiChat_Config.logoPowered,h.appendChild(g),l.appendChild(h),t.appendChild(a),t.appendChild(l),t}}class _LadiChat{constructor(t){this.commandQueue=t||[],this.closeCallback=void 0,this.openCallback=void 0,this.firstMessageCallback=void 0,this.isProcessQueue=!1,this.timeoutID=null,this.timeoutConversation=null,this.initSuccess=!1,this.isCreatingConv=!1,this.isShowNotification=!1,this.isFirstSession=!0,this.listConversation=[],this.listCallbackForm=[],this.listCallbackWidget=[],this.top10Emoji=[],this.isFirstShow=!1,this.sdkObject={},this.createdData=new Date,this.currentLanguage={code:"vi",name:"Vietnamese",nativeName:"Vietnamese"},this.oldSelectedLanguage="vi",this.currentPreviewConv=!1,this.isShowButton=!0,this.lastHeight={},this.tempID=!1,this.isLoadOldSession=!1,this.s3Content=!1,this.syncData=!1,this.listEvent=[],this.retryTime=5e3,this.maxRetry=10,this.currentRetry=0,this.intervalRetry=!1,this.countWait=0,this.timeoutWait=3e3,this.prepostData=[],this.intervalID=null}async init(t){try{if(LadiChat.toastCount=1,LadiChat.storeID=t.store_id,LadiChat.widgetID=t.widget_id,LadiChat.version=t.version,document.addEventListener("visibilitychange",(function(){document.hidden&&(LadiChat.isShowNotification=!0)})),!await LadiChat.checkDomainWhiteList(LadiChat.storeID,LadiChat.widgetID))return;LadiChat.isMobile=LadiChat_Helper.detectMobile(),LadiChat.token=LadiChat_Helper.getCookie(LadiChat_Config.SESSION_KEY+LadiChat.storeID),LadiChat.storeConfig={},(new Date).getTime();let e=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);if(e&&""!=e){let t=LadiChat.storeConfig.user_info;e.user_info=Object.assign(e.user_info,t),LadiChat.storeConfig=e,e.user_info&&e.user_info.temp_id&&(LadiChat.tempID=e.user_info.temp_id)}if(LadiChat.listTyping=[],LadiChat.firstRender=!1,LadiChat.mainPage=null,LadiChat.isWhiteList=!1,LadiChat.isOffLine=!1,LadiChat.notShowWidget=!0,LadiChat.token&&LadiChat.initSocket(),await LadiChat.getStoreConfig(),!LadiChat.isWhiteList||LadiChat.notShowWidget)return;LadiChat.visibleWidget=!0,await LadiChat.buildChatWidget(),await LadiChat.buildButtonWidget(),!LadiChat.isProcessQueue&&null==LadiChat.timeoutID&&LadiChat.commandQueue.length>0&&(LadiChat.timeoutID=setTimeout(LadiChat.processQueue,200));const a=[];for(let t=0;t<LadiChat.storeConfig.staffs.length&&(LadiChat.storeConfig.staffs[t].avatar&&""!=LadiChat.storeConfig.staffs[t].avatar&&a.push(LadiChat.storeConfig.staffs[t].avatar),5!=a);t++);LadiChat.listAvatar=a}catch(t){console.log(t)}}querySelector(t,e){return(e=e||LadiChat.iframeDoc).querySelectorAll(t)}addEvent(){LadiChat.forEach(LadiChat.querySelector(".ladiui-select-init:not([disabled])"),(function(t){t.removeEventListener("click",LadiChat.openSelectOption),t.addEventListener("click",LadiChat.openSelectOption)})),LadiChat.iframeDoc.addEventListener("click",LadiChat.hideAllInactiveMenus)}openSelectOption(t){let e=!0;return void 0!==t.target.parentNode.children[2]&&(e=t.target.parentNode.children[2].classList.contains("visible")),void 0!==t.target.parentNode.parentNode.children[2]&&(e=t.target.parentNode.parentNode.children[2].classList.contains("visible")),LadiChat.forEach(LadiChat.querySelector(".ladiui-select-options ul"),(function(t){t.classList.remove("visible")})),void 0!==t.target.parentNode.children[2]&&(e?t.target.parentNode.children[2].classList.remove("visible"):t.target.parentNode.children[2].classList.add("visible")),void 0!==t.target.parentNode.parentNode.children[2]&&(t.target.parentNode.parentNode.children[2],e?t.target.parentNode.parentNode.children[2].classList.remove("visible"):t.target.parentNode.parentNode.children[2].classList.add("visible"),t.stopPropagation()),!0}hideAllInactiveMenus(t){let e=!1;if(!(t.target.parentNode&&t.target.parentNode.classList&&t.target.parentNode.classList.contains("search-dropdown"))){if(t.path)for(let a=0;a<t.path.length;a++)if(null!=t.target.parentNode&&"#document"!=t.target.parentNode.nodeName&&null!=t.target.parentNode.parentNode&&"#document"!=t.target.parentNode.parentNode.nodeName&&t.path[a].classList){for(let i=0;i<t.path[a].classList.length;i++)if("ladiui-sidebar-account"===t.path[a].classList[i]){e=!0;break}if(e)break}e||LadiChat.forEach(LadiChat.querySelector(".ladichat-account-sidebar"),(function(t){t.classList.remove("-visible")})),null!=t.target.parentNode&&"#document"!=t.target.parentNode.nodeName&&null!=t.target.parentNode.parentNode&&"#document"!=t.target.parentNode.parentNode.nodeName&&(t.target.parentNode.parentNode.classList.contains("show")&&t.target.parentNode.parentNode.classList.contains("ladiui")&&t.target.parentNode.parentNode.classList.contains("submenu")&&t.target.parentNode.parentNode.classList.remove("show"),t.target.classList.contains("ladiui-search-dropdown")||t.target.classList.contains("ladiui-search-input")||(LadiChat.forEach(LadiChat.querySelector(".ladiui-search-dropdown"),(function(t){t.classList.remove("active"),t.children[1].classList.remove("open"),t.children[1].classList.remove("hide")})),LadiChat.forEach(LadiChat.querySelector(".ladiui-search-dropdown-menu"),(function(t){t.classList.remove("visible")}))),t.target.classList.contains("ladiui-select-init")||LadiChat.forEach(LadiChat.querySelector(".ladiui-select-options ul"),(function(t){t.classList.remove("visible")}))),t.target.closest(".ladiui.nav.nav-accordion")||LadiChat.forEach(LadiChat.querySelector(".mini-navbar .ladiui.submenu.show"),(function(t){t.classList.remove("show")})),t=this,LadiChat.forEach(LadiChat.querySelector("li.ladiui-dropdown.-active:not(:hover)",t.parent),(function(t){t.hideMenu&&t.hideMenu()}))}}initSocket(){try{const t={};if(LadiChat.token?(t.session_key=LadiChat.token,t.user_id=LadiChat.storeConfig.user_info.user_id):t.temp_id=LadiChat.tempID,LadiChat.socket){let t=LadiChat.socket.query.user_id;if(LadiChat.storeConfig.user_info.user_id==t)return}LadiChat.socket=null;const e=Math.floor(30*Math.random()+1);LadiChat.socket=io.connect(LadiChat_Static_Config.END_POINT,{transports:["websocket","polling"],query:t,reconnection:!0,reconnectionDelay:1e3*e,reconnectionDelayMax:5e3*Math.floor(30*Math.random()+1),reconnectionAttempts:5}),LadiChat.socket.on("connect",(function(){LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc()})),LadiChat.socket.on("disconnect",(function(){LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc()})),LadiChat.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,(function(t){LadiChat.handlerNewMessage(t)})),LadiChat.socket.on(LadiChat_Config.SOCKET_EVENT.READ_MESSAGE,(function(t){LadiChat.handlerReadMessage(t)})),LadiChat.socket.on(LadiChat_Config.SOCKET_EVENT.ON_TYPING,(function(t){LadiChat.handlerOnTyping(t)})),LadiChat.socket.on(LadiChat_Config.SOCKET_EVENT.END_TYPING,(function(t){LadiChat.handlerEndTyping(t)})),LadiChat.socket.on(LadiChat_Config.SOCKET_EVENT.PREVIEW_TRIGGER,(function(t){LadiChat.handlerPreviewMessage(t)}))}catch(t){console.log(t)}}handlerPreviewMessage(t){try{LadiChat.showPreviewTrigger(t)}catch(t){console.log(t)}}handlerOnTyping(t){try{if(t.ladi_uid){const e=t.conversation_id;let a=LadiChat.listTyping[e];if(a){let e=-1;for(let i=0;i<a.length;i++)if(a[i].ladi_uid==t.ladi_uid){e=i;break}e<0&&a.push(t)}else a=[t];LadiChat.listTyping[e]=a,LadiChat.mainPage.name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&LadiChat.mainPage.conversation._id==e&&(LadiChat.mainPage.listTyping=a,LadiChat.mainPage.reloadMessagesList())}}catch(t){console.log(t)}}handlerEndTyping(t){try{if(t.ladi_uid){const e=t.conversation_id,a=LadiChat.listTyping[e];if(a){for(let e=0;e<a.length;e++)if(a[e].ladi_uid==t.ladi_uid){a.splice(e,1);break}LadiChat.listTyping[e]=a,LadiChat.mainPage.name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&LadiChat.mainPage.conversation._id==e&&(LadiChat.mainPage.listTyping=a,LadiChat.mainPage.reloadMessagesList())}}}catch(t){console.log(t)}}handlerReadMessage(t){if(LadiChat.storeConfig.unread_message&&LadiChat.storeConfig.unread_message.length>0){for(let e=0;e<LadiChat.listConversation.length;e++){const a=LadiChat.listConversation[e];if(a._id==t.conversation_id&&a.lastMsg&&a.lastMsg._id==t._id){const i=a.lastMsg.read_users||[];i.indexOf(t.user_read_id)<0&&(i.push(t.user_read_id),LadiChat.listConversation[e].lastMsg.read_users=i);break}}for(let e=0;e<LadiChat.storeConfig.unread_message.length;e++)if(LadiChat.storeConfig.unread_message[e].message_id==t._id){LadiChat.storeConfig.unread_message.splice(e,1);const t=LadiChat.iframeDoc.getElementById("badge-new-message"),a=document.createTextNode(LadiChat.storeConfig.unread_message.length);t.innerHTML="",t.appendChild(a),0==LadiChat.storeConfig.unread_message.length&&t.classList.contains("visible")&&t.classList.remove("visible"),LadiChat.storeConfig.unread_message.length>0&&!t.classList.contains("visible")&&t.classList.add("visible");break}}}async handlerNewMessage(t){try{if("SYSTEM"==t.type||"NOTE"==t.type)return;if(LadiChat_Helper.handleChangeMessage([t]),t.read_users.indexOf(LadiChat.storeConfig.user_info.user_id)<0){if(LadiChat.storeConfig.unread_message&&LadiChat.storeConfig.unread_message.length>=0){LadiChat.storeConfig.unread_message.push({message_id:t._id});const e=LadiChat.iframeDoc.getElementById("badge-new-message"),a=document.createTextNode(LadiChat.storeConfig.unread_message.length);e.innerHTML="",e.appendChild(a),0==LadiChat.storeConfig.unread_message.length&&e.classList.contains("visible")&&e.classList.remove("visible"),LadiChat.storeConfig.unread_message.length>0&&!e.classList.contains("visible")&&e.classList.add("visible")}this.playNotification(t)}if(!LadiChat.storeConfig.user_info.is_show_widget){if(0==LadiChat.listConversation.length){const t={token:LadiChat.token},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_CONVERSATION,t);200==e.code&&(LadiChat.listConversation=[],LadiChat.listConversation=e.data.conversations)}for(let e=0;e<LadiChat.listConversation.length;e++)if(t.conversation_id==LadiChat.listConversation[e]._id){LadiChat.listConversation[e].list_message||(LadiChat.listConversation[e].list_message=[]),LadiChat.listConversation[e].list_message.length>3&&LadiChat.listConversation[e].list_message.shift(),LadiChat.listConversation[e].list_message.push(t),t.read_users.indexOf(LadiChat.storeConfig.user_info.user_id)<0&&LadiChat.showLastMessage(t,LadiChat.listConversation[e]);break}}}catch(t){console.log(t)}}playNotification(t){t.sender_id==LadiChat.storeConfig.user_info.user_id||LadiChat.isShowNotification&&LadiChat_Helper.playSound(LadiChat_Config.soundNotification)}async changeLanguage(t){try{for(let a=0;a<LadiChat.storeConfig.listLanguage.length;a++){let i=LadiChat.storeConfig.listLanguage[a];if(i.code==t){LadiChat.currentLanguage=i,LadiChat.oldSelectedLanguage=t;let a=i.dataJson;var e=JSON.parse(a.start_page);LadiChat.storeConfig.startPage=Object.assign(LadiChat.storeConfig.startPage,e),LadiChat.storeConfig.startPage.article_data&&LadiChat.storeConfig.startPage.article_data.length>0&&(LadiChat.storeConfig.startPage.list_article=await this.getListArticle(LadiChat.storeConfig.startPage.article_data)),LadiChat.storeConfig.conversationPage=JSON.parse(a.conversation_page),LadiChat.retouchScreen(),LadiChat.storeConfig.oldSelectedLanguage=t,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc();break}}}catch(t){console.log(t)}}async changeColor(t,e){try{let a=LadiChat.iframeDoc.getElementsByClassName("fab");for(let i=0;i<a.length;i++)a[i].classList.remove("color-background-"+t),a[i].classList.add("color-background-"+e);a=LadiChat.iframeDoc.getElementsByClassName("ladichat-widget-header");for(let i=0;i<a.length;i++)a[i].classList.remove("color-text-and-background-"+t),a[i].classList.add("color-text-and-background-"+e);if(a=LadiChat.iframeDoc.querySelectorAll(".ladichat-startpage .header-welcome .intro-text"),a.length>0){a[0].getElementsByTagName("p");for(let i=0;i<a.length;i++)a[i].classList.remove("color-text-and-background-"+t),a[i].classList.add("color-text-and-background-"+e)}a=LadiChat.iframeDoc.getElementById("slider"),a&&(a[i].classList.remove("color-text-and-background-"+t),a[i].classList.add("color-text-and-background-"+e)),a=LadiChat.iframeDoc.getElementsByClassName("button-new-conversation");for(let i=0;i<a.length;i++)a[i].classList.remove("color-button-text-background-"+t),a[i].classList.add("color-button-text-background-"+e);a=LadiChat.iframeDoc.getElementById("button-submit-form"),a&&(a[i].classList.remove("color-button-text-background-"+t),a[i].classList.add("color-button-text-background-"+e)),a=LadiChat.iframeDoc.getElementById("view-all-conversation"),a&&(a[i].classList.remove("color-btn-text-"+t),a[i].classList.add("color-btn-text-"+e)),a=LadiChat.iframeDoc.getElementsByClassName("ladichat-startpage .header-background");for(let i=0;i<a.length;i++)a[i].classList.remove("olor-background-"+t),a[i].classList.add("olor-background-"+e)}catch(t){console.log(t)}}async loadCss(t,e){return new Promise((function(a,i){let n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.onload=function(){a()},n.href=t,e.head.appendChild(n)}))}async getUnreadMessage(){try{const t={"content-type":"application/json","session-key":LadiChat.token},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.UNREAD_MESSAGE,{},t);200==e.code&&(LadiChat.storeConfig.unread_message=e.data.unread,LadiChat.storeConfig.list_msg=e.data.list_msg,LadiChat.storeConfig.last_conversation=e.data.last_conversation)}catch(t){console.log(t)}}async loadSdkS3(){}async getConversation(){try{const t=LadiChat_Helper.getLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID),e=!LadiChat.isFirstSession;if(t&&""!=t&&e)LadiChat.listConversation=LadiChat_Helper.sortConv(t);else{const t={token:this.token,limit:5},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_CONVERSATION,t);if(200==e.code){LadiChat.listConversation=[],LadiChat.listConversation=e.data.conversations,LadiChat_Helper.handleChangeConversation(LadiChat.listConversation),LadiChat.isFirstSession=!1;for(let t=0;t<LadiChat.listConversation.length;t++){const e=LadiChat.storeConfig.user_info.conversation;e&&e._id&&LadiChat.listConversation[t]._id==e._id&&(LadiChat.storeConfig.user_info.conversation=LadiChat.listConversation[t])}}}}catch(t){console.log(t)}}async checkDomainWhiteList(t,e){try{let a=LadiChat_Config.sdkUrlS3+t+"-"+e+".json?v="+(new Date).getTime(),i=await LadiChat_Helper.getSdk(a);i=i.trim();let n=[];i&&i.length>=0&&(n=JSON.parse(i),LadiChat.s3Content=n,JSON.parse(n.start_page));let s=n.white_list_domain||[];const o=window.location.hostname;if(o.indexOf("localhost")>=0)return!0;if(0==s.length)return!0;for(let t=0;t<s.length;t++){const e=s[t];if(e==o||o.indexOf("."+e)>=0)return!0}return!1}catch(t){console.log(t)}}async getStoreConfig(){try{this.widgetID&&""!=this.widgetID||(this.widgetID=this.storeID);let i=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID),n=!1;i&&""!=i&&(n=i.oldSelectedLanguage||!1);let s=!1,o=LadiChat.s3Content;if(!o){let t=LadiChat_Config.sdkUrlS3+this.storeID+"-"+this.widgetID+".json?v="+(new Date).getTime(),e=await LadiChat_Helper.getSdk(t);e=e.trim(),e&&e.length>=0&&(o=JSON.parse(e),LadiChat.s3Content=o)}if(!o)return void(LadiChat.notShowWidget=!0);let r=o.default_language||"vi";n&&(r=n,LadiChat.storeConfig.oldSelectedLanguage=n);const d=o.language_config||[];let c=!1;for(let t=0;t<d.length;t++)if(d[t].code==r){c=!0,LadiChat.currentLanguage=d[t],o=Object.assign(o,d[t].dataJson);break}c||(LadiChat.storeConfig.oldSelectedLanguage="vi"),LadiChat.storeConfig.listLanguage=d;var t=JSON.parse(o.start_page);LadiChat.storeConfig.startPage||(LadiChat.storeConfig.startPage={}),LadiChat.storeConfig.startPage=Object.assign(LadiChat.storeConfig.startPage,t),LadiChat.trackingScript=o.tracking_script||"",document.createElement("script"),document.body.appendChild(document.createRange().createContextualFragment(decodeURIComponent(LadiChat.trackingScript))),LadiChat.storeConfig.conversationPage=JSON.parse(o.conversation_page),LadiChat.storeConfig.widgetConfig=o.widget_config;var e=!1;o.template_conversation&&(e=JSON.parse(o.template_conversation)),LadiChat.storeConfig.templateConversation||(LadiChat.storeConfig.templateConversation={}),LadiChat.storeConfig.templateConversation=Object.assign(LadiChat.storeConfig.templateConversation,e);let l=JSON.parse(o.widget_config);LadiChat.storeConfig.contact_required=l.contact_required,void 0!==LadiChat.storeConfig.contact_required&&null!=LadiChat.storeConfig.contact_required||(LadiChat.storeConfig.contact_required=!1),LadiChat.storeConfig.white_list_domain=o.white_list_domain,s=!0,LadiChat.notShowWidget=!1;let h=!1;LadiChat.token||LadiChat.tempID||(LadiChat.tempID=LadiChat_Helper.uuidv4(),h=!0);const g=LadiChat_Helper.getCookie(LadiChat_Config.SESSION_ID+LadiChat.storeID),u={store_id:this.storeID,widget_id:this.widgetID,page_url:window.location.href,is_new_session:!1,first_visit:h,temp_id:LadiChat.tempID},C={"content-type":"application/json"};if(!g||""==g){const t=(new Date).getTime();h||(u.is_new_session=!0),LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_ID+LadiChat.storeID,t,0,window.location.pathname)}LadiChat.token&&(C["session-key"]=LadiChat.token);const f=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.GET_CONFIG,u,C);if(200==f.code){const e=f.data.store_info;if(e.pkg_exp&&(LadiChat_Helper.checkStoreExpired(e.pkg_exp)||this.initSocket()),s){let e=f.data,i=e.default_language||"vi";n&&(i=n,LadiChat.storeConfig.oldSelectedLanguage=n);const s=e.language_config||[];let o=!1;for(let t=0;t<s.length;t++)if(s[t].code==i){LadiChat.currentLanguage=s[t],o=!0,e=Object.assign(e,s[t].dataJson);break}o||(LadiChat.storeConfig.oldSelectedLanguage="vi"),LadiChat.storeConfig.listLanguage=s,LadiChat.storeConfig=Object.assign(LadiChat.storeConfig,e),t={};var a={};e.start_page?(t=JSON.parse(e.start_page),a=JSON.parse(e.conversation_page)):(t=e.startPage,a=e.conversationPage),LadiChat.storeConfig.startPage||(LadiChat.storeConfig.startPage={}),LadiChat.storeConfig.startPage=Object.assign(LadiChat.storeConfig.startPage,t),LadiChat.storeConfig.conversationPage=a}else LadiChat.storeConfig=Object.assign(LadiChat.storeConfig,f.data)}LadiChat.storeConfig.startPage.start_conversation||(LadiChat.storeConfig.startPage.start_conversation=LadiChat_Config.defaultStartPageConfig.start_conversation),LadiChat.storeConfig.user_info||(LadiChat.storeConfig.user_info={is_show_widget:!1,temp_id:LadiChat.tempID}),LadiChat.storeConfig.white_list_domain||(LadiChat.storeConfig.white_list_domain=[]);const p=window.location.hostname;if(0==LadiChat.storeConfig.white_list_domain.length)LadiChat.isWhiteList=!0;else for(let t=0;t<LadiChat.storeConfig.white_list_domain.length;t++){const e=LadiChat.storeConfig.white_list_domain[t];if(e==p||p.indexOf("."+e)>=0){LadiChat.isWhiteList=!0;break}}p.indexOf("localhost")>=0&&(LadiChat.isWhiteList=!0),LadiChat.storeConfig.startPage.article_data&&LadiChat.storeConfig.startPage.article_data.length>0&&!LadiChat.storeConfig.startPage.list_article&&(LadiChat.storeConfig.startPage.list_article=await this.getListArticle(LadiChat.storeConfig.startPage.article_data))}catch(t){console.log(t)}}async getListArticle(t){try{if(0==t.length)return;const e={"content-type":"application/json","session-key":LadiChat.token},a={ids:t,widget_id:this.widgetID},i=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_ARTICLE,a,e);return 200==i.code?i.data.articles:[]}catch(t){console.log(t)}}forEach(t,e){const a=Object.keys(t);for(let i=0;i<a.length;i++)e(t[a[i]])}showChatWidget(t=!1){let e=LadiChat.storeConfig.user_info;const a=LadiChat.iframeDoc.getElementById("svg-icon"),i=LadiChat.iframeDoc.getElementById("ladichat-widget-open"),n=LadiChat.iframeDoc.getElementById("ladichat-widget-open-mobile"),s=JSON.parse(LadiChat.storeConfig.widgetConfig);let o=10,r=10;if(s.widget_position_absolute&&(o=s.widget_position_absolute.side,r=s.widget_position_absolute.bottom),LadiChat.screen_name!=LadiChat_Config.SCREEN_NAME.FORM_POPUP&&LadiChat.screen_name!=LadiChat_Config.SCREEN_NAME.FORM_TICKET||(LadiChat.chatContainer.classList.add("is-visible"),LadiChat.chatContainer.classList.add("form-container"),LadiChat.chatWidgetOpen.classList.remove("close"),LadiChat.chatWidgetOpen.classList.add("open"),LadiChat.isMobile&&window.screen.availWidth<768?(LadiChat.frameContainer.style.width="100%","right"==s.widget_position?(LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.left="auto"):(LadiChat.frameContainer.style.left="0px",LadiChat.frameContainer.style.right="auto"),LadiChat.frameContainer.style.bottom="0px",i.style.display="none",n.style.display="none"):(LadiChat.frameContainer.style.width="400px",a.innerHTML=LadiChat.openSVG,i.style.display="block",n.style.display="none"),LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.add("is-hide"),LadiChat.frameContainer.style.height="100%",LadiChat.storeConfig.user_info.is_show_widget=!0),!LadiChat.firstRender)return e.is_show_widget?(LadiChat.chatContainer.classList.add("is-visible"),LadiChat.chatWidgetOpen.classList.remove("close"),LadiChat.chatWidgetOpen.classList.add("open"),LadiChat.isMobile&&window.screen.availWidth<768?(LadiChat.frameContainer.style.width="100%","right"==s.widget_position?(LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.left="auto"):(LadiChat.frameContainer.style.left="0px",LadiChat.frameContainer.style.right="auto"),LadiChat.frameContainer.style.bottom="0px"):LadiChat.frameContainer.style.width="400px",LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.add("is-hide"),LadiChat.frameContainer.style.height="100%",LadiChat.isMobile||(a.innerHTML=LadiChat.openSVG,i.style.display="block",n.style.display="none"),LadiChat.isMobile&&(i.style.display="none",n.style.display="block")):(LadiChat.chatContainer.classList.remove("is-visible"),LadiChat.chatWidgetOpen.classList.remove("open"),LadiChat.chatWidgetOpen.classList.add("close"),LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",LadiChat.frameContainer.style.boxShadow="unset","right"==s.widget_position?(LadiChat.frameContainer.style.right=o+"px",LadiChat.frameContainer.style.left="auto"):(LadiChat.frameContainer.style.left=o+"px",LadiChat.frameContainer.style.right="auto"),LadiChat.frameContainer.style.bottom=r+"px",a.innerHTML=LadiChat.closeSVG,i.style.display="block",n.style.display="none"),LadiChat.firstRender=!0,LadiChat.sendTracking("live_chat_show"),void(LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&e.is_show_widget?LadiChat.isShowNotification=!1:LadiChat.isShowNotification=!0);t&&this.loadOldSession(),t&&(LadiChat.screen_name!=LadiChat_Config.SCREEN_NAME.FORM_POPUP&&LadiChat.screen_name!=LadiChat_Config.SCREEN_NAME.FORM_TICKET||(LadiChat.screen_name=""),LadiChat.chatContainer.classList.contains("is-visible")?(LadiChat.chatContainer.classList.remove("is-visible"),LadiChat.chatWidgetOpen.classList.remove("open"),LadiChat.chatWidgetOpen.classList.add("close"),LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",LadiChat.frameContainer.style.boxShadow="unset","right"==s.widget_position?(LadiChat.frameContainer.style.right=o+"px",LadiChat.frameContainer.style.left="auto"):(LadiChat.frameContainer.style.left=o+"px",LadiChat.frameContainer.style.right="auto"),LadiChat.frameContainer.style.bottom=r+"px",LadiChat.isMobile&&(n.style.display="none"),i.style.display="block",setTimeout((()=>{a.innerHTML=LadiChat.closeSVG}),200),e.is_show_widget=!1,"function"==typeof LadiChat.closeCallback&&LadiChat.closeCallback.call()):(LadiChat.sendTracking("live_chat_widget_click"),LadiChat.chatContainer.classList.add("is-visible"),LadiChat.chatWidgetOpen.classList.remove("close"),LadiChat.chatWidgetOpen.classList.add("open"),LadiChat.isMobile&&window.screen.availWidth<768?(LadiChat.frameContainer.style.width="100%","right"==s.widget_position?(LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.left="auto"):(LadiChat.frameContainer.style.left="0px",LadiChat.frameContainer.style.right="auto"),LadiChat.frameContainer.style.bottom="0px"):LadiChat.frameContainer.style.width="400px",LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.add("is-hide"),LadiChat.frameContainer.style.height="100%",LadiChat.isMobile||(a.innerHTML=LadiChat.openSVG),i.style.display="block",LadiChat.isMobile&&(i.style.display="none",n.style.display="block"),e.is_show_widget=!0,"function"==typeof LadiChat.openCallback&&LadiChat.openCallback.call())),LadiChat.screen_name!=LadiChat_Config.SCREEN_NAME.FORM_POPUP&&LadiChat.chatContainer.classList.contains("form-container")&&(LadiChat.chatContainer.classList.remove("form-container"),LadiChat.isMobile?(e.is_show_widget&&(i.style.display="none",n.style.display="block"),e.is_show_widget||(i.style.display="block",n.style.display="block")):(i.style.display="block",n.style.display="none")),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE&&e.is_show_widget?LadiChat.isShowNotification=!1:LadiChat.isShowNotification=!0}closeChatWidget(){}async showStartPage(){let t=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);t=t&&""!=t?Object.assign(t,LadiChat.storeConfig):LadiChat.storeConfig;let e=LadiChat.storeConfig.user_info;e&&""!=e&&(t.user_info=e),e.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.mainPage=new StartPage,LadiChat.mainPage.init(LadiChat.token,t,LadiChat.socket),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const a=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(a),LadiChat.addEvent(),LadiChat.showChatWidget()}async showSurveyPage(){try{let t=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);t=t&&""!=t?Object.assign(t,LadiChat.storeConfig):LadiChat.storeConfig;let e=LadiChat.storeConfig.user_info;e&&""!=e&&(t.user_info=e),e.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.START_PAGE,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.mainPage=new SurveyPage,LadiChat.mainPage.init(LadiChat.token,t,LadiChat.socket),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const a=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(a),LadiChat.addEvent(),LadiChat.showChatWidget()}catch(t){console.log(t)}}async showConversationPage(){let t=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);t=t&&""!=t?Object.assign(t,LadiChat.storeConfig):LadiChat.storeConfig;let e=LadiChat.storeConfig.user_info;e&&""!=e&&(t.user_info=e),e.screen_name=LadiChat_Config.SCREEN_NAME.LIST_CONVERSATION_PAGE,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.LIST_CONVERSATION_PAGE,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.LIST_CONVERSATION_PAGE,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.mainPage=new ConversationPage,LadiChat.mainPage.init(LadiChat.token,t,LadiChat.socket),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const a=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(a),LadiChat.addEvent(),LadiChat.showChatWidget()}showConversationStream(t){let e=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);e=e&&""!=e?Object.assign(e,LadiChat.storeConfig):LadiChat.storeConfig;let a=LadiChat.storeConfig.user_info;a&&""!=a&&(e.user_info=a),a.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,t&&t._id&&(LadiChat.storeConfig.user_info.conversation={_id:t._id,assign_id:t.assign_id,store_id:t.store_id,widget_id:t.widget_id}),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.mainPage=new ConversationStream,LadiChat.mainPage.init(LadiChat.token,e,LadiChat.socket,t),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML;const i=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(i),LadiChat.addEvent(),setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible");const t=LadiChat.iframeDoc.getElementById("ladichat-typing-message");t&&t.focus()}),300),t&&(LadiChat.storeConfig.user_info.conversation=t,a.conversation=t),LadiChat.showChatWidget()}async showFormInline(t){let e="";t.description&&""!=t.description.trim()&&(e+=`<div>${t.description}</div>`),e+='<div class="ladichat-form-wrapper"><div class="ladichat-form" id="submited-form">';let a="";if(t.form_fields&&t.form_fields.length>0){for(let a=0;a<t.form_fields.length;a++){const i=t.form_fields[a],n=LadiChat_Helper.getInputType(i,t._id);e+=`<div class="form-field"><label>${i.name}</label>${n}</div>`}a=`<div class="ladichat-form submit-btn"><span contenteditable="false" class="button-submit-form noselect" id="button-submit-form" data-config-id="${t.form_config_id}">${t.button_submit}</span></div>`}if(e+="</div></div>",LadiChat.isCreatingConv)return;LadiChat.isCreatingConv=!0;const i={"content-type":"application/json","session-key":LadiChat.token},n={message:`${e}${a}`},s=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_INLINE_FORM,n,i);LadiChat.divPreviewMsg.classList.add("hidden"),s&&(LadiChat.isCreatingConv=!1),LadiChat.showConversationStream(s.data.conversation),LadiChat.showChatWidget(!0)}showFormPopup(t,e){LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation),LadiChat.divPreviewMsg.classList.add("hidden");let a=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);a=a&&""!=a?Object.assign(a,LadiChat.storeConfig):LadiChat.storeConfig;let i=LadiChat.storeConfig.user_info;i&&""!=i&&(a.user_info=i),i.screen_name=LadiChat_Config.SCREEN_NAME.FORM_POPUP,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.FORM_POPUP,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.FORM_POPUP,LadiChat.mainPage=new PopupForm,LadiChat.mainPage.init(LadiChat.token,a,t,e),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const n=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(n),LadiChat.addEvent(),LadiChat.showChatWidget()}async showTicket(){LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation),LadiChat.divPreviewMsg.classList.add("hidden");let t=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);t=t&&""!=t?Object.assign(t,LadiChat.storeConfig):LadiChat.storeConfig;let e=LadiChat.storeConfig.user_info;e&&""!=e&&(t.user_info=e),e.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.mainPage=new PopupTicket,LadiChat.mainPage.init(LadiChat.token,t),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const a=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(a),LadiChat.addEvent(),LadiChat.showChatWidget()}async showForm(t,e){try{const a=await LadiChat.getFormData(t);if(!a)return;e==LadiChat_Config.TYPE_FORM.INLINE&&LadiChat.showFormInline(a),e==LadiChat_Config.TYPE_FORM.POPUP&&LadiChat.showFormPopup(a)}catch(t){console.log(t)}}async loadWidgetStyle(){await LadiChat.loadCss("https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&display=swap",LadiChat.iframeDoc),await LadiChat.loadCss(LadiChat_Static_Config.CSS_URL+"?ver="+(new Date).getTime(),LadiChat.iframeDoc);let t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no",LadiChat.iframeDoc.head.appendChild(t),LadiChat.iframeDoc.addEventListener("touchmove",(function(t){1!==t.scale&&t.preventDefault()}),{passive:!1});const e=document.createElement("style");e.setAttribute("id","style-ladichat"),e.textContent=LadiChat_Helper.getApplyStyle(JSON.parse(LadiChat.storeConfig.widgetConfig)),LadiChat.iframeDoc.head.appendChild(e);const a=document.createElement("style");a.setAttribute("id","style-language-ladichat"),a.textContent=LadiChat_Helper.getLanguageStyle(JSON.parse(LadiChat.storeConfig.widgetConfig)),LadiChat.iframeDoc.head.appendChild(a)}async loadButtonWidgetStyle(){await LadiChat.loadCss("https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:ital,wght@0,300;0,400;0,500;1,300;1,400;1,500&display=swap",LadiChat.iframeButtonDoc),await LadiChat.loadCss(LadiChat_Static_Config.CSS_URL+"?ver="+(new Date).getTime(),LadiChat.iframeButtonDoc);let t=document.createElement("meta");t.name="viewport",t.content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no",LadiChat.iframeButtonDoc.head.appendChild(t),LadiChat.iframeButtonDoc.addEventListener("touchmove",(function(t){1!==t.scale&&t.preventDefault()}),{passive:!1});const e=document.createElement("style");e.setAttribute("id","style-ladichat"),e.textContent=LadiChat_Helper.getApplyStyle(JSON.parse(LadiChat.storeConfig.widgetConfig)),LadiChat.iframeButtonDoc.head.appendChild(e);const a=document.createElement("style");a.setAttribute("id","style-language-ladichat"),a.textContent=LadiChat_Helper.getLanguageStyle(JSON.parse(LadiChat.storeConfig.widgetConfig)),LadiChat.iframeButtonDoc.head.appendChild(a),LadiChat.frameButtonContainer.style.height=LadiChat.wrapBtnWidget.getBoundingClientRect().height}async buildButtonWidget(){try{const t=document.createElement("div");t.setAttribute("id","ladichat-widget-button");let e="\n                display: block;\n                border: none;\n                position: fixed;\n                width: 64px;\n             \n                opacity: 1;\n                bottom: 10px;\n                background: none transparent;\n                margin: 0px;\n                transition: none 0s ease 0s;\n                overflow:hidden;\n                z-index: 999999998 !important;";LadiChat.isMobile,LadiChat.frameButtonContainer=document.createElement("iframe"),LadiChat.frameButtonContainer.setAttribute("id","ladichat-widget-button-frame");const a=JSON.parse(LadiChat.storeConfig.widgetConfig);if(!1===a.button_channel_enable)return;let i="";"right"==a.button_position?(i="\n                left: auto;\n                right: 10px;\n                bottom: 10px;\n                ",a.button_position_absolute&&(i=`\n                    left: auto;\n                    right: ${a.button_position_absolute.side}px;\n                    bottom: ${a.button_position_absolute.bottom}px;\n                    `)):(i="\n                right: auto;\n                left: 10px;\n                bottom: 10px;\n                ",a.button_position_absolute&&(i=`\n                    right: auto;\n                    left: ${a.button_position_absolute.side}px;\n                    bottom: ${a.button_position_absolute.bottom}px;\n                    `)),e+=i,LadiChat.frameButtonContainer.style=e,LadiChat.wrapBtnWidget=document.createElement("div"),LadiChat.wrapBtnWidget.setAttribute("class","ladichat-wrap-btn-widget"),LadiChat.wrapBtnWidget.setAttribute("id","ladichat-wrap-btn-widget"),LadiChat.chatShotBtnOpen=document.createElement("a"),LadiChat.chatShotBtnOpen.setAttribute("id","ladichat-short-button-open"),LadiChat.chatShotBtnOpen.innerHTML='<i class="ladiui icon icon-ldp-close"/>',LadiChat.listShortButton=document.createElement("div"),LadiChat.listShortButton.setAttribute("id","ladichat-list-short-button"),LadiChat.listShortButton.setAttribute("class","ladichat-list-short-button"),LadiChat.wrapBtnWidget.appendChild(LadiChat.listShortButton),LadiChat.wrapBtnWidget.appendChild(LadiChat.chatShotBtnOpen),a.button_channel_open_type&&("click"==a.button_channel_open_type?(LadiChat.listShortButton.classList.add("is-hide"),LadiChat.frameButtonContainer.style.height="64px",LadiChat.chatShotBtnOpen.innerHTML="<img />",LadiChat.isShowButton=!1):(LadiChat.listShortButton.classList.remove("is-hide"),setTimeout((()=>{LadiChat.chatShotBtnOpen.innerHTML='<i class="ladiui icon icon-ldp-close"/>',LadiChat.frameButtonContainer.style.height=LadiChat.wrapBtnWidget.getBoundingClientRect().height+"px",LadiChat.isShowButton=!0}),500))),LadiChat.chatShotBtnOpen.addEventListener("click",(function(){LadiChat.isShowButton?(LadiChat.listShortButton.classList.add("is-hide"),LadiChat.frameButtonContainer.style.height="64px",LadiChat.chatShotBtnOpen.innerHTML="<img />",LadiChat.isShowButton=!1):(LadiChat.listShortButton.classList.remove("is-hide"),LadiChat.chatShotBtnOpen.innerHTML='<i class="ladiui icon icon-ldp-close"/>',LadiChat.frameButtonContainer.style.height=LadiChat.wrapBtnWidget.getBoundingClientRect().height+"px",LadiChat.isShowButton=!0)}));let n=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);n=n&&""!=n?Object.assign(n,LadiChat.storeConfig):LadiChat.storeConfig;let s=n.startPage||LadiChat_Config.defaultStartPageConfig;const{list_button_channels:o}=s;if(!o||0==o.length)return;let r="",d=-1;for(let t=0;t<o.length;t++){if(!o[t].is_show)continue;d++;const e=document.createElement("div");e.style.textAlign="center";const i=document.createElement("div"),n=document.createElement("a");n.setAttribute("target","_blank"),n.setAttribute("href",o[t].external_link),"PHONE"==o[t].type&&n.setAttribute("href","tel:"+o[t].external_link),"EMAIL"==o[t].type&&n.setAttribute("href","mailto:"+o[t].external_link),"FORM_POPUP"==o[t].type&&(n.removeAttribute("target"),n.removeAttribute("href"),n.setAttribute("id","item-channel-form-popup"),n.setAttribute("data-form-id",o[t].external_link)),"EXTERNAL_LINK"==o[t].type&&n.setAttribute("href",o[t].external_link);const s=o[t].channel_name.toLowerCase().replace(" ","-");i.setAttribute("class","item-short-button "+s),i.setAttribute("data-tooltip",o[t].channel_name),"right"==a.button_position?i.setAttribute("data-tooltip-position","left"):i.setAttribute("data-tooltip-position","right");const c=document.createElement("div");0==d&&(r=s);const l=document.createElement("img");c.appendChild(l),n.appendChild(c),i.appendChild(n),i.addEventListener("mouseover",(function(){LadiChat.frameButtonContainer.style.width="400px"})),i.addEventListener("mouseout",(function(){LadiChat.frameButtonContainer.style.width="64px"})),e.appendChild(i),LadiChat.listShortButton.appendChild(e)}LadiChat.chatShotBtnOpen.classList.add("all-icon-channel"),LadiChat.chatShotBtnOpen.classList.add(r),t.appendChild(LadiChat.frameButtonContainer),document.body.appendChild(t),LadiChat.mainButtonDiv=t,LadiChat.iframeButtonDoc=frames["ladichat-widget-button-frame"].contentWindow.document||frames["ladichat-widget-button-frame"].contentDocument,LadiChat.iframeButtonDoc.documentElement.appendChild(LadiChat.wrapBtnWidget),await LadiChat.loadButtonWidgetStyle()}catch(t){console.log(t)}}async buildChatWidget(t){try{LadiChat.openSVG='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><title>e-remove-2</title><g fill="#FFFFFF"><path d="M18.52 1.64c-0.5-0.5-1.26-0.5-1.76 0l-6.68 6.68-6.68-6.68c-0.5-0.5-1.26-0.5-1.76 0s-0.5 1.26 0 1.76l6.68 6.68-6.68 6.68c-0.5 0.5-0.5 1.26 0 1.76 0.25 0.25 0.5 0.38 0.88 0.38s0.63-0.13 0.88-0.38l6.68-6.68 6.68 6.68c0.25 0.25 0.63 0.38 0.88 0.38s0.63-0.13 0.88-0.38c0.5-0.5 0.5-1.26 0-1.76l-6.68-6.68 6.68-6.68c0.5-0.5 0.5-1.26 0-1.76z" fill="#FFFFFF"></path></g></svg>',LadiChat.closeSVG="<img src='https://w.ladicdn.com/ladiui/icons/ldicon-colored-widgetchat.svg'/>",LadiChat.iconURL="https://w.ladicdn.com/ladichat/ladichat_icon.svg";const t=document.createElement("div");t.setAttribute("id","ladichat");let e="\n                display: block;\n                border: none;\n                position: fixed;\n                width: 1px;\n                height: 1px;\n                box-shadow: unset;\n                opacity: 1;\n                bottom: 0px;\n                background: none transparent;\n                margin: 0px;\n                transition: none 0s ease 0s;\n                overflow:hidden;\n                border-radius: 2px;\n                z-index: 999999999 !important;\n                max-height: calc(100vh - 60px);",a="100vh";setTimeout((function(){window.innerHeight>1e3&&(a="1000px",LadiChat.isMobile&&(LadiChat.frameContainer.style.maxHeight=a))}),100);const i=JSON.parse(LadiChat.storeConfig.widgetConfig);let n="";"right"==i.widget_position?(n="\n                left: auto;\n                right: 10px;\n                bottom: 10px;\n                ",i.widget_position_absolute&&(n=`\n                    left: auto;\n                    right: ${i.widget_position_absolute.side}px;\n                    bottom: ${i.widget_position_absolute.bottom}px;\n                    `)):(n="\n                right: auto;\n                left: 10px;\n                bottom: 10px;\n                ",i.widget_position_absolute&&(n=`\n                    right: auto;\n                    left: ${i.widget_position_absolute.side}px;\n                    bottom: ${i.widget_position_absolute.bottom}px;\n                    `)),e+=n,LadiChat.frameContainer=document.createElement("iframe"),LadiChat.frameContainer.style=e,LadiChat.isMobile&&(LadiChat.frameContainer.style.maxHeight=a),LadiChat.frameContainer.setAttribute("id","ladichat-widget-frame"),LadiChat.chatWidget=document.createElement("div"),LadiChat.chatWidget.setAttribute("class","ladichat-widget"),LadiChat.chatWidget.setAttribute("id","ladichat-widget"),LadiChat.isMobile&&LadiChat.chatWidget.classList.add("mbdis"),LadiChat.chatContainer=document.createElement("div"),LadiChat.chatContainer.setAttribute("id","ladichat-widget-container"),LadiChat.chatContainer.setAttribute("class","ladichat-widget-container"),LadiChat.chatWidget.appendChild(LadiChat.chatContainer),LadiChat.lastMessagePreview=document.createElement("div"),LadiChat.lastMessagePreview.setAttribute("id","ladichat-last-message-preview"),LadiChat.lastMessagePreview.setAttribute("class","ladichat-last-message-preview is-hide"),LadiChat.chatWidget.appendChild(LadiChat.lastMessagePreview),"left"==i.widget_position?(LadiChat.chatWidget.classList.add("wg-bottom-left"),LadiChat.lastMessagePreview.style.right="unset",i.widget_position_absolute&&(LadiChat.lastMessagePreview.style.bottom=45+parseInt(i.widget_position_absolute.bottom)+"px")):LadiChat.chatWidget.classList.add("wg-bottom-right"),LadiChat.lastMessagePreview.addEventListener("click",(function(){LadiChat.currentPreviewConv&&LadiChat.currentPreviewConv._id&&(LadiChat.firstRender=!1,LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat.showConversationStream(LadiChat.currentPreviewConv),LadiChat.currentPreviewConv=null)})),LadiChat.chatWidgetOpen=document.createElement("a"),LadiChat.chatWidgetOpen.setAttribute("id","ladichat-widget-open"),LadiChat.chatWidgetOpen.setAttribute("class","fab close"),LadiChat.isMobile&&(LadiChat.chatWidgetOpen.style.display="none");let s="";i.icon_widget_size&&i.icon_widget_size==LadiChat_Config.ICON_SIZE.FULL&&(s=' class="full-size" '),i.icon_widget&&""!=i.icon_widget?(LadiChat.chatWidgetOpen.innerHTML=`<div id="svg-icon">\n                <img src="${i.icon_widget}" ${s}></img>\n            </div>`,LadiChat.closeSVG=`<img src='${i.icon_widget}' ${s}/>`):LadiChat.chatWidgetOpen.innerHTML='<div id="svg-icon">\n                    <img src="https://w.ladicdn.com/ladiui/icons/ldicon-colored-widgetchat.svg"></img>\n                </div>',LadiChat.chatWidgetOpenMobile=document.createElement("a"),LadiChat.chatWidgetOpenMobile.setAttribute("id","ladichat-widget-open-mobile"),LadiChat.isMobile||(LadiChat.chatWidgetOpenMobile.style.display="none"),LadiChat.chatWidgetOpenMobile.innerHTML='<i class="ladiui icon-ldp-close"/>',LadiChat.chatWidgetOpenMobile.addEventListener("click",(function(){if(LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation),LadiChat.divPreviewMsg.classList.add("hidden"),!LadiChat.storeConfig.user_info.is_show_widget&&!LadiChat.storeConfig.is_online&&i.offline_options.is_show){if(i.offline_options&&i.offline_options.form_id)return void LadiChat.showForm(i.offline_options.form_id,"POPUP");if(i.offline_options&&i.offline_options.is_open_ticket)return void LadiChat.showTicket()}if(i.show_compose_now&&!LadiChat.isFirstShow){LadiChat.isFirstShow=!0;let t=LadiChat.storeConfig.user_info.conversation;!t&&LadiChat.listConversation.length>0&&(t=LadiChat.listConversation[0]),t?LadiChat.showConversationStream(LadiChat.storeConfig.user_info.conversation):LadiChat.showConversationStream()}LadiChat.showChatWidget(!0)})),LadiChat.generateTemplateConversation(),LadiChat.chatWidget.appendChild(LadiChat.divPreviewMsg),LadiChat.ClosePreviewBtn.addEventListener("click",(function(){LadiChat.divPreviewMsg.classList.add("hidden"),LadiChat.iframeDoc.getElementById("svg-icon").innerHTML=LadiChat.closeSVG,LadiChat.storeConfig.user_info.ignore_conversation_id||(LadiChat.storeConfig.user_info.ignore_conversation_id=[]),LadiChat.storeConfig.user_info.ignore_conversation_id.indexOf(LadiChat.storeConfig.startPage.start_conversation.template_id)<0&&(LadiChat.storeConfig.user_info.ignore_conversation_id.push(LadiChat.storeConfig.startPage.start_conversation.template_id),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig))})),LadiChat.chatWidgetOpen.addEventListener("click",(function(){if(LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation),LadiChat.divPreviewMsg.classList.add("hidden"),!LadiChat.storeConfig.user_info.is_show_widget&&!LadiChat.storeConfig.is_online&&i.offline_options.is_show){if(i.offline_options&&i.offline_options.form_id)return void LadiChat.showForm(i.offline_options.form_id,"POPUP");if(i.offline_options&&i.offline_options.is_open_ticket)return void LadiChat.showTicket()}if(i.show_compose_now&&!LadiChat.isFirstShow){LadiChat.isFirstShow=!0;let t=LadiChat.storeConfig.user_info.conversation;!t&&LadiChat.listConversation.length>0&&(t=LadiChat.listConversation[0]),t?LadiChat.showConversationStream(LadiChat.storeConfig.user_info.conversation):LadiChat.showConversationStream()}LadiChat.showChatWidget(!0)}));const o=LadiChat.storeConfig.unread_message&&LadiChat.storeConfig.unread_message.length>0?LadiChat.storeConfig.unread_message.length:"",r=document.createElement("span");r.setAttribute("class","badge-new-message"),r.setAttribute("id","badge-new-message");const d=document.createTextNode(o);if(r.appendChild(d),o>0&&r.classList.add("visible"),LadiChat.chatWidgetOpen.appendChild(r),LadiChat.chatWidget.appendChild(LadiChat.chatWidgetOpenMobile),LadiChat.chatWidget.appendChild(LadiChat.chatWidgetOpen),t.appendChild(LadiChat.frameContainer),document.body.appendChild(t),LadiChat.mainDiv=t,LadiChat.iframeDoc=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument,LadiChat.iframeDoc.open(),LadiChat.iframeDoc.close(),LadiChat.iframeDoc.documentElement.appendChild(LadiChat.chatWidget),await LadiChat.loadWidgetStyle(),!LadiChat.storeConfig.is_online&&!i.offline_options.is_show)return void LadiChat.frameContainer.style.setProperty("display","none");LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig);const c=LadiChat_Helper.getLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID),l=c&&""!=c;if(LadiChat.retouchScreen(l),LadiChat.initSuccess=!0,!l&&LadiChat.storeConfig.startPage.enable_start_conversation){parseInt(LadiChat.storeConfig.templateConversation.from_time),parseInt(LadiChat.storeConfig.templateConversation.to_time);const t=Math.floor(3*Math.random()+1);LadiChat.timeoutConversation=setTimeout((function(){LadiChat.showStartedConversation(LadiChat.storeConfig.templateConversation)}),1e3*t)}}catch(t){console.log(t)}}retouchScreen(t){try{LadiChat.storeConfig.startPage;const t=JSON.parse(LadiChat.storeConfig.widgetConfig);!LadiChat.storeConfig.is_online&&t.offline_options.is_show;let e=!0;if(LadiChat.firstRender||(e=!1),LadiChat.storeConfig.user_info&&LadiChat.storeConfig.user_info.screen_name)if(LadiChat.storeConfig.user_info.is_show_widget&&!LadiChat.storeConfig.is_online&&t.offline_options.is_show){if(t.offline_options&&t.offline_options.is_open_ticket)return void LadiChat.showTicket()}else switch(LadiChat.storeConfig.user_info.screen_name){case LadiChat_Config.SCREEN_NAME.START_PAGE:LadiChat.showStartPage();break;case LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE:LadiChat.storeConfig.user_info.conversation&&LadiChat.storeConfig.user_info.conversation.widget_id==LadiChat.widgetID?LadiChat.showConversationStream(LadiChat.storeConfig.user_info.conversation):LadiChat.showConversationStream();break;default:LadiChat.showStartPage()}else if(LadiChat.storeConfig.user_info.is_show_widget&&!LadiChat.storeConfig.is_online&&t.offline_options.is_show){if(t.offline_options&&t.offline_options.is_open_ticket)return void LadiChat.showTicket()}else LadiChat.showStartPage();e||LadiChat.storeConfig.user_info.screen_name==LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE||LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&LadiChat.mainPage.connectFunc()}catch(t){console.log(t)}}async showPreviewTrigger(t){try{if(0==t.messages.length)return;const e=t.messages[0];let a=LadiChat_Helper.generateText(5),i={img_url:"",message:"",buttons:[],form:!1,trigger_id:t.trigger_id,hash:a,type:e.type};switch(e.type){case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.NEXT_STEP:return;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.TEXT:case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.IMAGE:if(""!=e.text&&(i.message=e.text),e.files&&e.files.length>0){const t=e.files[0];i.img_url=t.url}if(e.buttons)for(let t=0;t<e.buttons.length;t++){let a={id:LadiChat_Helper.generateText(5),type:"MESSAGE",external_link:"",form_id:"",title:e.buttons[t].title,place_holder:e.buttons[t].title};i.buttons.push(a)}break;case LadiChat_Config.FLOW_CONFIG.MESSAGE_TYPE.FORM:if(""!=e.form_id){const t=await LadiChat.getFormData(e.form_id);if(!t)return;i.form=t}}LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.remove("is-hide");const n=new MessageTrigger;n.init(i);const s=n.doom_element;LadiChat.lastMessagePreview.appendChild(s),LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.setProperty("display","block"),LadiChat.chatContainer.classList.remove("is-visible");let o=0,r=LadiChat.lastMessagePreview.getElementsByTagName("img");const d="content-"+a;if(r.length>0)for(let t=0;t<r.length;t++)r[t].onload=function(){o++,o==r.length&&(LadiChat.frameContainer.style.height="calc(100vh - 60px)",setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(d);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700))};else LadiChat.iframeDoc.getElementById(d),setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(d);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700)}catch(t){console.log(t)}}async showStartedConversation(t){try{if(LadiChat.storeConfig.user_info.is_show_widget)return;var e={};if(t.message&&""!=t.message){let a=LadiChat_Helper.generateText(5);e={message:{text:t.message,attachment:{type:"template",payload:{template_type:"generic",elements:[{media_type:"image",url:t.img_url,buttons:t.buttons}]}}},_id:a},LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.remove("is-hide");const i=new MessageStarted;i.init(e);const n=i.doom_element;LadiChat.lastMessagePreview.appendChild(n),LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.setProperty("display","block"),LadiChat.chatContainer.classList.remove("is-visible");let s=0,o=LadiChat.lastMessagePreview.getElementsByTagName("img");const r="content-"+a;if(o.length>0)for(let t=0;t<o.length;t++)o[t].onload=function(){s++,s==o.length&&(LadiChat.frameContainer.style.height="calc(100vh - 60px)",setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(r);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700))};else LadiChat.iframeDoc.getElementById(r),setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(r);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700)}}catch(t){console.log(t)}}async showTemplateConversation(t,e,a=!1){try{if(LadiChat.storeConfig.user_info.is_show_widget)return;const i=JSON.parse(LadiChat.storeConfig.widgetConfig);if(!LadiChat.storeConfig.is_online&&i.offline_options&&i.offline_options.form_id)return;const n=LadiChat.storeConfig.user_info.ignore_conversation_id||[];if(!a&&n.indexOf(t)>=0)return;let s=!1;for(let e=0;e<LadiChat.listConversation.length;e++)LadiChat.listConversation[e].template_id&&t==LadiChat.listConversation[e].template_id&&(s=LadiChat.listConversation[e]);if(0==e.length&&(s&&(e=await LadiChat.getListMessage(s)),LadiChat.storeConfig.startPage.start_conversation.template_id==t&&(e=LadiChat.storeConfig.startPage.start_conversation.list_message)),0==e.length)return;LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.setProperty("display","block"),LadiChat.chatContainer.classList.remove("is-visible"),LadiChat.divPreviewMsg.classList.remove("hidden");for(let t=0;t<e.length;t++)"string"==typeof e[t]&&(e[t]={message:e[t]});this.generateTemplateConversation(s,e);let o=LadiChat.divPreviewMsg.getBoundingClientRect().height;LadiChat.frameContainer.style.height=105+o+"px",LadiChat.ClosePreviewBtn.addEventListener("click",(function(){LadiChat.divPreviewMsg.classList.add("hidden"),LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",LadiChat.frameContainer.style.boxShadow="unset",LadiChat.isMobile?(LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.bottom="0px"):(LadiChat.frameContainer.style.right=i.widget_position_absolute.side+"px",LadiChat.frameContainer.style.bottom=i.widget_position_absolute.bottom+"px"),LadiChat.iframeDoc.getElementById("svg-icon").innerHTML=LadiChat.closeSVG,LadiChat.storeConfig.user_info.ignore_conversation_id||(LadiChat.storeConfig.user_info.ignore_conversation_id=[]),LadiChat.storeConfig.user_info.ignore_conversation_id.indexOf(LadiChat.storeConfig.startPage.start_conversation.template_id)<0&&(LadiChat.storeConfig.user_info.ignore_conversation_id.push(LadiChat.storeConfig.startPage.start_conversation.template_id),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig))}))}catch(t){console.log(t)}}showLastMessage(t,e){try{e.list_message,LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.remove("is-hide");const a=new MessagePreview;a.init(t);const i=a.doom_element;LadiChat.lastMessagePreview.appendChild(i),LadiChat.currentPreviewConv=e,LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.setProperty("display","block"),LadiChat.chatContainer.classList.remove("is-visible");let n=0,s=LadiChat.lastMessagePreview.getElementsByTagName("img");const o="content-"+t._id;if(s.length>0)for(let t=0;t<s.length;t++)s[t].onload=function(){n++,n==s.length&&(LadiChat.frameContainer.style.height="calc(100vh - 60px)",setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(o);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700))};else LadiChat.iframeDoc.getElementById(o),setTimeout((function(){const t=LadiChat.iframeDoc.getElementById(o);if(!t)return;let e=t.getBoundingClientRect().height;LadiChat.frameContainer.style.height=205+e+"px",LadiChat.frameContainer.style.width="313px"}),700)}catch(t){console.log(t)}}async showPreviewConversation(t){try{if(LadiChat.storeConfig.user_info.is_show_widget)return;const e=JSON.parse(LadiChat.storeConfig.widgetConfig),a=t.list_message;LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.setProperty("display","block"),LadiChat.chatContainer.classList.remove("is-visible"),LadiChat.divPreviewMsg.classList.remove("hidden"),this.generatePreviewMessage(t,a);let i=LadiChat.divPreviewMsg.getBoundingClientRect().height;LadiChat.frameContainer.style.height=105+i+"px",LadiChat.ClosePreviewBtn.addEventListener("click",(function(){LadiChat.divPreviewMsg.classList.add("hidden"),LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",LadiChat.frameContainer.style.boxShadow="unset",LadiChat.isMobile?(LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.bottom="0px"):(LadiChat.frameContainer.style.right=e.widget_position_absolute.side+"px",LadiChat.frameContainer.style.bottom=e.widget_position_absolute.bottom+"px"),LadiChat.iframeDoc.getElementById("svg-icon").innerHTML=LadiChat.closeSVG}))}catch(t){console.log(t)}}async getListMessage(t){try{const e={token:LadiChat.token,conversation_id:t._id},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_MESSAGE,e);if(200==a.code){const t=[];for(let e=0;e<a.data.messages.length;e++)!a.data.messages[e].deleted_all&&t.length<5&&t.push(a.data.messages[e]);return t}}catch(t){console.log(t)}}async getFormData(t){try{if(!t||""==t)return;const e={store_id:LadiChat.storeID,id:t},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SHOW_FORM,e);if(200==a.code)return a.data.form}catch(t){console.log(t)}}generateTemplateConversation(t,e){try{LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation);const t=LadiChat.storeConfig.startPage,{start_conversation:a}=t;if(LadiChat.divPreviewMsg?LadiChat.divPreviewMsg.innerHTML="":(LadiChat.divPreviewMsg=document.createElement("div"),LadiChat.divPreviewMsg.setAttribute("id","preview-new-message"),LadiChat.divPreviewMsg.classList.add("hidden")),LadiChat.ClosePreviewBtn=document.createElement("div"),LadiChat.ClosePreviewBtn.setAttribute("id","close-preview-msg"),LadiChat.ClosePreviewBtn.innerHTML='<svg width="8px" height="8px" viewBox="0 0 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n            <g id="Protype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" fill-opacity="0.3">\n                <path d="M7.42857143,8 C7.57142857,8 7.70238095,7.94047619 7.82142857,7.82142857 C7.94047619,7.70238095 8,7.57142857 8,7.42857143 C8,7.28571429 7.94047619,7.1547619 7.82142857,7.03571429 L4.78571429,4 L7.82142857,0.964285714 C7.94047619,0.845238095 8,0.714285714 8,0.571428571 C8,0.428571429 7.94047619,0.297619048 7.82142857,0.178571429 C7.70238095,0.0595238095 7.57142857,0 7.42857143,0 C7.28571429,0 7.1547619,0.0595238095 7.03571429,0.178571429 L4,3.21428571 L0.964285714,0.178571429 C0.845238095,0.0595238095 0.714285714,0 0.571428571,0 C0.428571429,0 0.297619048,0.0595238095 0.178571429,0.178571429 C0.0595238095,0.297619048 0,0.428571429 0,0.571428571 C0,0.714285714 0.0595238095,0.845238095 0.178571429,0.964285714 L3.21428571,4 L0.178571429,7.03571429 C0.0595238095,7.1547619 0,7.28571429 0,7.42857143 C0,7.57142857 0.0595238095,7.70238095 0.178571429,7.82142857 C0.297619048,7.94047619 0.428571429,8 0.571428571,8 C0.714285714,8 0.845238095,7.94047619 0.964285714,7.82142857 L4,4.78571429 C4.83967104,5.62538533 5.46942433,6.25513861 5.88925985,6.67497413 C6.1440275,6.92974179 6.52617898,7.31189327 7.03571429,7.82142857 C7.1547619,7.94047619 7.28571429,8 7.42857143,8 Z" id="" fill="#000000" fill-rule="nonzero"></path>\n            </g>\n        </svg>',LadiChat.divPreviewMsg.appendChild(LadiChat.ClosePreviewBtn),LadiChat.divListmsg?LadiChat.divListmsg.innerHTML="":(LadiChat.divListmsg=document.createElement("div"),LadiChat.divListmsg.setAttribute("id","list-msg-item")),e){let t=LadiChat.storeConfig.startPage.logo_img?LadiChat.storeConfig.startPage.logo_img:LadiChat_Config.defaultLogo;const a=Math.floor(Math.random()*(LadiChat.listAvatar.length-1));t=LadiChat.listAvatar[a],t&&(LadiChat.iframeDoc.getElementById("svg-icon").innerHTML="<img src='"+t+"' class='agent-avatar'/>",LadiChat.closeSVG="<img src='"+t+"' class='agent-avatar'/>"),e=e.sort(((t,e)=>{let a=t.type||"TEXT",i=e.type||"TEXT";return a<i?1:a>i?-1:0}));for(let t=0;t<e.length;t++){const a=document.createElement("div");if(a.setAttribute("class","item-prev"),e[t].type==LadiChat_Config.MESSAGE_TEMPLATE_TYPE.TEXT||!e[t].type){const i=document.createElement("span");let n=e[t].message;n=n.replace(/<div>/gi,"&nbsp;"),n=n.replace(/<br>/gi,"&nbsp;");let s="<div></div>";const o=document.createElement("div");o.innerHTML=n,""==o.innerText&&n.indexOf("<img")>=0&&(s="[Hình ảnh]");let r=o.getElementsByClassName("ladichat-form-wrapper");for(let t=0;t<r.length;t++){const e=r[t],a=document.createElement("span"),i=document.createTextNode(" [Form] ");a.appendChild(i),e.parentNode.replaceChild(a,e)}s=o.innerText;const d=document.createTextNode(s);i.appendChild(d),a.appendChild(i),a.addEventListener("click",(function(){LadiChat.isCreatingConv||LadiChat.createStartConversation()}))}if(e[t].type==LadiChat_Config.MESSAGE_TEMPLATE_TYPE.QUICK_REPLY&&e[t].options){const i=document.createElement("div");i.setAttribute("class","list-quick-reply");for(let a=0;a<e[t].options.length;a++){const n=document.createElement("div");n.setAttribute("class","item-quick-reply");const s=document.createTextNode(e[t].options[a]);if(e[t].icons&&e[t].icons.length>a&&e[t].icons[a]){const i=document.createElement("img");i.setAttribute("src",e[t].icons[a]),n.appendChild(i)}n.appendChild(s),n.addEventListener("click",(function(){LadiChat.isCreatingConv||LadiChat.createStartConversation({selected:e[t].options[a]})})),i.appendChild(n)}a.appendChild(i)}LadiChat.divListmsg.appendChild(a)}LadiChat.storeConfig.startPage.start_conversation.list_message=e}LadiChat.divPreviewMsg.appendChild(LadiChat.divListmsg)}catch(t){console.log("error :",t)}}generatePreviewMessage(t,e){try{if(LadiChat.divPreviewMsg?LadiChat.divPreviewMsg.innerHTML="":(LadiChat.divPreviewMsg=document.createElement("div"),LadiChat.divPreviewMsg.setAttribute("id","preview-new-message"),LadiChat.divPreviewMsg.classList.add("hidden")),LadiChat.ClosePreviewBtn=document.createElement("div"),LadiChat.ClosePreviewBtn.setAttribute("id","close-preview-msg"),LadiChat.ClosePreviewBtn.innerHTML='<svg width="8px" height="8px" viewBox="0 0 8 8" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n            <g id="Protype" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" fill-opacity="0.3">\n                <path d="M7.42857143,8 C7.57142857,8 7.70238095,7.94047619 7.82142857,7.82142857 C7.94047619,7.70238095 8,7.57142857 8,7.42857143 C8,7.28571429 7.94047619,7.1547619 7.82142857,7.03571429 L4.78571429,4 L7.82142857,0.964285714 C7.94047619,0.845238095 8,0.714285714 8,0.571428571 C8,0.428571429 7.94047619,0.297619048 7.82142857,0.178571429 C7.70238095,0.0595238095 7.57142857,0 7.42857143,0 C7.28571429,0 7.1547619,0.0595238095 7.03571429,0.178571429 L4,3.21428571 L0.964285714,0.178571429 C0.845238095,0.0595238095 0.714285714,0 0.571428571,0 C0.428571429,0 0.297619048,0.0595238095 0.178571429,0.178571429 C0.0595238095,0.297619048 0,0.428571429 0,0.571428571 C0,0.714285714 0.0595238095,0.845238095 0.178571429,0.964285714 L3.21428571,4 L0.178571429,7.03571429 C0.0595238095,7.1547619 0,7.28571429 0,7.42857143 C0,7.57142857 0.0595238095,7.70238095 0.178571429,7.82142857 C0.297619048,7.94047619 0.428571429,8 0.571428571,8 C0.714285714,8 0.845238095,7.94047619 0.964285714,7.82142857 L4,4.78571429 C4.83967104,5.62538533 5.46942433,6.25513861 5.88925985,6.67497413 C6.1440275,6.92974179 6.52617898,7.31189327 7.03571429,7.82142857 C7.1547619,7.94047619 7.28571429,8 7.42857143,8 Z" id="" fill="#000000" fill-rule="nonzero"></path>\n            </g>\n        </svg>',LadiChat.divPreviewMsg.appendChild(LadiChat.ClosePreviewBtn),LadiChat.divListmsg?LadiChat.divListmsg.innerHTML="":(LadiChat.divListmsg=document.createElement("div"),LadiChat.divListmsg.setAttribute("id","list-msg-item")),e){let a=LadiChat.storeConfig.startPage.logo_img?LadiChat.storeConfig.startPage.logo_img:LadiChat_Config.defaultLogo;if(t.assign_id&&""!=t.assign_id){const e=LadiChat_Config.getStaffInfo(t.assign_id,LadiChat.storeConfig);if(e&&e.avatar&&""!=e.avatar&&(a=e.avatar),!e){const t=Math.floor(Math.random()*(LadiChat.listAvatar.length-1));a=LadiChat.listAvatar[t]}}a&&(LadiChat.iframeDoc.getElementById("svg-icon").innerHTML="<img src='"+a+"' class='agent-avatar'/>",LadiChat.closeSVG="<img src='"+a+"' class='agent-avatar'/>");for(let a=0;a<e.length&&!(a>3);a++){const i=document.createElement("div");i.setAttribute("class","item-prev");const n=document.createElement("span");let s=e[a].message;s=s.replace(/<div>/gi,"&nbsp;"),s=s.replace(/<br>/gi,"&nbsp;");let o="<div></div>";const r=document.createElement("div");r.innerHTML=s;let d=r.getElementsByTagName("img");for(let t=0;t<d.length;t++){const e=d[t],a=document.createElement("span"),i=document.createTextNode(" [Hình Ảnh] ");a.appendChild(i),e.parentNode.replaceChild(a,e)}let c=r.getElementsByClassName("ladichat-form-wrapper");for(let t=0;t<c.length;t++){const e=c[t],a=document.createElement("span"),i=document.createTextNode(" [Form] ");a.appendChild(i),e.parentNode.replaceChild(a,e)}let l=r.getElementsByTagName("a");for(let t=0;t<l.length;t++){const e=l[t],a=document.createElement("span"),i=document.createTextNode(" [Liên Kết] ");a.appendChild(i),e.parentNode.replaceChild(a,e)}o=r.innerText;const h=document.createTextNode(o);n.appendChild(h),i.appendChild(n),i.addEventListener("click",(function(){LadiChat.divPreviewMsg.classList.add("hidden"),LadiChat.showConversationStream(t),LadiChat.showChatWidget(!0)})),LadiChat.divListmsg.appendChild(i)}}LadiChat.divPreviewMsg.appendChild(LadiChat.divListmsg)}catch(t){console.log("error :",t)}}async createStartConversation(t){try{if(LadiChat.isCreatingConv)return;LadiChat.isCreatingConv=!0;const e=LadiChat.storeConfig.startPage,{start_conversation:a}=e,i={"content-type":"application/json","session-key":LadiChat.token},n={list_message:a.list_message,selected_quick_reply:!!t&&t.selected,template_id:a.template_id};if(!LadiChat_Helper.checkUserInfo()&&LadiChat.storeConfig.startForm){const t={action:"create_start_conversation",data:n,api:LadiChat_Config.API_ROUTE.CREATE_START_CONVERSATION};return void LadiChat.showFormPopup(LadiChat.storeConfig.startForm,t)}const s=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_START_CONVERSATION,n,i);LadiChat.divPreviewMsg.classList.add("hidden"),s&&(LadiChat.isCreatingConv=!1),LadiChat.showConversationStream(s.data.conversation),LadiChat.showChatWidget(!0)}catch(t){console.log("error :",t)}}toastr(t,e,a,i,n){try{void 0===t&&(t="error"),void 0===e&&(e=""),void 0===a&&(a=""),void 0===i&&(i=5e3),void 0===n&&(n="top-right");var s=document.getElementById("ladiui-toast-container");s||((s=document.createElement("div")).setAttribute("id","ladiui-toast-container"),s.setAttribute("class","toast-"+n));var o=document.createElement("div");o.setAttribute("class","ladiui-toast toast-"+t),o.setAttribute("order",LadiChat.toastCount++);var r=document.createElement("div");r.setAttribute("class","ladiui-toast-title"),e=document.createTextNode(e),r.appendChild(e),o.appendChild(r);var d=document.createElement("div");d.setAttribute("class","ladiui-toast-message"),d.innerHTML=a,o.appendChild(d),s.appendChild(o),LadiChat.iframeDoc.body.appendChild(s),setTimeout(function(){o.remove()}.bind(o),i)}catch(t){console.log(t)}}async processQueue(){try{if(LadiChat&&LadiChat.commandQueue&&LadiChat.commandQueue.length>0){LadiChat.isProcessQueue=!0;const t=LadiChat.commandQueue[0];if(0==t.length)return LadiChat.nextEvent(),null;let e=[];for(let a=0;a<t.length;a++){const i=t[a],n=i[0]||"",s=i[1]||"",o=i.length>=3?i[2]:"",r=i.length>=4?i[3]:{};if(""==n||""==s||s.indexOf(":")<0)continue;const d=s.split(":"),c=d[0],l=d[1];if("set"===n||"get"===n){const t={cmd:n,target_name:c,target_field:l,target_value:o};"set"===n&&("pkg_name"==l||"exp_date"==l||"is_expired"==l?(LadiChat.storeConfig.user_info[l]=o,e.push(t)):"token"==l?LadiChat.client_token||(LadiChat.client_token=o,e.push(t)):LadiChat.storeConfig.user_info[l]!==o&&(LadiChat.storeConfig.user_info[l]=o,e.push(t)),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig)),LadiChat.storeConfig.user_info.is_complete_survey=!0}if("do"===n&&"chat"===c&&"open"===l&&LadiChat.openWidget(r),"do"===n&&"chat"===c&&"closed"===l&&LadiChat.closeWidget(r),"do"===n&&"chat"===c&&"show"===l&&LadiChat.unhide(r),"do"===n&&"conversation"===c&&"open"===l){if(!o.template_id||!o.list_message)continue;LadiChat.showTemplateConversation(o.template_id,o.list_message,o.is_new)}"do"===n&&"form"===c&&"send"===l&&LadiChat.showForm(o.form_id,o.form_type),"on"===n&&"form"===c&&"submit"===l&&LadiChat.listCallbackForm.push({filter:o,callbackFunc:r}),"on"===n&&"chat"===c&&"open"===l&&"function"==typeof r&&(LadiChat.openCallback=r),"on"===n&&"chat"===c&&"closed"===l&&"function"==typeof r&&(LadiChat.closeCallback=r),"on"===n&&"message"===c&&"first"===l&&"function"==typeof r&&(LadiChat.firstMessageCallback=r)}if(e.length>0){const t={"content-type":"application/json","session-key":LadiChat.token},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CUSTOM_MULTI_COMMAND,{user_infos:e},t);if(200===a.code){const{result:t}=a.data;if(t.sessionKey&&t.user_info){t.user_info.user_id=t.user_info._id,LadiChat.token=t.sessionKey,LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_KEY+LadiChat.storeID,LadiChat.token,LadiChat_Config.EXPRIRE_TOKEN),LadiChat.initSocket(),await LadiChat.getStoreConfig(),LadiChat.storeConfig.user_info._id=t.user_info._id,LadiChat.storeConfig.user_info.user_id=t.user_info._id;let e=LadiChat.storeConfig.user_info.screen_name,a=LadiChat.storeConfig.user_info.conversation;await LadiChat.getUnreadMessage(),e&&(LadiChat.storeConfig.user_info.screen_name=e),a&&(LadiChat.storeConfig.user_info.conversation=a),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.retouchScreen()}}else LadiChat.syncData={user_infos:e}}return LadiChat.nextEvent(),!0}}catch(t){console.log(t)}}nextEvent(){LadiChat.commandQueue.shift(),LadiChat.isProcessQueue=!1,LadiChat.timeoutID&&(clearTimeout(LadiChat.timeoutID),LadiChat.timeoutID=null),LadiChat.commandQueue.length>0&&(LadiChat.timeoutID=setTimeout(LadiChat.processQueue,200))}push(t){if(0==t.length)return null;LadiChat.commandQueue||(LadiChat.commandQueue=[]),0!=t.length&&(Array.isArray(t[0])||(t=[t]),LadiChat.commandQueue.push(t),LadiChat.isProcessQueue||LadiChat.timeoutID||!LadiChat.initSuccess||(LadiChat.timeoutID=setTimeout(LadiChat.processQueue,200)))}closeWidget(t){if(LadiChat.chatWidget.style.display="none",LadiChat.frameContainer.style.boxShadow="unset",LadiChat.lastHeight={width:LadiChat.frameContainer.style.width,height:LadiChat.frameContainer.style.height},"function"==typeof LadiChat.closeCallback&&LadiChat.closeCallback.call(),"function"==typeof t)try{t.call()}catch(t){}}unhide(){LadiChat.chatWidget.style.display="block",LadiChat.lastHeight?(LadiChat.frameContainer.style.width=LadiChat.lastHeight.width,LadiChat.frameContainer.style.height=LadiChat.lastHeight.height,LadiChat.lastHeight.height&&LadiChat.lastHeight.height):(LadiChat.frameContainer.style.width="64px",LadiChat.frameContainer.style.height="64px",LadiChat.frameContainer.style.boxShadow="unset")}openWidget(t){const e=JSON.parse(LadiChat.storeConfig.widgetConfig);LadiChat.unhide();const a=LadiChat.iframeDoc.getElementById("svg-icon");if(e.show_wellcome_msg&&0!=LadiChat.storeConfig.list_msg.length||(LadiChat.chatContainer.classList.add("is-visible"),LadiChat.isMobile&&window.screen.availWidth<768?(LadiChat.frameContainer.style.width="100%",LadiChat.frameContainer.style.right="0px",LadiChat.frameContainer.style.bottom="0px"):LadiChat.frameContainer.style.width="400px",LadiChat.frameContainer.style.height="100%"),LadiChat.chatWidgetOpen.classList.remove("close"),LadiChat.chatWidgetOpen.classList.add("open"),a.innerHTML=LadiChat.openSVG,LadiChat.lastMessagePreview.innerHTML="",LadiChat.lastMessagePreview.classList.add("is-hide"),"function"==typeof LadiChat.openCallback&&LadiChat.openCallback.call(),"function"==typeof t)try{t.call()}catch(t){}LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&(LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat.mainPage.connectFunc())}addScriptTrackingForm(t,e){const a=document.getElementById("tracking-by-form-"+t);a&&a.remove(),document.createElement("script");var i=document.createRange().createContextualFragment(decodeURIComponent(e)).firstElementChild;i&&(i.setAttribute("id","tracking-by-form-"+t),document.body.appendChild(i))}async createNewSession(){let t=!1;(new Date).getTime();const e=LadiChat_Helper.uuidv4(),a={store_id:LadiChat.storeID,session_id:e,page_url:window.location.href,widget_id:LadiChat.widgetID},i=await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.NEW_SESSION,JSON.stringify(a),!0,{"Content-Type":"application/json"}),n=JSON.parse(i);if(200==n.code){if(LadiChat.token=n.data.sessionKey,t=n.data.sessionKey,LadiChat.storeConfig.user_info=Object.assign(LadiChat.storeConfig.user_info,n.data.userInfo),!LadiChat.storeConfig.user_info.user_id&&LadiChat.storeConfig.user_info._id&&(LadiChat.storeConfig.user_info.user_id=LadiChat.storeConfig.user_info._id,LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig)),LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_KEY+LadiChat.storeID,LadiChat.token,LadiChat_Config.EXPRIRE_TOKEN),LadiChat.syncData){const t={"content-type":"application/json","session-key":LadiChat.token},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CUSTOM_MULTI_COMMAND,LadiChat.syncData,t);if(200===e.code){const{result:t}=e.data;if(LadiChat.syncData=!1,t.sessionKey&&t.user_info){t.user_info.user_id=t.user_info._id,LadiChat.token=t.sessionKey,LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_KEY+LadiChat.storeID,LadiChat.token,LadiChat_Config.EXPRIRE_TOKEN),await LadiChat.getStoreConfig(),LadiChat.storeConfig.user_info._id=t.user_info._id;let e=LadiChat.storeConfig.user_info.screen_name,a=LadiChat.storeConfig.user_info.conversation;await LadiChat.getUnreadMessage(),e&&(LadiChat.storeConfig.user_info.screen_name=e),a&&(LadiChat.storeConfig.user_info.conversation=a),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.retouchScreen()}}}else this.initSocket();return t}LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_KEY+LadiChat.storeID,LadiChat.token,-1)}async loadOldSession(){if(LadiChat.storeConfig.user_info.is_show_widget)return;if(LadiChat.token&&!LadiChat.isLoadOldSession){LadiChat.isLoadOldSession=!0;const t={page_url:window.location.href,widget_id:LadiChat.widgetID,is_new_session:!0},e={"Content-Type":"application/json","session-key":LadiChat.token},a=LadiChat_Helper.getCookie(LadiChat_Config.SESSION_ID+LadiChat.storeID);a&&""!=a?t.is_new_session=!1:LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_ID+LadiChat.storeID,ssTime,0,window.location.pathname);let i=await LadiChat_Helper.sendRequest("POST",LadiChat_Static_Config.END_POINT+LadiChat_Config.API_ROUTE.MY_INFO,JSON.stringify(t),!0,e);if(i&&(i=JSON.parse(i),200==i.code&&(i.data.new_session_key&&(LadiChat.token=i.data.new_session_key,delete i.data.new_session_key),LadiChat.storeConfig.user_info=Object.assign(LadiChat.storeConfig.user_info,i.data),LadiChat.storeConfig.user_info.user_id=LadiChat.storeConfig.user_info.user_id,LadiChat.storeConfig.user_info._id=LadiChat.storeConfig.user_info.user_id),401==i.code||500==i.code))return void LadiChat_Helper.setCookieByPath(LadiChat_Config.SESSION_KEY+LadiChat.storeID,LadiChat.token,-1)}const t=JSON.parse(LadiChat.storeConfig.widgetConfig);if(t.wellcome_form_id&&!LadiChat.storeConfig.startForm){const e=await LadiChat.getFormData(t.wellcome_form_id);LadiChat.storeConfig.startForm=e}LadiChat.mainPage&&null!=LadiChat.mainPage.connectFunc&&(LadiChat.storeConfig.user_info.is_show_widget=!0,LadiChat.mainPage.connectFunc())}async proccessAll(){for(let t=0;t<this.prepostData.length;t++)await this.sendTracking(this.prepostData[t]);this.prepostData=[]}async sendTracking(t){if(void 0!==window.LadiData)window.LadiData.TrackingData(t);else{this.prepostData.push(t);var e=this;if(null!=this.intervalID)return;this.intervalID=setInterval((function(){e.countWait+=1,8==e.countWait&&(clearInterval(e.intervalID),e.intervalID=null),void 0!==window.LadiData&&(clearInterval(e.intervalID),e.intervalID=null,e.proccessAll())}),this.timeoutWait)}}}!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.io=e():t.io=e()}(this,(function(){return function(t){function e(i){if(a[i])return a[i].exports;var n=a[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){function i(t,e){"object"==typeof t&&(e=t,t=void 0),e=e||{};var a,i=n(t),s=i.source,c=i.id,l=i.path,h=d[c]&&l in d[c].nsps;return e.forceNew||e["force new connection"]||!1===e.multiplex||h?(r("ignoring socket cache for %s",s),a=o(s,e)):(d[c]||(r("new io instance for %s",s),d[c]=o(s,e)),a=d[c]),i.query&&!e.query&&(e.query=i.query),a.socket(i.path,e)}var n=a(1),s=a(7),o=a(15),r=a(3)("socket.io-client");t.exports=e=i;var d=e.managers={};e.protocol=s.protocol,e.connect=i,e.Manager=a(15),e.Socket=a(39)},function(t,e,a){var i=a(2),n=a(3)("socket.io-client:url");t.exports=function(t,e){var a=t;e=e||"undefined"!=typeof location&&location,null==t&&(t=e.protocol+"//"+e.host),"string"==typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?e.protocol+t:e.host+t),/^(https?|wss?):\/\//.test(t)||(n("protocol-less url %s",t),t=void 0!==e?e.protocol+"//"+t:"https://"+t),n("parse %s",t),a=i(t)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";var s=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+s+":"+a.port,a.href=a.protocol+"://"+s+(e&&e.port===a.port?"":":"+a.port),a}},function(t,e){var a=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(t){var e=t,n=t.indexOf("["),s=t.indexOf("]");-1!=n&&-1!=s&&(t=t.substring(0,n)+t.substring(n,s).replace(/:/g,";")+t.substring(s,t.length));for(var o=a.exec(t||""),r={},d=14;d--;)r[i[d]]=o[d]||"";return-1!=n&&-1!=s&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r}},function(t,e,a){(function(i){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.log=function(){var t;return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&(t=console).log.apply(t,arguments)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),this.useColors){var a="color: "+this.color;e.splice(1,0,a,"color: inherit");var i=0,n=0;e[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(n=i))})),e.splice(n,0,a)}},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){var t=void 0;try{t=e.storage.getItem("debug")}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t},e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=a(5)(e),t.exports.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(e,a(4))},function(t,e){function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function n(t){if(c===setTimeout)return setTimeout(t,0);if((c===a||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function s(){C&&g&&(C=!1,g.length?u=g.concat(u):f=-1,u.length&&o())}function o(){if(!C){var t=n(s);C=!0;for(var e=u.length;e;){for(g=u,u=[];++f<e;)g&&g[f].run();f=-1,e=u.length}g=null,C=!1,function(t){if(l===clearTimeout)return clearTimeout(t);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{l(t)}catch(e){try{return l.call(null,t)}catch(e){return l.call(this,t)}}}(t)}}function r(t,e){this.fun=t,this.array=e}function d(){}var c,l,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:a}catch(t){c=a}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(t){l=i}}();var g,u=[],C=!1,f=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)e[a-1]=arguments[a];u.push(new r(t,e)),1!==u.length||C||n(o)},r.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=d,h.addListener=d,h.once=d,h.off=d,h.removeListener=d,h.removeAllListeners=d,h.emit=d,h.prependListener=d,h.prependOnceListener=d,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e,a){function i(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}t.exports=function(t){function e(t){for(var e=0,a=0;a<t.length;a++)e=(e<<5)-e+t.charCodeAt(a),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){function a(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];if(a.enabled){var o=a,r=Number(new Date),d=r-(i||r);o.diff=d,o.prev=i,o.curr=r,i=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");var c=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(function(t,a){if("%%"===t)return t;c++;var i=n.formatters[a];if("function"==typeof i){var s=e[c];t=i.call(o,s),e.splice(c,1),c--}return t})),n.formatArgs.call(o,e);var l=o.log||n.log;l.apply(o,e)}}var i=void 0;return a.namespace=t,a.enabled=n.enabled(t),a.useColors=n.useColors(),a.color=e(t),a.destroy=s,a.extend=o,"function"==typeof n.init&&n.init(a),n.instances.push(a),a}function s(){var t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function o(t,e){var a=n(this.namespace+(void 0===e?":":e)+t);return a.log=this.log,a}function r(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){return t instanceof Error?t.stack||t.message:t},n.disable=function(){var t=[].concat(i(n.names.map(r)),i(n.skips.map(r).map((function(t){return"-"+t})))).join(",");return n.enable(""),t},n.enable=function(t){n.save(t),n.names=[],n.skips=[];var e=void 0,a=("string"==typeof t?t:"").split(/[\s,]+/),i=a.length;for(e=0;e<i;e++)a[e]&&("-"===(t=a[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){var s=n.instances[e];s.enabled=n.enabled(s.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;var e=void 0,a=void 0;for(e=0,a=n.skips.length;e<a;e++)if(n.skips[e].test(t))return!1;for(e=0,a=n.names.length;e<a;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=a(6),Object.keys(t).forEach((function(e){n[e]=t[e]})),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n}},function(t,e){function a(t){var e=Math.abs(t);return e>=r?i(t,e,r,"day"):e>=o?i(t,e,o,"hour"):e>=s?i(t,e,s,"minute"):e>=n?i(t,e,n,"second"):t+" ms"}function i(t,e,a,i){var n=e>=1.5*a;return Math.round(t/a)+" "+i+(n?"s":"")}var n=1e3,s=60*n,o=60*s,r=24*o,d=7*r,c=365.25*r;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*c;case"weeks":case"week":case"w":return a*d;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*o;case"minutes":case"minute":case"mins":case"min":case"m":return a*s;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===i&&isFinite(t))return e.long?a(t):function(t){var e=Math.abs(t);return e>=r?Math.round(t/r)+"d":e>=o?Math.round(t/o)+"h":e>=s?Math.round(t/s)+"m":e>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,a){function i(){}function n(t){var a=""+t.type;if(e.BINARY_EVENT!==t.type&&e.BINARY_ACK!==t.type||(a+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(a+=t.nsp+","),null!=t.id&&(a+=t.id),null!=t.data){var i=function(t){try{return JSON.stringify(t)}catch(t){return!1}}(t.data);if(!1===i)return u;a+=i}return d("encoded %j as %s",t,a),a}function s(){this.reconstructor=null}function o(t){this.reconPack=t,this.buffers=[]}function r(t){return{type:e.ERROR,data:"parser error: "+t}}var d=a(8)("socket.io-parser"),c=a(11),l=a(12),h=a(13),g=a(14);e.protocol=4,e.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],e.CONNECT=0,e.DISCONNECT=1,e.EVENT=2,e.ACK=3,e.ERROR=4,e.BINARY_EVENT=5,e.BINARY_ACK=6,e.Encoder=i,e.Decoder=s;var u=e.ERROR+'"encode error"';i.prototype.encode=function(t,a){d("encoding packet %j",t),e.BINARY_EVENT===t.type||e.BINARY_ACK===t.type?function(t,e){l.removeBlobs(t,(function(t){var a=l.deconstructPacket(t),i=n(a.packet),s=a.buffers;s.unshift(i),e(s)}))}(t,a):a([n(t)])},c(s.prototype),s.prototype.add=function(t){var a;if("string"==typeof t)a=function(t){var a=0,i={type:Number(t.charAt(0))};if(null==e.types[i.type])return r("unknown packet type "+i.type);if(e.BINARY_EVENT===i.type||e.BINARY_ACK===i.type){for(var n="";"-"!==t.charAt(++a)&&(n+=t.charAt(a),a!=t.length););if(n!=Number(n)||"-"!==t.charAt(a))throw new Error("Illegal attachments");i.attachments=Number(n)}if("/"===t.charAt(a+1))for(i.nsp="";++a&&","!==(o=t.charAt(a))&&(i.nsp+=o,a!==t.length););else i.nsp="/";var s=t.charAt(a+1);if(""!==s&&Number(s)==s){for(i.id="";++a;){var o;if(null==(o=t.charAt(a))||Number(o)!=o){--a;break}if(i.id+=t.charAt(a),a===t.length)break}i.id=Number(i.id)}if(t.charAt(++a)){var c=function(t){try{return JSON.parse(t)}catch(t){return!1}}(t.substr(a));if(!1===c||i.type!==e.ERROR&&!h(c))return r("invalid payload");i.data=c}return d("decoded %s as %j",t,i),i}(t),e.BINARY_EVENT===a.type||e.BINARY_ACK===a.type?(this.reconstructor=new o(a),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",a)):this.emit("decoded",a);else{if(!g(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(a=this.reconstructor.takeBinaryData(t))&&(this.reconstructor=null,this.emit("decoded",a))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},o.prototype.takeBinaryData=function(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){var e=l.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null},o.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(t,e,a){(function(i){function n(){var t;try{t=e.storage.debug}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};(e=t.exports=a(9)).log=function(){return"object"===("undefined"==typeof console?"undefined":s(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(t){var a=this.useColors;if(t[0]=(a?"%c":"")+this.namespace+(a?" %c":" ")+t[0]+(a?"%c ":" ")+"+"+e.humanize(this.diff),a){var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var n=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(n++,"%c"===t&&(s=n))})),t.splice(s,0,i)}},e.save=function(t){try{null==t?e.storage.removeItem("debug"):e.storage.debug=t}catch(t){}},e.load=n,e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},e.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},e.enable(n())}).call(e,a(4))},function(t,e,a){function i(t){function a(){if(a.enabled){var t=a,n=+new Date,s=n-(i||n);t.diff=s,t.prev=i,t.curr=n,i=n;for(var o=new Array(arguments.length),r=0;r<o.length;r++)o[r]=arguments[r];o[0]=e.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var d=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,(function(a,i){if("%%"===a)return a;d++;var n=e.formatters[i];if("function"==typeof n){var s=o[d];a=n.call(t,s),o.splice(d,1),d--}return a})),e.formatArgs.call(t,o);var c=a.log||e.log||console.log.bind(console);c.apply(t,o)}}var i;return a.namespace=t,a.enabled=e.enabled(t),a.useColors=e.useColors(),a.color=function(t){var a,i=0;for(a in t)i=(i<<5)-i+t.charCodeAt(a),i|=0;return e.colors[Math.abs(i)%e.colors.length]}(t),a.destroy=n,"function"==typeof e.init&&e.init(a),e.instances.push(a),a}function n(){var t=e.instances.indexOf(this);return-1!==t&&(e.instances.splice(t,1),!0)}(e=t.exports=i.debug=i.default=i).coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){e.enable("")},e.enable=function(t){e.save(t),e.names=[],e.skips=[];var a,i=("string"==typeof t?t:"").split(/[\s,]+/),n=i.length;for(a=0;a<n;a++)i[a]&&("-"===(t=i[a].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")));for(a=0;a<e.instances.length;a++){var s=e.instances[a];s.enabled=e.enabled(s.namespace)}},e.enabled=function(t){if("*"===t[t.length-1])return!0;var a,i;for(a=0,i=e.skips.length;a<i;a++)if(e.skips[a].test(t))return!1;for(a=0,i=e.names.length;a<i;a++)if(e.names[a].test(t))return!0;return!1},e.humanize=a(10),e.instances=[],e.names=[],e.skips=[],e.formatters={}},function(t,e){function a(t){return i(t,r,"day")||i(t,o,"hour")||i(t,s,"minute")||i(t,n,"second")||t+" ms"}function i(t,e,a){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+a:Math.ceil(t/e)+" "+a+"s"}var n=1e3,s=60*n,o=60*s,r=24*o,d=365.25*r;t.exports=function(t,e){e=e||{};var i=typeof t;if("string"===i&&t.length>0)return function(t){if(!((t=String(t)).length>100)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var a=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*d;case"days":case"day":case"d":return a*r;case"hours":case"hour":case"hrs":case"hr":case"h":return a*o;case"minutes":case"minute":case"mins":case"min":case"m":return a*s;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(t);if("number"===i&&!1===isNaN(t))return e.long?a(t):function(t){return t>=r?Math.round(t/r)+"d":t>=o?Math.round(t/o)+"h":t>=s?Math.round(t/s)+"m":t>=n?Math.round(t/n)+"s":t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,a){function i(t){if(t)return function(t){for(var e in i.prototype)t[e]=i.prototype[e];return t}(t)}t.exports=i,i.prototype.on=i.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},i.prototype.once=function(t,e){function a(){this.off(t,a),e.apply(this,arguments)}return a.fn=e,this.on(t,a),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var a=this._callbacks["$"+t];if(!a)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i,n=0;n<a.length;n++)if((i=a[n])===e||i.fn===e){a.splice(n,1);break}return this},i.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),a=this._callbacks["$"+t];if(a)for(var i=0,n=(a=a.slice(0)).length;i<n;++i)a[i].apply(this,e);return this},i.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},i.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e,a){function i(t,e){if(!t)return t;if(o(t)){var a={_placeholder:!0,num:e.length};return e.push(t),a}if(s(t)){for(var n=new Array(t.length),r=0;r<t.length;r++)n[r]=i(t[r],e);return n}if("object"==typeof t&&!(t instanceof Date)){for(var d in n={},t)n[d]=i(t[d],e);return n}return t}function n(t,e){if(!t)return t;if(t&&t._placeholder)return e[t.num];if(s(t))for(var a=0;a<t.length;a++)t[a]=n(t[a],e);else if("object"==typeof t)for(var i in t)t[i]=n(t[i],e);return t}var s=a(13),o=a(14),r=Object.prototype.toString,d="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),c="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);e.deconstructPacket=function(t){var e=[],a=t.data,n=t;return n.data=i(a,e),n.attachments=e.length,{packet:n,buffers:e}},e.reconstructPacket=function(t,e){return t.data=n(t.data,e),t.attachments=void 0,t},e.removeBlobs=function(t,e){var a=0,i=t;(function t(n,r,l){if(!n)return n;if(d&&n instanceof Blob||c&&n instanceof File){a++;var h=new FileReader;h.onload=function(){l?l[r]=this.result:i=this.result,--a||e(i)},h.readAsArrayBuffer(n)}else if(s(n))for(var g=0;g<n.length;g++)t(n[g],g,n);else if("object"==typeof n&&!o(n))for(var u in n)t(n[u],u,n)})(i),a||e(i)}},function(t,e){var a={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==a.call(t)}},function(t,e){t.exports=function(t){return a&&Buffer.isBuffer(t)||i&&(t instanceof ArrayBuffer||n(t))};var a="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,i="function"==typeof ArrayBuffer,n=function(t){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer}},function(t,e,a){function i(t,e){if(!(this instanceof i))return new i(t,e);t&&"object"==typeof t&&(e=t,t=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new g({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this.readyState="closed",this.uri=t,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var a=e.parser||r;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=!1!==e.autoConnect,this.autoConnect&&this.open()}var n=a(16),s=a(39),o=a(11),r=a(7),d=a(41),c=a(42),l=a(3)("socket.io-client:manager"),h=a(38),g=a(43),u=Object.prototype.hasOwnProperty;t.exports=i,i.prototype.emitAll=function(){for(var t in this.emit.apply(this,arguments),this.nsps)u.call(this.nsps,t)&&this.nsps[t].emit.apply(this.nsps[t],arguments)},i.prototype.updateSocketIds=function(){for(var t in this.nsps)u.call(this.nsps,t)&&(this.nsps[t].id=this.generateId(t))},i.prototype.generateId=function(t){return("/"===t?"":t+"#")+this.engine.id},o(i.prototype),i.prototype.reconnection=function(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection},i.prototype.reconnectionAttempts=function(t){return arguments.length?(this._reconnectionAttempts=t,this):this._reconnectionAttempts},i.prototype.reconnectionDelay=function(t){return arguments.length?(this._reconnectionDelay=t,this.backoff&&this.backoff.setMin(t),this):this._reconnectionDelay},i.prototype.randomizationFactor=function(t){return arguments.length?(this._randomizationFactor=t,this.backoff&&this.backoff.setJitter(t),this):this._randomizationFactor},i.prototype.reconnectionDelayMax=function(t){return arguments.length?(this._reconnectionDelayMax=t,this.backoff&&this.backoff.setMax(t),this):this._reconnectionDelayMax},i.prototype.timeout=function(t){return arguments.length?(this._timeout=t,this):this._timeout},i.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},i.prototype.open=i.prototype.connect=function(t,e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=n(this.uri,this.opts);var a=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var s=d(a,"open",(function(){i.onopen(),t&&t()})),o=d(a,"error",(function(e){if(l("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",e),t){var a=new Error("Connection error");a.data=e,t(a)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var r=this._timeout;l("connect attempt will timeout after %d",r);var c=setTimeout((function(){l("connect attempt timed out after %d",r),s.destroy(),a.close(),a.emit("error","timeout"),i.emitAll("connect_timeout",r)}),r);this.subs.push({destroy:function(){clearTimeout(c)}})}return this.subs.push(s),this.subs.push(o),this},i.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var t=this.engine;this.subs.push(d(t,"data",c(this,"ondata"))),this.subs.push(d(t,"ping",c(this,"onping"))),this.subs.push(d(t,"pong",c(this,"onpong"))),this.subs.push(d(t,"error",c(this,"onerror"))),this.subs.push(d(t,"close",c(this,"onclose"))),this.subs.push(d(this.decoder,"decoded",c(this,"ondecoded")))},i.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},i.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},i.prototype.ondata=function(t){this.decoder.add(t)},i.prototype.ondecoded=function(t){this.emit("packet",t)},i.prototype.onerror=function(t){l("error",t),this.emitAll("error",t)},i.prototype.socket=function(t,e){function a(){~h(n.connecting,i)||n.connecting.push(i)}var i=this.nsps[t];if(!i){i=new s(this,t,e),this.nsps[t]=i;var n=this;i.on("connecting",a),i.on("connect",(function(){i.id=n.generateId(t)})),this.autoConnect&&a()}return i},i.prototype.destroy=function(t){var e=h(this.connecting,t);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},i.prototype.packet=function(t){l("writing packet %j",t);var e=this;t.query&&0===t.type&&(t.nsp+="?"+t.query),e.encoding?e.packetBuffer.push(t):(e.encoding=!0,this.encoder.encode(t,(function(a){for(var i=0;i<a.length;i++)e.engine.write(a[i],t.options);e.encoding=!1,e.processPacketQueue()})))},i.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var t=this.packetBuffer.shift();this.packet(t)}},i.prototype.cleanup=function(){l("cleanup");for(var t=this.subs.length,e=0;e<t;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},i.prototype.close=i.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},i.prototype.onclose=function(t){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()},i.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var t=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();l("will wait %dms before reconnect attempt",e),this.reconnecting=!0;var a=setTimeout((function(){t.skipReconnect||(l("attempting reconnect"),t.emitAll("reconnect_attempt",t.backoff.attempts),t.emitAll("reconnecting",t.backoff.attempts),t.skipReconnect||t.open((function(e){e?(l("reconnect attempt error"),t.reconnecting=!1,t.reconnect(),t.emitAll("reconnect_error",e.data)):(l("reconnect success"),t.onreconnect())})))}),e);this.subs.push({destroy:function(){clearTimeout(a)}})}},i.prototype.onreconnect=function(){var t=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",t)}},function(t,e,a){t.exports=a(17),t.exports.parser=a(24)},function(t,e,a){function i(t,e){return this instanceof i?(e=e||{},t&&"object"==typeof t&&(e=t,t=null),t?(t=c(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=c(e.host).host),this.secure=null!=e.secure?e.secure:"undefined"!=typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=!1!==e.jsonp,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.withCredentials=!1!==e.withCredentials,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=!1!==e.perMessageDeflate&&(e.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=void 0===e.rejectUnauthorized||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new i(t,e)}var n=a(18),s=a(11),o=a(3)("engine.io-client:socket"),r=a(38),d=a(24),c=a(2),l=a(32);t.exports=i,i.priorWebsocketSuccess=!1,s(i.prototype),i.protocol=d.protocol,i.Socket=i,i.Transport=a(23),i.transports=a(18),i.parser=a(24),i.prototype.createTransport=function(t){o('creating transport "%s"',t);var e=function(t){var e={};for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}(this.query);e.EIO=d.protocol,e.transport=t;var a=this.transportOptions[t]||{};return this.id&&(e.sid=this.id),new n[t]({query:e,socket:this,agent:a.agent||this.agent,hostname:a.hostname||this.hostname,port:a.port||this.port,secure:a.secure||this.secure,path:a.path||this.path,forceJSONP:a.forceJSONP||this.forceJSONP,jsonp:a.jsonp||this.jsonp,forceBase64:a.forceBase64||this.forceBase64,enablesXDR:a.enablesXDR||this.enablesXDR,withCredentials:a.withCredentials||this.withCredentials,timestampRequests:a.timestampRequests||this.timestampRequests,timestampParam:a.timestampParam||this.timestampParam,policyPort:a.policyPort||this.policyPort,pfx:a.pfx||this.pfx,key:a.key||this.key,passphrase:a.passphrase||this.passphrase,cert:a.cert||this.cert,ca:a.ca||this.ca,ciphers:a.ciphers||this.ciphers,rejectUnauthorized:a.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:a.perMessageDeflate||this.perMessageDeflate,extraHeaders:a.extraHeaders||this.extraHeaders,forceNode:a.forceNode||this.forceNode,localAddress:a.localAddress||this.localAddress,requestTimeout:a.requestTimeout||this.requestTimeout,protocols:a.protocols||void 0,isReactNative:this.isReactNative})},i.prototype.open=function(){var t;if(this.rememberUpgrade&&i.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length){var e=this;return void setTimeout((function(){e.emit("error","No transports available")}),0)}t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(t){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)},i.prototype.setTransport=function(t){o("setting transport %s",t.name);var e=this;this.transport&&(o("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",(function(){e.onDrain()})).on("packet",(function(t){e.onPacket(t)})).on("error",(function(t){e.onError(t)})).on("close",(function(){e.onClose("transport close")}))},i.prototype.probe=function(t){function e(){if(g.onlyBinaryUpgrades){var e=!this.supportsBinary&&g.transport.supportsBinary;h=h||e}h||(o('probe transport "%s" opened',t),l.send([{type:"ping",data:"probe"}]),l.once("packet",(function(e){if(!h)if("pong"===e.type&&"probe"===e.data){if(o('probe transport "%s" pong',t),g.upgrading=!0,g.emit("upgrading",l),!l)return;i.priorWebsocketSuccess="websocket"===l.name,o('pausing current transport "%s"',g.transport.name),g.transport.pause((function(){h||"closed"!==g.readyState&&(o("changing transport and sending upgrade packet"),c(),g.setTransport(l),l.send([{type:"upgrade"}]),g.emit("upgrade",l),l=null,g.upgrading=!1,g.flush())}))}else{o('probe transport "%s" failed',t);var a=new Error("probe error");a.transport=l.name,g.emit("upgradeError",a)}})))}function a(){h||(h=!0,c(),l.close(),l=null)}function n(e){var i=new Error("probe error: "+e);i.transport=l.name,a(),o('probe transport "%s" failed because of error: %s',t,e),g.emit("upgradeError",i)}function s(){n("transport closed")}function r(){n("socket closed")}function d(t){l&&t.name!==l.name&&(o('"%s" works - aborting "%s"',t.name,l.name),a())}function c(){l.removeListener("open",e),l.removeListener("error",n),l.removeListener("close",s),g.removeListener("close",r),g.removeListener("upgrading",d)}o('probing transport "%s"',t);var l=this.createTransport(t,{probe:1}),h=!1,g=this;i.priorWebsocketSuccess=!1,l.once("open",e),l.once("error",n),l.once("close",s),this.once("close",r),this.once("upgrading",d),l.open()},i.prototype.onOpen=function(){if(o("socket open"),this.readyState="open",i.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){o("starting upgrade probes");for(var t=0,e=this.upgrades.length;t<e;t++)this.probe(this.upgrades[t])}},i.prototype.onPacket=function(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(o('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emit("data",t.data),this.emit("message",t.data)}else o('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},i.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout((function(){"closed"!==e.readyState&&e.onClose("ping timeout")}),t||e.pingInterval+e.pingTimeout)},i.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout((function(){o("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)}),t.pingInterval)},i.prototype.ping=function(){var t=this;this.sendPacket("ping",(function(){t.emit("ping")}))},i.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},i.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(o("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},i.prototype.write=i.prototype.send=function(t,e,a){return this.sendPacket("message",t,e,a),this},i.prototype.sendPacket=function(t,e,a,i){if("function"==typeof e&&(i=e,e=void 0),"function"==typeof a&&(i=a,a=null),"closing"!==this.readyState&&"closed"!==this.readyState){(a=a||{}).compress=!1!==a.compress;var n={type:t,data:e,options:a};this.emit("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}},i.prototype.close=function(){function t(){i.onClose("forced close"),o("socket closing - telling transport to close"),i.transport.close()}function e(){i.removeListener("upgrade",e),i.removeListener("upgradeError",e),t()}function a(){i.once("upgrade",e),i.once("upgradeError",e)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var i=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?a():t()})):this.upgrading?a():t()}return this},i.prototype.onError=function(t){o("socket error %j",t),i.priorWebsocketSuccess=!1,this.emit("error",t),this.onClose("transport error",t)},i.prototype.onClose=function(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(o('socket close with reason: "%s"',t),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)},i.prototype.filterUpgrades=function(t){for(var e=[],a=0,i=t.length;a<i;a++)~r(this.transports,t[a])&&e.push(t[a]);return e}},function(t,e,a){var i=a(19),n=a(21),s=a(35),o=a(36);e.polling=function(t){var e=!1,a=!1,o=!1!==t.jsonp;if("undefined"!=typeof location){var r="https:"===location.protocol,d=location.port;d||(d=r?443:80),e=t.hostname!==location.hostname||d!==t.port,a=t.secure!==r}if(t.xdomain=e,t.xscheme=a,"open"in new i(t)&&!t.forceJSONP)return new n(t);if(!o)throw new Error("JSONP disabled");return new s(t)},e.websocket=o},function(t,e,a){var i=a(20);t.exports=function(t){var e=t.xdomain,a=t.xscheme,n=t.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!e||i))return new XMLHttpRequest}catch(t){}try{if("undefined"!=typeof XDomainRequest&&!a&&n)return new XDomainRequest}catch(t){}if(!e)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}},function(t,e){try{t.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(e){t.exports=!1}},function(t,e,a){function i(){}function n(t){if(d.call(this,t),this.requestTimeout=t.requestTimeout,this.extraHeaders=t.extraHeaders,"undefined"!=typeof location){var e="https:"===location.protocol,a=location.port;a||(a=e?443:80),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||a!==t.port,this.xs=t.secure!==e}}function s(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.xs=!!t.xs,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.agent=t.agent,this.isBinary=t.isBinary,this.supportsBinary=t.supportsBinary,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.requestTimeout=t.requestTimeout,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.extraHeaders=t.extraHeaders,this.create()}function o(){for(var t in s.requests)s.requests.hasOwnProperty(t)&&s.requests[t].abort()}var r=a(19),d=a(22),c=a(11),l=a(33),h=a(3)("engine.io-client:polling-xhr");if(t.exports=n,t.exports.Request=s,l(n,d),n.prototype.supportsBinary=!0,n.prototype.request=function(t){return(t=t||{}).uri=this.uri(),t.xd=this.xd,t.xs=this.xs,t.agent=this.agent||!1,t.supportsBinary=this.supportsBinary,t.enablesXDR=this.enablesXDR,t.withCredentials=this.withCredentials,t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,t.requestTimeout=this.requestTimeout,t.extraHeaders=this.extraHeaders,new s(t)},n.prototype.doWrite=function(t,e){var a="string"!=typeof t&&void 0!==t,i=this.request({method:"POST",data:t,isBinary:a}),n=this;i.on("success",e),i.on("error",(function(t){n.onError("xhr post error",t)})),this.sendXhr=i},n.prototype.doPoll=function(){h("xhr poll");var t=this.request(),e=this;t.on("data",(function(t){e.onData(t)})),t.on("error",(function(t){e.onError("xhr poll error",t)})),this.pollXhr=t},c(s.prototype),s.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};t.pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized;var e=this.xhr=new r(t),a=this;try{h("xhr open %s: %s",this.method,this.uri),e.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&e.setRequestHeader(i,this.extraHeaders[i])}catch(t){}if("POST"===this.method)try{this.isBinary?e.setRequestHeader("Content-type","application/octet-stream"):e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(t){}try{e.setRequestHeader("Accept","*/*")}catch(t){}"withCredentials"in e&&(e.withCredentials=this.withCredentials),this.requestTimeout&&(e.timeout=this.requestTimeout),this.hasXDR()?(e.onload=function(){a.onLoad()},e.onerror=function(){a.onError(e.responseText)}):e.onreadystatechange=function(){if(2===e.readyState)try{var t=e.getResponseHeader("Content-Type");(a.supportsBinary&&"application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&(e.responseType="arraybuffer")}catch(t){}4===e.readyState&&(200===e.status||1223===e.status?a.onLoad():setTimeout((function(){a.onError("number"==typeof e.status?e.status:0)}),0))},h("xhr data %s",this.data),e.send(this.data)}catch(t){return void setTimeout((function(){a.onError(t)}),0)}"undefined"!=typeof document&&(this.index=s.requestsCount++,s.requests[this.index]=this)},s.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},s.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},s.prototype.onError=function(t){this.emit("error",t),this.cleanup(!0)},s.prototype.cleanup=function(t){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=i:this.xhr.onreadystatechange=i,t)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete s.requests[this.index],this.xhr=null}},s.prototype.onLoad=function(){var t;try{var e;try{e=this.xhr.getResponseHeader("Content-Type")}catch(t){}t=("application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&this.xhr.response||this.xhr.responseText}catch(t){this.onError(t)}null!=t&&this.onData(t)},s.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},s.prototype.abort=function(){this.cleanup()},s.requestsCount=0,s.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",o);else if("function"==typeof addEventListener){var g="onpagehide"in self?"pagehide":"unload";addEventListener(g,o,!1)}},function(t,e,a){function i(t){var e=t&&t.forceBase64;l&&!e||(this.supportsBinary=!1),n.call(this,t)}var n=a(23),s=a(32),o=a(24),r=a(33),d=a(34),c=a(3)("engine.io-client:polling");t.exports=i;var l=null!=new(a(19))({xdomain:!1}).responseType;r(i,n),i.prototype.name="polling",i.prototype.doOpen=function(){this.poll()},i.prototype.pause=function(t){function e(){c("paused"),a.readyState="paused",t()}var a=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(c("we are currently polling - waiting to pause"),i++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--i||e()}))),this.writable||(c("we are currently writing - waiting to pause"),i++,this.once("drain",(function(){c("pre-pause writing complete"),--i||e()})))}else e()},i.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},i.prototype.onData=function(t){var e=this;c("polling got data %s",t),o.decodePayload(t,this.socket.binaryType,(function(t,a,i){return"opening"===e.readyState&&e.onOpen(),"close"===t.type?(e.onClose(),!1):void e.onPacket(t)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},i.prototype.doClose=function(){function t(){c("writing close packet"),e.write([{type:"close"}])}var e=this;"open"===this.readyState?(c("transport open - closing"),t()):(c("transport not open - deferring close"),this.once("open",t))},i.prototype.write=function(t){var e=this;this.writable=!1;var a=function(){e.writable=!0,e.emit("drain")};o.encodePayload(t,this.supportsBinary,(function(t){e.doWrite(t,a)}))},i.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",a="";return!1!==this.timestampRequests&&(t[this.timestampParam]=d()),this.supportsBinary||t.sid||(t.b64=1),t=s.encode(t),this.port&&("https"===e&&443!==Number(this.port)||"http"===e&&80!==Number(this.port))&&(a=":"+this.port),t.length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+a+this.path+t}},function(t,e,a){function i(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState="",this.agent=t.agent||!1,this.socket=t.socket,this.enablesXDR=t.enablesXDR,this.withCredentials=t.withCredentials,this.pfx=t.pfx,this.key=t.key,this.passphrase=t.passphrase,this.cert=t.cert,this.ca=t.ca,this.ciphers=t.ciphers,this.rejectUnauthorized=t.rejectUnauthorized,this.forceNode=t.forceNode,this.isReactNative=t.isReactNative,this.extraHeaders=t.extraHeaders,this.localAddress=t.localAddress}var n=a(24),s=a(11);t.exports=i,s(i.prototype),i.prototype.onError=function(t,e){var a=new Error(t);return a.type="TransportError",a.description=e,this.emit("error",a),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(t){if("open"!==this.readyState)throw new Error("Transport not open");this.write(t)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(t){var e=n.decodePacket(t,this.socket.binaryType);this.onPacket(e)},i.prototype.onPacket=function(t){this.emit("packet",t)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(t,e,a){function i(t,a){return a("b"+e.packets[t.type]+t.data.data)}function n(t,a,i){if(!a)return e.encodeBase64Packet(t,i);var n=t.data,s=new Uint8Array(n),o=new Uint8Array(1+n.byteLength);o[0]=p[t.type];for(var r=0;r<s.length;r++)o[r+1]=s[r];return i(o.buffer)}function s(t,a,i){if(!a)return e.encodeBase64Packet(t,i);if(f)return function(t,a,i){if(!a)return e.encodeBase64Packet(t,i);var n=new FileReader;return n.onload=function(){e.encodePacket({type:t.type,data:n.result},a,!0,i)},n.readAsArrayBuffer(t.data)}(t,a,i);var n=new Uint8Array(1);return n[0]=p[t.type],i(new L([n.buffer,t.data]))}function o(t,e,a){for(var i=new Array(t.length),n=h(t.length,a),s=function(t,a,n){e(a,(function(e,a){i[t]=a,n(e,i)}))},o=0;o<t.length;o++)s(o,t[o],n)}var r,d=a(25),c=a(26),l=a(27),h=a(28),g=a(29);"undefined"!=typeof ArrayBuffer&&(r=a(30));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),C="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),f=u||C;e.protocol=3;var p=e.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=d(p),_={type:"error",data:"parser error"},L=a(31);e.encodePacket=function(t,e,a,o){"function"==typeof e&&(o=e,e=!1),"function"==typeof a&&(o=a,a=null);var r=void 0===t.data?void 0:t.data.buffer||t.data;if("undefined"!=typeof ArrayBuffer&&r instanceof ArrayBuffer)return n(t,e,o);if(void 0!==L&&r instanceof L)return s(t,e,o);if(r&&r.base64)return i(t,o);var d=p[t.type];return void 0!==t.data&&(d+=a?g.encode(String(t.data),{strict:!1}):String(t.data)),o(""+d)},e.encodeBase64Packet=function(t,a){var i,n="b"+e.packets[t.type];if(void 0!==L&&t.data instanceof L){var s=new FileReader;return s.onload=function(){var t=s.result.split(",")[1];a(n+t)},s.readAsDataURL(t.data)}try{i=String.fromCharCode.apply(null,new Uint8Array(t.data))}catch(e){for(var o=new Uint8Array(t.data),r=new Array(o.length),d=0;d<o.length;d++)r[d]=o[d];i=String.fromCharCode.apply(null,r)}return n+=btoa(i),a(n)},e.decodePacket=function(t,a,i){if(void 0===t)return _;if("string"==typeof t){if("b"===t.charAt(0))return e.decodeBase64Packet(t.substr(1),a);if(i&&!1===(t=function(t){try{t=g.decode(t,{strict:!1})}catch(t){return!1}return t}(t)))return _;var n=t.charAt(0);return Number(n)==n&&m[n]?t.length>1?{type:m[n],data:t.substring(1)}:{type:m[n]}:_}n=new Uint8Array(t)[0];var s=l(t,1);return L&&"blob"===a&&(s=new L([s])),{type:m[n],data:s}},e.decodeBase64Packet=function(t,e){var a=m[t.charAt(0)];if(!r)return{type:a,data:{base64:!0,data:t.substr(1)}};var i=r.decode(t.substr(1));return"blob"===e&&L&&(i=new L([i])),{type:a,data:i}},e.encodePayload=function(t,a,i){"function"==typeof a&&(i=a,a=null);var n=c(t);return a&&n?L&&!f?e.encodePayloadAsBlob(t,i):e.encodePayloadAsArrayBuffer(t,i):t.length?void o(t,(function(t,i){e.encodePacket(t,!!n&&a,!1,(function(t){i(null,function(t){return t.length+":"+t}(t))}))}),(function(t,e){return i(e.join(""))})):i("0:")},e.decodePayload=function(t,a,i){if("string"!=typeof t)return e.decodePayloadAsBinary(t,a,i);var n;if("function"==typeof a&&(i=a,a=null),""===t)return i(_,0,1);for(var s,o,r="",d=0,c=t.length;d<c;d++){var l=t.charAt(d);if(":"===l){if(""===r||r!=(s=Number(r)))return i(_,0,1);if(r!=(o=t.substr(d+1,s)).length)return i(_,0,1);if(o.length){if(n=e.decodePacket(o,a,!1),_.type===n.type&&_.data===n.data)return i(_,0,1);if(!1===i(n,d+s,c))return}d+=s,r=""}else r+=l}return""!==r?i(_,0,1):void 0},e.encodePayloadAsArrayBuffer=function(t,a){return t.length?void o(t,(function(t,a){e.encodePacket(t,!0,!0,(function(t){return a(null,t)}))}),(function(t,e){var i=e.reduce((function(t,e){var a;return t+(a="string"==typeof e?e.length:e.byteLength).toString().length+a+2}),0),n=new Uint8Array(i),s=0;return e.forEach((function(t){var e="string"==typeof t,a=t;if(e){for(var i=new Uint8Array(t.length),o=0;o<t.length;o++)i[o]=t.charCodeAt(o);a=i.buffer}n[s++]=e?0:1;var r=a.byteLength.toString();for(o=0;o<r.length;o++)n[s++]=parseInt(r[o]);for(n[s++]=255,i=new Uint8Array(a),o=0;o<i.length;o++)n[s++]=i[o]})),a(n.buffer)})):a(new ArrayBuffer(0))},e.encodePayloadAsBlob=function(t,a){o(t,(function(t,a){e.encodePacket(t,!0,!0,(function(t){var e=new Uint8Array(1);if(e[0]=1,"string"==typeof t){for(var i=new Uint8Array(t.length),n=0;n<t.length;n++)i[n]=t.charCodeAt(n);t=i.buffer,e[0]=0}var s=(t instanceof ArrayBuffer?t.byteLength:t.size).toString(),o=new Uint8Array(s.length+1);for(n=0;n<s.length;n++)o[n]=parseInt(s[n]);if(o[s.length]=255,L){var r=new L([e.buffer,o.buffer,t]);a(null,r)}}))}),(function(t,e){return a(new L(e))}))},e.decodePayloadAsBinary=function(t,a,i){"function"==typeof a&&(i=a,a=null);for(var n=t,s=[];n.byteLength>0;){for(var o=new Uint8Array(n),r=0===o[0],d="",c=1;255!==o[c];c++){if(d.length>310)return i(_,0,1);d+=o[c]}n=l(n,2+d.length),d=parseInt(d);var h=l(n,0,d);if(r)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(t){var g=new Uint8Array(h);for(h="",c=0;c<g.length;c++)h+=String.fromCharCode(g[c])}s.push(h),n=l(n,d)}var u=s.length;s.forEach((function(t,n){i(e.decodePacket(t,a,!0),n,u)}))}},function(t,e){t.exports=Object.keys||function(t){var e=[],a=Object.prototype.hasOwnProperty;for(var i in t)a.call(t,i)&&e.push(i);return e}},function(t,e,a){var i=a(13),n=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===n.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===n.call(File);t.exports=function t(e){if(!e||"object"!=typeof e)return!1;if(i(e)){for(var a=0,n=e.length;a<n;a++)if(t(e[a]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||s&&e instanceof Blob||o&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return t(e.toJSON(),!0);for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return!0;return!1}},function(t,e){t.exports=function(t,e,a){var i=t.byteLength;if(e=e||0,a=a||i,t.slice)return t.slice(e,a);if(e<0&&(e+=i),a<0&&(a+=i),a>i&&(a=i),e>=i||e>=a||0===i)return new ArrayBuffer(0);for(var n=new Uint8Array(t),s=new Uint8Array(a-e),o=e,r=0;o<a;o++,r++)s[r]=n[o];return s.buffer}},function(t,e){function a(){}t.exports=function(t,e,i){function n(t,a){if(n.count<=0)throw new Error("after called too many times");--n.count,t?(s=!0,e(t),e=i):0!==n.count||s||e(null,a)}var s=!1;return i=i||a,n.count=t,0===t?e():n}},function(t,e){function a(t){for(var e,a,i=[],n=0,s=t.length;n<s;)(e=t.charCodeAt(n++))>=55296&&e<=56319&&n<s?56320==(64512&(a=t.charCodeAt(n++)))?i.push(((1023&e)<<10)+(1023&a)+65536):(i.push(e),n--):i.push(e);return i}function i(t,e){if(t>=55296&&t<=57343){if(e)throw Error("Lone surrogate U+"+t.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function n(t,e){return h(t>>e&63|128)}function s(t,e){if(0==(4294967168&t))return h(t);var a="";return 0==(4294965248&t)?a=h(t>>6&31|192):0==(4294901760&t)?(i(t,e)||(t=65533),a=h(t>>12&15|224),a+=n(t,6)):0==(4292870144&t)&&(a=h(t>>18&7|240),a+=n(t,12),a+=n(t,6)),a+h(63&t|128)}function o(){if(l>=c)throw Error("Invalid byte index");var t=255&d[l];if(l++,128==(192&t))return 63&t;throw Error("Invalid continuation byte")}function r(t){var e,a;if(l>c)throw Error("Invalid byte index");if(l==c)return!1;if(e=255&d[l],l++,0==(128&e))return e;if(192==(224&e)){if((a=(31&e)<<6|o())>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&e)){if((a=(15&e)<<12|o()<<6|o())>=2048)return i(a,t)?a:65533;throw Error("Invalid continuation byte")}if(240==(248&e)&&(a=(7&e)<<18|o()<<12|o()<<6|o())>=65536&&a<=1114111)return a;throw Error("Invalid UTF-8 detected")}/*! https://mths.be/utf8js v2.1.2 by @mathias */
var d,c,l,h=String.fromCharCode;t.exports={version:"2.1.2",encode:function(t,e){for(var i=!1!==(e=e||{}).strict,n=a(t),o=n.length,r=-1,d="";++r<o;)d+=s(n[r],i);return d},decode:function(t,e){var i=!1!==(e=e||{}).strict;d=a(t),c=d.length,l=0;for(var n,s=[];!1!==(n=r(i));)s.push(n);return function(t){for(var e,a=t.length,i=-1,n="";++i<a;)(e=t[i])>65535&&(n+=h((e-=65536)>>>10&1023|55296),e=56320|1023&e),n+=h(e);return n}(s)}}},function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=new Uint8Array(256),i=0;i<t.length;i++)a[t.charCodeAt(i)]=i;e.encode=function(e){var a,i=new Uint8Array(e),n=i.length,s="";for(a=0;a<n;a+=3)s+=t[i[a]>>2],s+=t[(3&i[a])<<4|i[a+1]>>4],s+=t[(15&i[a+1])<<2|i[a+2]>>6],s+=t[63&i[a+2]];return n%3==2?s=s.substring(0,s.length-1)+"=":n%3==1&&(s=s.substring(0,s.length-2)+"=="),s},e.decode=function(t){var e,i,n,s,o,r=.75*t.length,d=t.length,c=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);var l=new ArrayBuffer(r),h=new Uint8Array(l);for(e=0;e<d;e+=4)i=a[t.charCodeAt(e)],n=a[t.charCodeAt(e+1)],s=a[t.charCodeAt(e+2)],o=a[t.charCodeAt(e+3)],h[c++]=i<<2|n>>4,h[c++]=(15&n)<<4|s>>2,h[c++]=(3&s)<<6|63&o;return l}}()},function(t,e){function a(t){return t.map((function(t){if(t.buffer instanceof ArrayBuffer){var e=t.buffer;if(t.byteLength!==e.byteLength){var a=new Uint8Array(t.byteLength);a.set(new Uint8Array(e,t.byteOffset,t.byteLength)),e=a.buffer}return e}return t}))}function i(t,e){e=e||{};var i=new s;return a(t).forEach((function(t){i.append(t)})),e.type?i.getBlob(e.type):i.getBlob()}function n(t,e){return new Blob(a(t),e||{})}var s=void 0!==s?s:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(t){return!1}}(),r=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(t){return!1}}(),d=s&&s.prototype.append&&s.prototype.getBlob;"undefined"!=typeof Blob&&(i.prototype=Blob.prototype,n.prototype=Blob.prototype),t.exports=o?r?Blob:n:d?i:void 0},function(t,e){e.encode=function(t){var e="";for(var a in t)t.hasOwnProperty(a)&&(e.length&&(e+="&"),e+=encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return e},e.decode=function(t){for(var e={},a=t.split("&"),i=0,n=a.length;i<n;i++){var s=a[i].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}},function(t,e){t.exports=function(t,e){var a=function(){};a.prototype=e.prototype,t.prototype=new a,t.prototype.constructor=t}},function(t,e){function a(t){var e="";do{e=s[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function i(){var t=a(+new Date);return t!==n?(d=0,n=t):t+"."+a(d++)}for(var n,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,r={},d=0,c=0;c<o;c++)r[s[c]]=c;i.encode=a,i.decode=function(t){var e=0;for(c=0;c<t.length;c++)e=e*o+r[t.charAt(c)];return e},t.exports=i},function(t,e,a){(function(e){function i(){}function n(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{}}function s(t){if(o.call(this,t),this.query=this.query||{},!d){var e=n();d=e.___eio=e.___eio||[]}this.index=d.length;var a=this;d.push((function(t){a.onData(t)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){a.script&&(a.script.onerror=i)}),!1)}var o=a(22),r=a(33);t.exports=s;var d,c=/\n/g,l=/\\n/g;r(s,o),s.prototype.supportsBinary=!1,s.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},s.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var a=document.getElementsByTagName("script")[0];a?a.parentNode.insertBefore(e,a):(document.head||document.body).appendChild(e),this.script=e,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)}),100)},s.prototype.doWrite=function(t,e){function a(){i(),e()}function i(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var t='<iframe src="javascript:0" name="'+n.iframeId+'">';s=document.createElement(t)}catch(t){(s=document.createElement("iframe")).name=n.iframeId,s.src="javascript:0"}s.id=n.iframeId,n.form.appendChild(s),n.iframe=s}var n=this;if(!this.form){var s,o=document.createElement("form"),r=document.createElement("textarea"),d=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=d,o.method="POST",o.setAttribute("accept-charset","utf-8"),r.name="d",o.appendChild(r),document.body.appendChild(o),this.form=o,this.area=r}this.form.action=this.uri(),i(),t=t.replace(l,"\\\n"),this.area.value=t.replace(c,"\\n");try{this.form.submit()}catch(t){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a}}).call(e,function(){return this}())},function(t,e,a){function i(t){t&&t.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=t.perMessageDeflate,this.usingBrowserWebSocket=n&&!t.forceNode,this.protocols=t.protocols,this.usingBrowserWebSocket||(g=s),o.call(this,t)}var n,s,o=a(23),r=a(24),d=a(32),c=a(33),l=a(34),h=a(3)("engine.io-client:websocket");if("undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{s=a(37)}catch(t){}var g=n||s;t.exports=i,c(i,o),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var t=this.uri(),e=this.protocols,a={agent:this.agent,perMessageDeflate:this.perMessageDeflate};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(a.headers=this.extraHeaders),this.localAddress&&(a.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new g(t,e):new g(t):new g(t,e,a)}catch(t){return this.emit("error",t)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var t=this;this.ws.onopen=function(){t.onOpen()},this.ws.onclose=function(){t.onClose()},this.ws.onmessage=function(e){t.onData(e.data)},this.ws.onerror=function(e){t.onError("websocket error",e)}},i.prototype.write=function(t){var e=this;this.writable=!1;for(var a=t.length,i=0,n=a;i<n;i++)!function(t){r.encodePacket(t,e.supportsBinary,(function(i){if(!e.usingBrowserWebSocket){var n={};t.options&&(n.compress=t.options.compress),e.perMessageDeflate&&("string"==typeof i?Buffer.byteLength(i):i.length)<e.perMessageDeflate.threshold&&(n.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(i):e.ws.send(i,n)}catch(t){h("websocket closed before onclose event")}--a||(e.emit("flush"),setTimeout((function(){e.writable=!0,e.emit("drain")}),0))}))}(t[i])},i.prototype.onClose=function(){o.prototype.onClose.call(this)},i.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},i.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",a="";return this.port&&("wss"===e&&443!==Number(this.port)||"ws"===e&&80!==Number(this.port))&&(a=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=l()),this.supportsBinary||(t.b64=1),(t=d.encode(t)).length&&(t="?"+t),e+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+a+this.path+t},i.prototype.check=function(){return!(!g||"__initialize"in g&&this.name===i.prototype.name)}},function(t,e){},function(t,e){var a=[].indexOf;t.exports=function(t,e){if(a)return t.indexOf(e);for(var i=0;i<t.length;++i)if(t[i]===e)return i;return-1}},function(t,e,a){function i(t,e,a){this.io=t,this.nsp=e,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},a&&a.query&&(this.query=a.query),this.io.autoConnect&&this.open()}var n=a(7),s=a(11),o=a(40),r=a(41),d=a(42),c=a(3)("socket.io-client:socket"),l=a(32),h=a(26);t.exports=i;var g={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},u=s.prototype.emit;s(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var t=this.io;this.subs=[r(t,"open",d(this,"onopen")),r(t,"packet",d(this,"onpacket")),r(t,"close",d(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},i.prototype.send=function(){var t=o(arguments);return t.unshift("message"),this.emit.apply(this,t),this},i.prototype.emit=function(t){if(g.hasOwnProperty(t))return u.apply(this,arguments),this;var e=o(arguments),a={type:(void 0!==this.flags.binary?this.flags.binary:h(e))?n.BINARY_EVENT:n.EVENT,data:e,options:{}};return a.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof e[e.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=e.pop(),a.id=this.ids++),this.connected?this.packet(a):this.sendBuffer.push(a),this.flags={},this},i.prototype.packet=function(t){t.nsp=this.nsp,this.io.packet(t)},i.prototype.onopen=function(){if(c("transport is open - connecting"),"/"!==this.nsp)if(this.query){var t="object"==typeof this.query?l.encode(this.query):this.query;c("sending connect packet with query %s",t),this.packet({type:n.CONNECT,query:t})}else this.packet({type:n.CONNECT})},i.prototype.onclose=function(t){c("close (%s)",t),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",t)},i.prototype.onpacket=function(t){var e=t.nsp===this.nsp,a=t.type===n.ERROR&&"/"===t.nsp;if(e||a)switch(t.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(t);break;case n.ACK:case n.BINARY_ACK:this.onack(t);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",t.data)}},i.prototype.onevent=function(t){var e=t.data||[];c("emitting event %j",e),null!=t.id&&(c("attaching ack callback to event"),e.push(this.ack(t.id))),this.connected?u.apply(this,e):this.receiveBuffer.push(e)},i.prototype.ack=function(t){var e=this,a=!1;return function(){if(!a){a=!0;var i=o(arguments);c("sending ack %j",i),e.packet({type:h(i)?n.BINARY_ACK:n.ACK,id:t,data:i})}}},i.prototype.onack=function(t){var e=this.acks[t.id];"function"==typeof e?(c("calling ack %s with %j",t.id,t.data),e.apply(this,t.data),delete this.acks[t.id]):c("bad ack %s",t.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var t;for(t=0;t<this.receiveBuffer.length;t++)u.apply(this,this.receiveBuffer[t]);for(this.receiveBuffer=[],t=0;t<this.sendBuffer.length;t++)this.packet(this.sendBuffer[t]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var t=0;t<this.subs.length;t++)this.subs[t].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(t){return this.flags.compress=t,this},i.prototype.binary=function(t){return this.flags.binary=t,this}},function(t,e){t.exports=function(t,e){for(var a=[],i=(e=e||0)||0;i<t.length;i++)a[i-e]=t[i];return a}},function(t,e){t.exports=function(t,e,a){return t.on(e,a),{destroy:function(){t.removeListener(e,a)}}}},function(t,e){var a=[].slice;t.exports=function(t,e){if("string"==typeof e&&(e=t[e]),"function"!=typeof e)throw new Error("bind() requires a function");var i=a.call(arguments,2);return function(){return e.apply(t,i.concat(a.call(arguments)))}}},function(t,e){function a(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}t.exports=a,a.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),a=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-a:t+a}return 0|Math.min(t,this.max)},a.prototype.reset=function(){this.attempts=0},a.prototype.setMin=function(t){this.ms=t},a.prototype.setMax=function(t){this.max=t},a.prototype.setJitter=function(t){this.jitter=t}}])}));class StartPage{init(t,e,a){this.configStartPage=e.startPage?e.startPage:LadiChat_Config.defaultStartPageConfig,this.storeConfig=e;const i=this.generateHTMLContent();this.token=t,this.listArticle=[],this.doom_element=i,this.socket=a,this.name=LadiChat_Config.SCREEN_NAME.START_PAGE}async createConversation(){const t=JSON.parse(this.storeConfig.widgetConfig);if(!LadiChat_Helper.checkUserInfo()&&LadiChat.storeConfig.startForm&&LadiChat.storeConfig.contact_required)return this.removeSocketEvent(),void LadiChat.showFormPopup(LadiChat.storeConfig.startForm);LadiChat.isFirstShow=!0;let e=LadiChat.storeConfig.user_info.conversation;!e&&LadiChat.listConversation.length>0&&(e=LadiChat.listConversation[0]),e&&e.is_open?LadiChat.showConversationStream(e):this.storeConfig.user_info.is_complete_survey||LadiChat.listConversation.length>0||this.storeConfig.user_info.is_complete_survey||!t.wellcome_form_id||""==t.wellcome_form_id?LadiChat.showConversationStream():LadiChat.push([["do","form:send",{form_id:t.wellcome_form_id,form_type:"POPUP"}]])}async showTicket(){LadiChat.timeoutConversation&&clearTimeout(LadiChat.timeoutConversation),LadiChat.divPreviewMsg.classList.add("hidden");let t=LadiChat_Helper.getLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID);t=t&&""!=t?Object.assign(t,LadiChat.storeConfig):LadiChat.storeConfig;let e=LadiChat.storeConfig.user_info;e&&""!=e&&(t.user_info=e),e.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.storeConfig.user_info.screen_name=LadiChat_Config.SCREEN_NAME.FORM_TICKET,LadiChat.mainPage=new PopupTicket,LadiChat.mainPage.init(LadiChat.token,t),LadiChat.chatContainer.innerHTML=LadiChat.mainPage.doom_element.outerHTML,setTimeout((function(){LadiChat.frameContainer.style.setProperty("visibility","visible")}),300);const a=frames["ladichat-widget-frame"].contentWindow.document||frames["ladichat-widget-frame"].contentDocument;LadiChat.mainPage.addEvent(a),LadiChat.addEvent(),LadiChat.showChatWidget()}async showForm(t,e){try{const a=await LadiChat.getFormData(t);if(!a)return;e==LadiChat_Config.TYPE_FORM.INLINE&&LadiChat.showFormInline(a),e==LadiChat_Config.TYPE_FORM.POPUP&&LadiChat.showFormPopup(a)}catch(t){console.log(t)}}async showFormInline(t){let e="";t.description&&""!=t.description.trim()&&(e+=`<div>${t.description}</div>`),e+='<div class="ladichat-form-wrapper"><div class="ladichat-form" id="submited-form">';let a="";if(t.form_fields&&t.form_fields.length>0){for(let a=0;a<t.form_fields.length;a++){const i=t.form_fields[a],n=LadiChat_Helper.getInputType(i,t._id);e+=`<div class="form-field"><label>${i.name}</label>${n}</div>`}a=`<div class="ladichat-form submit-btn"><span contenteditable="false" class="button-submit-form noselect" id="button-submit-form" data-config-id="${t.form_config_id}">${t.button_submit}</span></div>`}if(e+="</div></div>",LadiChat.isCreatingConv)return;LadiChat.isCreatingConv=!0;const i={"content-type":"application/json","session-key":LadiChat.token},n={message:`${e}${a}`},s=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.CREATE_INLINE_FORM,n,i);LadiChat.divPreviewMsg.classList.add("hidden"),s&&(LadiChat.isCreatingConv=!1),LadiChat.showConversationStream(s.data.conversation),LadiChat.showChatWidget(!0)}addEvent(t){const e=this;this.mainDocument=t;const a=JSON.parse(LadiChat.storeConfig.widgetConfig);this.mainDocument.getElementById("button-new-conversation-agent").addEventListener("click",(function(){if(!LadiChat.storeConfig.is_online&&a.offline_options.is_show){if(a.offline_options&&a.offline_options.is_open_ticket)return void LadiChat.showTicket()}else e.createConversation()})),this.mainDocument.getElementById("button-new-conversation-conv").addEventListener("click",(function(){if(!LadiChat.storeConfig.is_online&&a.offline_options.is_show){if(a.offline_options&&a.offline_options.is_open_ticket)return void LadiChat.showTicket()}else LadiChat.sendTracking("user_click_button_start_conversation"),e.createConversation()})),this.mainDocument.getElementById("ladichat-startpage"),this.mainDocument.getElementById("header-welcome"),this.mainDocument.getElementById("intro-store");const i=this.mainDocument.getElementById("btn-close-widget");i.addEventListener("click",(function(){LadiChat.showChatWidget(!0)})),LadiChat.isMobile&&(i.style.display="none"),this.mainDocument.getElementById("view-all-conversation").addEventListener("click",(function(){LadiChat.showConversationPage()}));const n=this.mainDocument.getElementById("item-channel-form-popup");if(n){const t=n.getAttribute("data-form-id");n.addEventListener("click",(async function(){const e=await LadiChat.getFormData(t);LadiChat.showFormPopup(e)}))}const s=this.mainDocument.getElementsByClassName("item-language");for(let t=0;t<s.length;t++){const e=s[t];let a=e.getAttribute("data-language");e.addEventListener("click",(function(t){LadiChat.changeLanguage(a)}))}this.agentContainer=this.mainDocument.getElementById("agent-module"),this.conversationContainer=this.mainDocument.getElementById("conversation-module"),this.listConversationElement=this.mainDocument.getElementById("list-conversation"),LadiChat.token&&this.addSocketEvent();const o=this.mainDocument.getElementsByClassName("item-channel");for(let t=0;t<o.length;t++){const e=o[t],a=e.getAttribute("data-type").toLowerCase()+"_btn_click";e.addEventListener("click",(function(t){LadiChat.sendTracking(a)}))}}generateHeader(){let t=this.configStartPage.wellcome_text&&""!=this.configStartPage.wellcome_text?this.configStartPage.wellcome_text:"Xin chào 👋";const e=this.configStartPage.logo_img?this.configStartPage.logo_img:LadiChat_Config.defaultLogo;let a=`<p>${t}</p>`;this.configStartPage.wellcome_text.includes("{{Name}}")&&(LadiChat.storeConfig.user_info.name?a=`<p>${t.replaceAll("{{Name}}",LadiChat_Helper.capitalize(LadiChat.storeConfig.user_info.name))}</p>`:LadiChat.storeConfig.user_info.email&&(a=`<p>${t.replaceAll("{{Name}}",LadiChat.storeConfig.user_info.email.toLowerCase())}</p>`),LadiChat.storeConfig.user_info&&(LadiChat.storeConfig.user_info.name||LadiChat.storeConfig.user_info.email)||(this.configStartPage.wellcome_text=this.configStartPage.wellcome_text.replace("{{Name}}","")));const i=`<div class="header-start-page"><div class="header-background"></div><div class="header-welcome" id="header-welcome">\n        <div class="logo"><img src=${e} ></div>\n        <div class="intro-text">\n            ${a}</div>\n                </div><div class="intro-store" id="intro-store">${this.configStartPage.introduce_text}</div><div id="btn-close-widget"><i class="ladiui icon icon-ldp-close"></div></div>`,n=document.createElement("div");return n.innerHTML=i.trim(),n.firstChild}generateListAgent(){const t=document.createElement("div");t.setAttribute("class","module-border-wrap hide"),t.setAttribute("id","agent-module");const e=document.createElement("div");e.setAttribute("class","content-item");const a=document.createElement("div");a.setAttribute("class","item-title"),a.innerText="Chat với chúng tôi",this.configStartPage.talk_with_us&&""!=this.configStartPage.talk_with_us&&(a.innerText=this.configStartPage.talk_with_us);const i=document.createElement("div");i.setAttribute("class","item-article");let n=LadiChat.storeConfig.conversationPage.agent_describe&&""!=LadiChat.storeConfig.conversationPage.agent_describe?LadiChat.storeConfig.conversationPage.agent_describe:"Các hỗ trợ viên ";i.innerHTML=n+" đang trực tuyến sẵn sàng hỗ trợ",this.configStartPage.support_online&&""!=this.configStartPage.support_online&&(i.innerHTML=n+" "+this.configStartPage.support_online),e.appendChild(a),e.appendChild(i),t.appendChild(e);const s=document.createElement("div");s.setAttribute("class","list-agent");let o=0;this.storeConfig.staffs=this.storeConfig.staffs.sort((function(t,e){return Math.random()-.5}));for(let t=0;t<this.storeConfig.staffs.length;t++){const e=this.storeConfig.staffs[t];if(o>=3)break;if(e.online_status==LadiChat_Config.STAFF_STATUS.ONLINE){const t=LadiChat_Helper.getStaffAvatar(e);s.appendChild(t),o++}}let r="Bắt đầu chat";this.configStartPage.button_start_conversation&&""!=this.configStartPage.button_start_conversation&&(r=this.configStartPage.button_start_conversation);const d=document.createElement("span"),c=document.createElement("a");c.setAttribute("id","ladichat-send-button"),c.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M15.005 8.12805C15.0061 8.03612 14.9819 7.94566 14.935 7.86661C14.888 7.78757 14.8202 7.72299 14.739 7.67998L1.74093 0.802383C1.65557 0.757038 1.55891 0.737402 1.46263 0.745852C1.36635 0.754302 1.27458 0.790475 1.19843 0.849995C1.12228 0.909515 1.06502 0.98983 1.03356 1.08122C1.00211 1.17261 0.997815 1.27115 1.0212 1.36493L2.41213 6.92791L8.14163 8.04379L2.38646 9.01867L0.86153 14.5437C0.837822 14.6281 0.836683 14.7171 0.858228 14.802C0.879772 14.8869 0.923246 14.9647 0.984294 15.0275C0.996895 15.0404 1.0102 15.0526 1.02415 15.0641C1.09871 15.1255 1.18947 15.1641 1.28547 15.1751C1.38147 15.186 1.47859 15.1689 1.56508 15.1259L14.728 8.56945C14.8103 8.52845 14.8797 8.46556 14.9286 8.38769C14.9774 8.30981 15.0039 8.21998 15.005 8.12805Z" fill="white"/>\n            </svg>\n            ',d.appendChild(c);const l=document.createTextNode(r);return d.appendChild(l),d.setAttribute("class","button-new-conversation noselect"),d.setAttribute("id","button-new-conversation-agent"),s.appendChild(d),t.appendChild(s),t}async connectFunc(){await this.getConversation()}generateListConversation(){try{const t=document.createElement("div");t.setAttribute("class","module-border-wrap hide"),t.setAttribute("id","conversation-module");const e=document.createElement("div");e.setAttribute("class","content-item");const a=document.createElement("div");a.setAttribute("class","item-title"),a.innerText="Danh sách cuộc chat",this.configStartPage.list_conversation_label&&""!=this.configStartPage.list_conversation_label&&(a.innerText=this.configStartPage.list_conversation_label);const i=document.createElement("span");i.setAttribute("id","view-all-conversation"),i.innerText="Xem tất cả",this.configStartPage.view_all_label&&""!=this.configStartPage.view_all_label&&(i.innerText=this.configStartPage.view_all_label),a.appendChild(i),e.appendChild(a),t.appendChild(e);const n=document.createElement("div");n.setAttribute("class","list-conversation"),n.setAttribute("id","list-conversation"),t.appendChild(n);const s=document.createElement("div");s.setAttribute("class","create-new-conv");let o="Bắt đầu chat";this.configStartPage.button_start_conversation&&""!=this.configStartPage.button_start_conversation&&(o=this.configStartPage.button_start_conversation);const r=document.createElement("a");r.setAttribute("class","button-new-conversation-conv"),r.setAttribute("id","button-new-conversation-conv"),r.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M15.005 8.12805C15.0061 8.03612 14.9819 7.94566 14.935 7.86661C14.888 7.78757 14.8202 7.72299 14.739 7.67998L1.74093 0.802383C1.65557 0.757038 1.55891 0.737402 1.46263 0.745852C1.36635 0.754302 1.27458 0.790475 1.19843 0.849995C1.12228 0.909515 1.06502 0.98983 1.03356 1.08122C1.00211 1.17261 0.997815 1.27115 1.0212 1.36493L2.41213 6.92791L8.14163 8.04379L2.38646 9.01867L0.86153 14.5437C0.837822 14.6281 0.836683 14.7171 0.858228 14.802C0.879772 14.8869 0.923246 14.9647 0.984294 15.0275C0.996895 15.0404 1.0102 15.0526 1.02415 15.0641C1.09871 15.1255 1.18947 15.1641 1.28547 15.1751C1.38147 15.186 1.47859 15.1689 1.56508 15.1259L14.728 8.56945C14.8103 8.52845 14.8797 8.46556 14.9286 8.38769C14.9774 8.30981 15.0039 8.21998 15.005 8.12805Z" fill="white"/>\n            </svg>${o}\n            `;let d=0;this.storeConfig.staffs=this.storeConfig.staffs.sort((function(t,e){return Math.random()-.5}));for(let t=0;t<this.storeConfig.staffs.length;t++){const e=this.storeConfig.staffs[t];if(d>=3)break;if(e.online_status==LadiChat_Config.STAFF_STATUS.ONLINE){const t=LadiChat_Helper.getStaffAvatar(e);s.appendChild(t),d++}}return s.appendChild(r),t.appendChild(s),t}catch(t){console.log(t)}}generateExtraContent(t){const e=document.createElement("div");e.setAttribute("class","content-item article");const a=document.createElement("div");a.setAttribute("class","item-title"),a.innerText=t.title;const i=document.createElement("div");return i.setAttribute("class","item-article"),i.innerHTML=t.content,e.appendChild(a),e.appendChild(i),e}generateListChannel(){const t=document.createElement("div");t.setAttribute("class","module-border-wrap");const e=document.createElement("div");e.setAttribute("class","content-item");const{list_channels:a}=this.configStartPage,i=document.createElement("div");i.setAttribute("class","item-title"),i.innerText=a.title,e.appendChild(i);const{list_items:n}=a;for(let t=0;t<n.length;t++){const a=document.createElement("a");a.setAttribute("class","item-channel"),a.setAttribute("data-type",n[t].type||"ZALO");const i=document.createElement("span");a.setAttribute("target","_blank"),i.setAttribute("class","channel-name"),a.setAttribute("href",n[t].external_link),"PHONE"==n[t].type&&a.setAttribute("href","tel:"+n[t].external_link),"EMAIL"==n[t].type&&a.setAttribute("href","mailto:"+n[t].external_link),"FORM_POPUP"==n[t].type&&(a.removeAttribute("target"),a.removeAttribute("href"),a.setAttribute("id","item-channel-form-popup"),a.setAttribute("data-form-id",n[t].external_link)),"EXTERNAL_LINK"==n[t].type&&a.setAttribute("href",n[t].external_link);const s=n[t].channel_name.toLowerCase().replace(" ","-"),o=document.createElement("div");o.setAttribute("class","icon-channel "+s);const r=document.createElement("img");o.appendChild(r),i.appendChild(o);const d=document.createElement("span");d.innerHTML=n[t].display_name,i.appendChild(d);const c=document.createElement("span");c.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M9.35625 3.14377L13.8562 7.64377C13.9487 7.73934 14.0003 7.86708 14.0003 8.00002C14.0003 8.13296 13.9487 8.2607 13.8562 8.35627L9.35625 12.8563C9.2591 12.936 9.13577 12.9767 9.01024 12.9706C8.88472 12.9644 8.76597 12.9118 8.6771 12.8229C8.58824 12.734 8.5356 12.6153 8.52944 12.4898C8.52327 12.3642 8.56402 12.2409 8.64375 12.1438L12.2937 8.50002L2.5 8.50002C2.36739 8.50002 2.24021 8.44734 2.14645 8.35357C2.05268 8.2598 2 8.13263 2 8.00002C2 7.86741 2.05268 7.74023 2.14645 7.64647C2.24021 7.5527 2.36739 7.50002 2.5 7.50002L12.2937 7.50002L8.64375 3.85627C8.56402 3.75912 8.52327 3.63579 8.52944 3.51026C8.5356 3.38474 8.58824 3.26599 8.6771 3.17712C8.76597 3.08826 8.88472 3.03562 9.01024 3.02946C9.13577 3.02329 9.2591 3.06404 9.35625 3.14377Z" fill="#6D6D6D"/>\n            </svg>\n            ',a.appendChild(i),a.appendChild(c),e.appendChild(a)}return t.appendChild(e),t}generateHTMLContent(){const t=this,e=document.createElement("div"),a=document.createElement("div");a.setAttribute("class","ladichat-startpage"),a.setAttribute("id","ladichat-startpage");const i=this.generateHeader();a.appendChild(i);const n=document.createElement("div");n.setAttribute("class","power-by");const s=document.createElement("a");s.setAttribute("href","https://www.ladiboost.vn"),s.setAttribute("rel","nofollow"),s.setAttribute("target","_blank");const o=document.createElement("div");let r="";for(let t=0;t<LadiChat.storeConfig.listLanguage.length;t++){let e=LadiChat.storeConfig.listLanguage[t];LadiChat_Config.urlIconLanguage,e.code,r+=`<li><div class="item-language" data-language="${e.code}"><p class="language-name">${e.nativeName}</p></div></li>`}LadiChat_Config.urlIconLanguage,LadiChat.currentLanguage.code,o.innerHTML=`<div class="ladiui-select-options select-list-language">\n        <span class="ladiui-select-init">\n        <img src='https://w.ladicdn.com/ladiui/icons/ldicon-global.svg' /img>\n        ${LadiChat.currentLanguage.nativeName}</span>\n        <input type="hidden" name="select" autocomplete="off">\n        <ul>\n    ${r}\n    </ul></div>\n      `;const d=document.createElement("img");d.src=LadiChat_Config.logoPowered,s.appendChild(d),n.appendChild(s),LadiChat.storeConfig.listLanguage.length>1&&(n.classList.add("multi-language"),n.appendChild(o));const c=document.createElement("div");c.setAttribute("class","ladichat-startpage-body"),c.setAttribute("id","ladichat-startpage-body");const l=document.createElement("div");l.setAttribute("class","extra-content");const h=this.generateListAgent(),g=this.generateListConversation();if(l.appendChild(h),l.appendChild(g),this.configStartPage.list_channels&&this.configStartPage.list_channels.list_items&&this.configStartPage.list_channels.list_items.length>0){const t=this.generateListChannel();l.appendChild(t)}if(this.configStartPage.article_enable&&this.configStartPage.list_article&&this.configStartPage.list_article.length>0){const e=document.createElement("div");e.setAttribute("class","module-border-wrap"),this.configStartPage.list_article.forEach((function(a){const i=t.generateExtraContent(a);e.appendChild(i)})),l.appendChild(e)}return c.appendChild(l),this.configStartPage.survey_enable&&this.storeConfig.user_info.is_complete_survey,a.appendChild(c),e.appendChild(a),e.appendChild(n),e}handlerNewConversation(t){t.list_message=[];let e=!1;for(let a=0;a<LadiChat.listConversation.length;a++)if(LadiChat.listConversation[a]._id==t._id){e=!0;break}e||(LadiChat.listConversation.push(t),LadiChat_Helper.handleChangeConversation(LadiChat.listConversation),this.reloadConversation())}handlerNewMessage(t){try{LadiChat_Helper.handleChangeMessage(t);for(let e=0;e<t.length;e++){const a=t[e];if("SYSTEM"===a.type||"NOTE"===a.type)return;const i=a.conversation_id;for(let t=0;t<LadiChat.listConversation.length;t++)LadiChat.listConversation[t]._id===i&&(LadiChat.listConversation[t].last_action=a.created_at,LadiChat.listConversation[t].lastMsg=a);this.reloadConversation()}}catch(t){console.log(t)}}handlerReopenConversation(t){for(let e=0;e<LadiChat.listConversation.length;e++)if(t.conversation_id==LadiChat.listConversation[e]._id){LadiChat.listConversation[e].is_open=!0,LadiChat.listConversation[e].rating=null,this.reloadConversation();break}}handlerClosedConversation(t){if(!t.snooze)for(let e=0;e<LadiChat.listConversation.length;e++)if(t.conversation_id==LadiChat.listConversation[e]._id){LadiChat.listConversation[e].is_open=!1,this.reloadConversation();break}}reloadLastMsg(t,e){const a=this.mainDocument.getElementById(e);if(a){const i=a.getElementsByClassName("message");if(i.length>0){const e=i[0];let a=t.message;a=a.replace(/<div>/gi,"&nbsp;"),a=a.replace(/<br>/gi,"&nbsp;");let n="<div></div>";const s=document.createElement("div");s.innerHTML=a,n=s.innerText,""==s.innerText&&a.indexOf("<img")>=0&&(n="[Hình ảnh]"),e.innerHTML='<p class="content">'+n+' </p><div class="time">'+LadiChat_Helper.getPrettyDate(t.created_at)+"</div>"}if(!this.mainDocument.getElementById("unread-badge-conv-"+e)){const i=a.getElementsByClassName("avatar");if(i.length>0){const a=i[0];let n=!1;t.read_users.indexOf(this.storeConfig.user_info.user_id)<0&&(n=document.createElement("div"),n.setAttribute("class","ladichat-message-unread-badge"),n.setAttribute("id","unread-badge-conv-"+e)),n&&a.appendChild(n)}}}}animateSort(){for(let t=0;t<LadiChat.listConversation.length;t++){const e=this.mainDocument.getElementById(LadiChat.listConversation[t]._id);e&&(e.style.zindex=""+t,e.style.transform=`translateY(${69*t}px)`,e.style.transition="top 200ms")}}sortConversation(){LadiChat.listConversation=LadiChat.listConversation.sort((function(t,e){const a=t.lastMsg?new Date(t.lastMsg.created_at):new Date(t.last_action);return(e.lastMsg?new Date(e.lastMsg.created_at):new Date(e.last_action)).getTime()-a.getTime()}))}reloadConversation(){try{if(LadiChat.screen_name!=this.name)return;const t=this;if(!this.currentConversation&&LadiChat.listConversation.length>0&&(this.currentConversation=LadiChat.listConversation[0]),this.sortConversation(),0==LadiChat.listConversation.length)this.agentContainer.classList.remove("hide"),this.conversationContainer.classList.add("hide");else{this.agentContainer.classList.add("hide"),this.conversationContainer.classList.remove("hide"),LadiChat.listConversation.length<=3?this.listConversationElement.style.height=""+69*LadiChat.listConversation.length:this.listConversationElement.style.height="208px",this.listConversationElement.innerHTML="";for(let e=0;e<LadiChat.listConversation.length&&!(e>=3);e++){LadiChat.listConversation[e].lastMsg&&(LadiChat.listConversation[e].last_action=LadiChat.listConversation[e].lastMsg.created_at);const a=!1,i=LadiChat_Config.getStaffInfo(LadiChat.listConversation[e].assign_id,this.storeConfig),n=new ConversationItem;n.init(this.storeConfig,i,LadiChat.listConversation[e],a);const s=n.doom_element;s.addEventListener("click",(function(e){t.selectConversation(s)})),LadiChat.listConversation[e].widget_element=s,this.listConversationElement.appendChild(s)}}this.subscribeAllConversation(),this.animateSort()}catch(t){console.log(t)}}selectConversation(t){const e=t.id;for(let t=0;t<LadiChat.listConversation.length;t++)e==LadiChat.listConversation[t]._id&&(this.currentConversation=LadiChat.listConversation[t],LadiChat.showConversationStream(this.currentConversation))}addSocketEvent(){const t=this;this.eventReopenConversation=function(e){t.handlerReopenConversation(e)},this.eventClosedConversation=function(e){t.handlerClosedConversation(e)},this.eventNewConversation=function(e){t.handlerNewConversation(e)},this.eventNewMessage=function(e){t.handlerNewMessage([e])},this.eventConnect=function(e){t.subscribeAllConversation()},this.socket.on(LadiChat_Config.SOCKET_EVENT.REOPEN_CONVERSATION,this.eventReopenConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.CLOSE_CONVERSATION,this.eventClosedConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.on(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.on("connect",this.eventConnect)}removeSocketEvent(){this.socket&&(this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.REOPEN_CONVERSATION,this.eventReopenConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.CLOSE_CONVERSATION,this.eventClosedConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_CONVERSATION,this.eventNewConversation),this.socket.removeListener(LadiChat_Config.SOCKET_EVENT.NEW_MESSAGE,this.eventNewMessage),this.socket.removeListener("connect",this.eventConnect))}subscribeAllConversation(){if(LadiChat.listConversation&&0!=LadiChat.listConversation.length)for(let t=0;t<LadiChat.listConversation.length;t++)this.socket.emit(LadiChat_Config.SOCKET_EVENT.SUBSCRIBE_CONVERSATION,LadiChat.listConversation[t]._id)}async getConversation(){try{if(!LadiChat.storeConfig.user_info.is_show_widget)return;const t=LadiChat_Helper.getLocalStorage(LadiChat_Config.LIST_CONVERSATION+LadiChat.storeID),e=!LadiChat.isFirstSession;if(t&&""!=t&&e)LadiChat.listConversation=LadiChat_Helper.sortConv(t),this.reloadConversation();else{if(LadiChat.token){const t={token:LadiChat.token,limit:5},e=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.LIST_CONVERSATION,t);200==e.code&&(LadiChat.listConversation=[],LadiChat.listConversation=e.data.conversations,LadiChat.isFirstSession=!1,LadiChat_Helper.handleChangeConversation(LadiChat.listConversation))}this.reloadConversation()}}catch(t){console.log(t)}}}function StaticConfig(){this.END_POINT="https://api.ladichat.com",this.CSS_URL="https://w.ladicdn.com/ladichat/app-style.css",this.UPLOAD_ENDPOINT="https://api.files.ladicdn.com/2.0/file/user-upload",this.API_FORM="https://api.ldpform.com/sendform",this.APP_HOME="https://app.ladichat.com"}class SurveyPage{init(t,e,a){this.configStartPage=e.startPage?e.startPage:LadiChat_Config.defaultStartPageConfig,this.storeConfig=e;const i=this.generateHTMLContent();this.token=t,this.doom_element=i,this.socket=a,this.name=LadiChat_Config.SCREEN_NAME.SURVEY_PAGE}async createConversation(){if(this.storeConfig.user_info.is_complete_survey||!this.configStartPage.survey_enable||0==this.configStartPage.survey_data.length)return void LadiChat.showConversationStream();const t=this.mainDocument.getElementsByClassName("survey-field"),e={};let a=!0;const i=this.mainDocument.getElementById("survey-title-error");for(let n of t){let t=!0;if((this.configStartPage.survey_require&&""==n.value||""!=n.value&&"email"==n.name)&&(t=LadiChat_Helper.validateEmail(n.value),i.innerText="Email chưa đúng định dạng."),(this.configStartPage.survey_require&&""==n.value||""!=n.value&&"phone"==n.name)&&(t=LadiChat_Helper.validPhone(n.value),i.innerText="Số điện thoại chưa đúng định dạng."),(this.configStartPage.survey_require&&""==n.value||""==n.value&&"name"==n.name)&&(t=!1,i.innerText="Tên không được để trống"),this.configStartPage.survey_require){if(!t){a=!1,n.classList.add("error"),i&&(i.style.display="block");break}n.classList.remove("error"),e[n.name]=n.value}else{if(""!=n.value&&(a=t),!t){n.classList.add("error"),i&&(i.style.display="block");break}n.classList.remove("error"),i.innerText="",i.style.display="none",e[n.name]=n.value}}if(a){const t={"content-type":"application/json","session-key":this.token},a=await LadiChat_Helper.sendPOSTRequest(LadiChat_Static_Config.END_POINT,LadiChat_Config.API_ROUTE.SEND_SURVEY_DATA,e,t);if(200==a.code){let t=a.data;t.screen_name=LadiChat_Config.SCREEN_NAME.MESSENGER_PAGE,t=Object.assign(this.storeConfig.user_info,t),LadiChat_Helper.setLocalStorage(LadiChat_Config.STORE_CONFIG_COOKIE+LadiChat.storeID,LadiChat.storeConfig),LadiChat.showConversationStream()}}}addEvent(t){const e=this;this.mainDocument=t,this.mainDocument.getElementById("button-new-conversation-conv").addEventListener("click",(function(){e.createConversation()}))}generateHeader(){const t=this.configStartPage.logo_img?this.configStartPage.logo_img:LadiChat_Config.defaultLogo;let e="";this.storeConfig.user_info.name?e=`<p>Xin chào ${LadiChat_Helper.capitalize(this.storeConfig.user_info.name)}</p>`:this.storeConfig.user_info.email&&(e=`<p>Xin chào ${LadiChat_Helper.capitalize(this.storeConfig.user_info.email)}</p>`);const a=`<div class="header-start-page"><div class="header-background"></div><div class="header-welcome" id="header-welcome">\n        <div class="logo"><img src=${t} ></div>\n        <div class="intro-text">\n            ${e}<p>${this.configStartPage.introduce_text}</p></div>\n                </div></div>`,i=document.createElement("div");return i.innerHTML=a.trim(),i.firstChild}generateHTMLContent(){const t=document.createElement("div");t.setAttribute("class","ladichat-startpage"),t.setAttribute("id","ladichat-startpage");const e=this.generateHeader();t.appendChild(e);const a=document.createElement("div");if(a.setAttribute("class","ladichat-startpage-body survey"),a.setAttribute("id","ladichat-startpage-body"),this.configStartPage.survey_enable&&!this.storeConfig.user_info.is_complete_survey){const t=document.createElement("div");t.setAttribute("class","survey-form");const e=document.createElement("p");e.setAttribute("class","survey-title"),e.innerText=this.configStartPage.survey_title,t.appendChild(e);const s=this.configStartPage.survey_data;for(var i in s)if(s.hasOwnProperty(i)){var n=s[i];if(n.is_selected){const e=document.createElement("input");e.setAttribute("class","ladichat-input-field survey-field"),e.setAttribute("id","survey-field-"+i),e.setAttribute("name",i),e.setAttribute("placeholder",n.place_holder),"phone"==name&&e.setAttribute("type","number"),t.appendChild(e)}}const o=document.createElement("p");o.setAttribute("class","survey-title error"),o.setAttribute("id","survey-title-error"),o.setAttribute("style","display: none"),this.configStartPage.survey_require&&(o.innerText=this.configStartPage.survey_uncompleted_msg||"Hãy điền đủ thông tin để tiếp tục"),t.appendChild(o),a.appendChild(t)}const s=document.createElement("span");s.setAttribute("class","button-new-conversation noselect"),s.setAttribute("id","button-new-conversation-conv"),s.innerText="Bắt đầu chat",a.appendChild(s);const o=document.createElement("div");o.setAttribute("class","power-by");const r=document.createElement("img");return r.src=LadiChat_Config.logoPowered,o.appendChild(r),t.appendChild(o),t.appendChild(a),t}}